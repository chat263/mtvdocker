"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{1187:function(e,t,r){r.d(t,{Z:function(){return a}});var o=r(4393);let a=e=>{let{aspectRatio:t}=e;return(0,o.jsx)("div",{className:"w-full ".concat(t," rounded-lg"),style:{background:"linear-gradient(90deg, var(--skeleton-color) 25%, var(--skeleton-highlight) 50%, var(--skeleton-color) 75%)",backgroundSize:"200% 100%",animation:"shine 1.5s infinite"},children:(0,o.jsx)("style",{children:"\n      @keyframes shine {\n        0% { background-position: -200% 0; }\n        100% { background-position: 200% 0; }\n      }\n      \n      /* 亮色模式变量 */\n      :root {\n        --skeleton-color: #f0f0f0;\n        --skeleton-highlight: #e0e0e0;\n      }\n      \n      /* 暗色模式变量 */\n      @media (prefers-color-scheme: dark) {\n        :root {\n          --skeleton-color: #2d2d2d;\n          --skeleton-highlight: #3d3d3d;\n        }\n      }\n      \n      .dark {\n        --skeleton-color: #2d2d2d;\n        --skeleton-highlight: #3d3d3d;\n      }\n    "})})}},6501:function(e,t,r){var o=r(4393),a=r(4727),s=r(5324),n=r(4187),l=r(9564),i=r(7944),c=r(1698),d=r(4908),h=r(7467),u=r(1802),p=r(1187);let m=(0,d.forwardRef)(function(e,t){let{id:r,title:m="",query:x="",poster:g="",episodes:b,source:w,source_name:v,source_names:f,progress:y=0,year:k,from:j,currentEpisode:N,douban_id:C,onDelete:P,rate:S,type:R="",isBangumi:D=!1,isAggregate:E=!1}=e,z=(0,c.useRouter)(),[_,H]=(0,d.useState)(!1),[L,Z]=(0,d.useState)(!1),[B,I]=(0,d.useState)(b),[U,Y]=(0,d.useState)(f);(0,d.useEffect)(()=>{I(b)},[b]),(0,d.useEffect)(()=>{Y(f)},[f]),(0,d.useImperativeHandle)(t,()=>({setEpisodes:e=>I(e),setSourceNames:e=>Y(e)}));let O=x||"",q=E?B&&1===B?"movie":"tv":R;(0,d.useEffect)(()=>{if("douban"===j||"search"===j||!w||!r)return;(async()=>{try{let e=await (0,h.at)(w,r);H(e)}catch(e){throw Error("检查收藏状态失败")}})();let e=(0,h.sO)(w,r);return(0,h.rq)("favoritesUpdated",t=>{H(!!t[e])})},[j,w,r]);let T=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"douban"!==j&&"search"!==j&&w&&r)try{_?(await (0,h.r7)(w,r),H(!1)):(await (0,h.qn)(w,r,{title:m,source_name:v||"",year:k||"",cover:g,total_episodes:null!=B?B:1,save_time:Date.now()}),H(!0))}catch(e){throw Error("切换收藏状态失败")}},[j,w,r,m,v,k,g,B,_]),A=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"playrecord"===j&&w&&r)try{await (0,h.Ji)(w,r),null==P||P()}catch(e){throw Error("删除播放记录失败")}},[j,w,r,P]),J=(0,d.useCallback)(()=>{"douban"!==j&&(!E||w||r)?w&&r&&z.push("/play?source=".concat(w,"&id=").concat(r,"&title=").concat(encodeURIComponent(m)).concat(k?"&year=".concat(k):"").concat(E?"&prefer=true":"").concat(O?"&stitle=".concat(encodeURIComponent(O.trim())):"").concat(q?"&stype=".concat(q):"")):z.push("/play?title=".concat(encodeURIComponent(m.trim())).concat(k?"&year=".concat(k):"").concat(q?"&stype=".concat(q):"").concat(E?"&prefer=true":"").concat(O?"&stitle=".concat(encodeURIComponent(O.trim())):""))},[j,w,r,z,m,k,E,O,q]),M=(0,d.useMemo)(()=>{let e={playrecord:{showSourceName:!0,showProgress:!0,showPlayButton:!0,showHeart:!0,showCheckCircle:!0,showDoubanLink:!1,showRating:!1,showYear:!1},favorite:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!0,showCheckCircle:!1,showDoubanLink:!1,showRating:!1,showYear:!1},search:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!1,showCheckCircle:!1,showDoubanLink:!1,showRating:!1,showYear:!0},douban:{showSourceName:!1,showProgress:!1,showPlayButton:!0,showHeart:!1,showCheckCircle:!1,showDoubanLink:!0,showRating:!!S,showYear:!1}};return e[j]||e.search},[j,E,C,S]);return(0,o.jsxs)("div",{className:"group relative w-full rounded-lg bg-transparent cursor-pointer transition-all duration-300 ease-in-out hover:scale-[1.05] hover:z-[500]",onClick:J,children:[(0,o.jsxs)("div",{className:"relative aspect-[2/3] overflow-hidden rounded-lg",children:[!L&&(0,o.jsx)(p.Z,{aspectRatio:"aspect-[2/3]"}),(0,o.jsx)(i.default,{src:(0,u.a8)(g),alt:m,fill:!0,className:"object-cover",referrerPolicy:"no-referrer",loading:"lazy",onLoadingComplete:()=>Z(!0),onError:e=>{let t=e.target;t.dataset.retried||(t.dataset.retried="true",setTimeout(()=>{t.src=(0,u.a8)(g)},2e3))}}),(0,o.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 transition-opacity duration-300 ease-in-out group-hover:opacity-100"}),M.showPlayButton&&(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-300 ease-in-out delay-75 group-hover:opacity-100 group-hover:scale-100",children:(0,o.jsx)(a.Z,{size:50,strokeWidth:.8,className:"text-white fill-transparent transition-all duration-300 ease-out hover:fill-green-500 hover:scale-[1.1]"})}),(M.showHeart||M.showCheckCircle)&&(0,o.jsxs)("div",{className:"absolute bottom-3 right-3 flex gap-3 opacity-0 translate-y-2 transition-all duration-300 ease-in-out group-hover:opacity-100 group-hover:translate-y-0",children:[M.showCheckCircle&&(0,o.jsx)(s.Z,{onClick:A,size:20,className:"text-white transition-all duration-300 ease-out hover:stroke-red-500 hover:scale-[1.1]"}),M.showHeart&&(0,o.jsx)(n.Z,{onClick:T,size:20,className:"transition-all duration-300 ease-out ".concat(_?"fill-red-600 stroke-red-600":"fill-transparent stroke-white hover:stroke-red-400"," hover:scale-[1.1]")})]}),M.showYear&&k&&"unknown"!==k&&""!==k.trim()&&(0,o.jsx)("div",{className:"absolute top-2 bg-black/50 text-white text-xs font-medium px-2 py-1 rounded backdrop-blur-sm shadow-sm transition-all duration-300 ease-out group-hover:opacity-90 ".concat(M.showDoubanLink&&C&&0!==C?"left-2 group-hover:left-11":"left-2"),children:k}),M.showRating&&S&&(0,o.jsx)("div",{className:"absolute top-2 right-2 bg-pink-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:S}),B&&B>1&&(0,o.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:N?"".concat(N,"/").concat(B):B}),M.showDoubanLink&&C&&0!==C&&(0,o.jsx)("a",{href:D?"https://bgm.tv/subject/".concat(C.toString()):"https://movie.douban.com/subject/".concat(C.toString()),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute top-2 left-2 opacity-0 -translate-x-2 transition-all duration-300 ease-in-out delay-100 group-hover:opacity-100 group-hover:translate-x-0",children:(0,o.jsx)("div",{className:"bg-green-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md hover:bg-green-600 hover:scale-[1.1] transition-all duration-300 ease-out",children:(0,o.jsx)(l.Z,{size:16})})}),E&&U&&U.length>0&&(()=>{let e=Array.from(new Set(U)),t=e.length;return(0,o.jsx)("div",{className:"absolute bottom-2 right-2 opacity-0 transition-all duration-300 ease-in-out delay-75 group-hover:opacity-100",children:(0,o.jsxs)("div",{className:"relative group/sources",children:[(0,o.jsx)("div",{className:"bg-gray-700 text-white text-xs font-bold w-6 h-6 sm:w-7 sm:h-7 rounded-full flex items-center justify-center shadow-md hover:bg-gray-600 hover:scale-[1.1] transition-all duration-300 ease-out cursor-pointer",children:t}),(()=>{let t=["爱奇艺","腾讯视频","优酷","芒果TV","哔哩哔哩","Netflix","Disney+"],r=e.sort((e,r)=>{let o=t.indexOf(e),a=t.indexOf(r);return -1!==o&&-1!==a?o-a:-1!==o?-1:-1!==a?1:e.localeCompare(r)}),a=r.slice(0,6),s=r.length>6,n=r.length-6;return(0,o.jsx)("div",{className:"absolute bottom-full mb-2 opacity-0 invisible group-hover/sources:opacity-100 group-hover/sources:visible transition-all duration-200 ease-out delay-100 pointer-events-none z-50 right-0 sm:right-0 -translate-x-0 sm:translate-x-0",children:(0,o.jsxs)("div",{className:"bg-gray-800/90 backdrop-blur-sm text-white text-xs sm:text-xs rounded-lg shadow-xl border border-white/10 p-1.5 sm:p-2 min-w-[100px] sm:min-w-[120px] max-w-[140px] sm:max-w-[200px] overflow-hidden",children:[(0,o.jsx)("div",{className:"space-y-0.5 sm:space-y-1",children:a.map((e,t)=>(0,o.jsxs)("div",{className:"flex items-center gap-1 sm:gap-1.5",children:[(0,o.jsx)("div",{className:"w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-400 rounded-full flex-shrink-0"}),(0,o.jsx)("span",{className:"truncate text-[10px] sm:text-xs leading-tight",title:e,children:e})]},t))}),s&&(0,o.jsx)("div",{className:"mt-1 sm:mt-2 pt-1 sm:pt-1.5 border-t border-gray-700/50",children:(0,o.jsx)("div",{className:"flex items-center justify-center text-gray-400",children:(0,o.jsxs)("span",{className:"text-[10px] sm:text-xs font-medium",children:["+",n," 播放源"]})})}),(0,o.jsx)("div",{className:"absolute top-full right-2 sm:right-3 w-0 h-0 border-l-[4px] border-r-[4px] border-t-[4px] sm:border-l-[6px] sm:border-r-[6px] sm:border-t-[6px] border-transparent border-t-gray-800/90"})]})})})()]})})})()]}),M.showProgress&&void 0!==y&&(0,o.jsx)("div",{className:"mt-1 h-1 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,o.jsx)("div",{className:"h-full bg-green-500 transition-all duration-500 ease-out",style:{width:"".concat(y,"%")}})}),(0,o.jsxs)("div",{className:"mt-2 text-center",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("span",{className:"block text-sm font-semibold truncate text-gray-900 dark:text-gray-100 transition-colors duration-300 ease-in-out group-hover:text-green-600 dark:group-hover:text-green-400 peer",children:m}),(0,o.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-xs rounded-md shadow-lg opacity-0 invisible peer-hover:opacity-100 peer-hover:visible transition-all duration-200 ease-out delay-100 whitespace-nowrap pointer-events-none",children:[m,(0,o.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),M.showSourceName&&v&&(0,o.jsx)("span",{className:"block text-xs text-gray-500 dark:text-gray-400 mt-1",children:(0,o.jsx)("span",{className:"inline-block border rounded px-2 py-0.5 border-gray-500/60 dark:border-gray-400/60 transition-all duration-300 ease-in-out group-hover:border-green-500/60 group-hover:text-green-600 dark:group-hover:text-green-400",children:v})})]})]})});t.Z=(0,d.memo)(m)}}]);