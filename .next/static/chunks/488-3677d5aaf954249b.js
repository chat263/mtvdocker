"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[488],{6488:function(e,t,a){a.d(t,{Z:function(){return H}});var r=a(4393),s=a(4227);function l(){return(0,r.jsx)("button",{onClick:()=>window.history.back(),className:"w-10 h-10 p-2 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 transition-colors","aria-label":"Back",children:(0,r.jsx)(s.Z,{className:"w-full h-full"})})}var n=a(2554),d=a(4582),o=a(5769),i=a(2962),c=a(1189),x=a(6446),m=a(4087),u=a(8660),g=a(1698),h=a(4908),f=e=>{let{activePath:t}=e,a=(0,g.usePathname)(),s=null!=t?t:a,[l,f]=(0,h.useState)([{icon:n.Z,label:"首页",href:"/"},{icon:d.Z,label:"搜索",href:"/search"},{icon:o.Z,label:"电影",href:"/douban?type=movie"},{icon:i.Z,label:"剧集",href:"/douban?type=tv"},{icon:c.Z,label:"动漫",href:"/douban?type=anime"},{icon:x.Z,label:"综艺",href:"/douban?type=show"}]);(0,h.useEffect)(()=>{var e;let t=window.RUNTIME_CONFIG;(null==t?void 0:null===(e=t.CUSTOM_CATEGORIES)||void 0===e?void 0:e.length)>0&&f(e=>[...e,{icon:m.Z,label:"自定义",href:"/douban?type=custom"}])},[]);let y=e=>{var t;let a=null===(t=e.match(/type=([^&]+)/))||void 0===t?void 0:t[1],r=decodeURIComponent(s);return r===decodeURIComponent(e)||r.startsWith("/douban")&&r.includes("type=".concat(a))};return(0,r.jsx)("nav",{className:"md:hidden fixed left-0 right-0 z-[600] bg-white/90 backdrop-blur-xl border-t border-gray-200/50 overflow-hidden dark:bg-gray-900/80 dark:border-gray-700/50",style:{bottom:0,paddingBottom:"env(safe-area-inset-bottom)",minHeight:"calc(3.5rem + env(safe-area-inset-bottom))"},children:(0,r.jsx)("ul",{className:"flex items-center overflow-x-auto scrollbar-hide",children:l.map(e=>{let t=y(e.href);return(0,r.jsx)("li",{className:"flex-shrink-0",style:{width:"20vw",minWidth:"20vw"},children:(0,r.jsxs)(u.default,{href:e.href,className:"flex flex-col items-center justify-center w-full h-14 gap-1 text-xs",children:[(0,r.jsx)(e.icon,{className:"h-6 w-6 ".concat(t?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400")}),(0,r.jsx)("span",{className:t?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-300",children:e.label})]})},e.href)})})})},y=a(7119),b=a(6775),p=a(1177),v=a(4943),j=a(7676),w=a(282),N=a(477),k=a(546),C=a(4769),S=a(1183),E=a(2215),I=a(1349),_=a(3349),T=a(609),O=a(1125),Z=a(5018),P=a(8047),U=a(6440),A=a(6932),R=a(41),M=a(2709);let D=[{version:"2.4.1",date:"2025-08-15",added:[],changed:[],fixed:["对导入和 db 读取的配置文件做自检，防止 USERNAME 修改导致用户状态异常"]},{version:"2.4.0",date:"2025-08-15",added:["支持 kvrocks 存储（持久化 kv 存储）"],changed:[],fixed:["修复搜索结果排序不稳定的问题","导入数据时同时更新内存缓存的管理员配置"]},{version:"2.3.0",date:"2025-08-15",added:["支持站长导入导出整站数据"],changed:["仅允许站长操作配置文件","微调搜索结果过滤面板的移动端样式"],fixed:[]},{version:"2.2.1",date:"2025-08-14",added:[],changed:[],fixed:["修复了筛选 panel 打开时滚动页面 panel 不跟随的问题"]},{version:"2.2.0",date:"2025-08-14",added:["搜索结果支持按播放源、标题和年份筛选，支持按年份排序","搜索界面视频卡片展示年份信息，聚合卡片展示播放源"],changed:[],fixed:["修复 /api/search/resources 返回空的问题","修复 upstash 实例无法编辑自定义分类的问题"]},{version:"2.1.0",date:"2025-08-13",added:["支持通过订阅获取配置文件"],changed:["微调部分文案和 UI","删除部分无用代码"],fixed:[]},{version:"2.0.1",date:"2025-08-13",added:[],changed:["版本检查和变更日志请求 Github"],fixed:["微调管理面板样式"]},{version:"2.0.0",date:"2025-08-13",added:["支持配置文件在线配置和编辑","搜索页搜索框实时联想","去除对 localstorage 模式的支持"],changed:["播放记录删除按钮改为垃圾桶图标以消除歧义"],fixed:["限制设置面板的最大长度，防止超出视口"]},{version:"1.1.1",date:"2025-08-12",added:[],changed:["修正 zwei 提供的 cors proxy 地址","移除废弃代码"],fixed:["[运维] docker workflow release 日期使用东八区日期"]},{version:"1.1.0",date:"2025-08-12",added:["每日新番放送功能，展示每日新番放送的番剧"],changed:[],fixed:["修复远程 CHANGELOG 无法提取变更内容的问题"]},{version:"1.0.5",date:"2025-08-12",added:[],changed:["实现基于 Git 标签的自动 Release 工作流"],fixed:[]},{version:"1.0.4",date:"2025-08-11",added:["优化版本管理工作流，实现单点修改"],changed:["版本号现在从 CHANGELOG 自动提取，无需手动维护 VERSION.txt"],fixed:[]},{version:"1.0.3",date:"2025-08-11",added:[],changed:["升级播放器 Artplayer 至版本 5.2.5"],fixed:[]},{version:"1.0.2",date:"2025-08-11",added:[],changed:["版本号比较机制恢复为数字比较，仅当最新版本大于本地版本时才认为有更新","[运维] 自动替换 version.ts 中的版本号为 VERSION.txt 中的版本号"],fixed:[]},{version:"1.0.1",date:"2025-08-11",added:[],changed:[],fixed:["修复版本检查功能，只要与最新版本号不一致即认为有更新"]},{version:"1.0.0",date:"2025-08-10",added:["基于 Semantic Versioning 的版本号机制","版本信息面板，展示本地变更日志和远程更新日志"],changed:[],fixed:[]}],G=e=>{let{isOpen:t,onClose:a}=e,[s,l]=(0,h.useState)(!1),[n,d]=(0,h.useState)([]),[o,i]=(0,h.useState)(!1),[c,x]=(0,h.useState)(""),[m,u]=(0,h.useState)(!1);(0,h.useEffect)(()=>(l(!0),()=>l(!1)),[]),(0,h.useEffect)(()=>{t&&g()},[t]);let g=async()=>{try{let e=await fetch("https://raw.githubusercontent.com/MoonTechLab/LunaTV/main/CHANGELOG");if(e.ok){let t=await e.text(),a=f(t);if(d(a),a.length>0){let e=a[0];x(e.version),i((0,O.n4)(e.version)===O.qu.HAS_UPDATE)}}else console.error("获取远程变更日志失败:",e.status,e.statusText)}catch(e){console.error("获取远程变更日志失败:",e)}},f=e=>{let t=e.split("\n"),a=[],r=null,s=null,l=!1;for(let e of t){let t=e.trim(),n=t.match(/^## \[([\d.]+)\] - (\d{4}-\d{2}-\d{2})$/);if(n){r&&a.push(r),r={version:n[1],date:n[2],added:[],changed:[],fixed:[]},s=null,l=!0;continue}if(l&&r){if("### Added"===t){s="added";continue}if("### Changed"===t){s="changed";continue}if("### Fixed"===t){s="fixed";continue}if(t.startsWith("- ")&&s){let e=t.substring(2);"added"===s?r.added.push(e):"changed"===s?r.changed.push(e):"fixed"===s&&r.fixed.push(e)}}}return r&&a.push(r),a},y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=a&&o&&e.version===c;return(0,r.jsxs)("div",{className:"p-4 rounded-lg border ".concat(t?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-gray-50 dark:bg-gray-800/60 border-gray-200 dark:border-gray-700"),children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["v",e.version]}),t&&(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-full",children:"当前版本"}),s&&(0,r.jsxs)("span",{className:"px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full flex items-center gap-1",children:[(0,r.jsx)(Z.Z,{className:"w-3 h-3"}),"可更新"]})]}),(0,r.jsx)("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:e.date})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[e.added.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-green-700 dark:text-green-400 mb-2 flex items-center gap-1",children:[(0,r.jsx)(P.Z,{className:"w-4 h-4"}),"新增功能"]}),(0,r.jsx)("ul",{className:"space-y-1",children:e.added.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.changed.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-blue-700 dark:text-blue-400 mb-2 flex items-center gap-1",children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),"功能改进"]}),(0,r.jsx)("ul",{className:"space-y-1",children:e.changed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.fixed.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-purple-700 dark:text-purple-400 mb-2 flex items-center gap-1",children:[(0,r.jsx)(A.Z,{className:"w-4 h-4"}),"问题修复"]}),(0,r.jsx)("ul",{className:"space-y-1",children:e.fixed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]})]})]},e.version)},b=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000]",onClick:a}),(0,r.jsxs)("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-xl shadow-xl z-[1001] overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-gray-200",children:"版本信息"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2",children:[(0,r.jsxs)("span",{className:"px-2 sm:px-3 py-1 text-xs sm:text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full",children:["v",T.w]}),o&&(0,r.jsxs)("span",{className:"px-2 sm:px-3 py-1 text-xs sm:text-sm font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full flex items-center gap-1",children:[(0,r.jsx)(Z.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"有新版本可用"}),(0,r.jsx)("span",{className:"sm:hidden",children:"可更新"})]})]})]}),(0,r.jsx)("button",{onClick:a,className:"w-6 h-6 sm:w-8 sm:h-8 p-1 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"关闭",children:(0,r.jsx)(N.Z,{className:"w-full h-full"})})]}),(0,r.jsx)("div",{className:"p-3 sm:p-6 overflow-y-auto max-h-[calc(95vh-140px)] sm:max-h-[calc(90vh-120px)]",children:(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-6",children:[o&&(0,r.jsx)("div",{className:"bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 sm:p-4",children:(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-yellow-100 dark:bg-yellow-800/40 rounded-full flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(Z.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-600 dark:text-yellow-400"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-yellow-800 dark:text-yellow-200",children:"发现新版本"}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-yellow-700 dark:text-yellow-300 break-all",children:["v",T.w," → v",c]})]})]}),(0,r.jsxs)("a",{href:"https://github.com/MoonTechLab/LunaTV",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white text-xs sm:text-sm rounded-lg transition-colors shadow-sm w-full",children:[(0,r.jsx)(Z.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"前往仓库"]})]})}),!o&&(0,r.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 sm:p-4",children:(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 dark:bg-green-800/40 rounded-full flex items-center justify-center flex-shrink-0",children:(0,r.jsx)(R.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("h4",{className:"text-sm sm:text-base font-semibold text-green-800 dark:text-green-200",children:"当前为最新版本"}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-green-700 dark:text-green-300 break-all",children:["已是最新版本 v",T.w]})]})]}),(0,r.jsxs)("a",{href:"https://github.com/MoonTechLab/LunaTV",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-xs sm:text-sm rounded-lg transition-colors shadow-sm w-full",children:[(0,r.jsx)(R.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"前往仓库"]})]})}),o&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[(0,r.jsx)(Z.Z,{className:"w-5 h-5 text-yellow-500"}),"远程更新内容"]}),(0,r.jsx)("button",{onClick:()=>u(!m),className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 dark:bg-yellow-800/30 dark:hover:bg-yellow-800/50 dark:text-yellow-200 rounded-lg transition-colors text-sm w-full sm:w-auto",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(M.Z,{className:"w-4 h-4"}),"收起"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.Z,{className:"w-4 h-4"}),"查看更新内容"]})})]}),m&&n.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:n.filter(e=>!D.map(e=>e.version).includes(e.version)).map((e,t)=>(0,r.jsxs)("div",{className:"p-4 rounded-lg border ".concat(e.version===c?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-gray-50 dark:bg-gray-800/60 border-gray-200 dark:border-gray-700"),children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["v",e.version]}),e.version===c&&(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full flex items-center gap-1",children:"远程最新"})]}),(0,r.jsx)("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:e.date})]}),e.added&&e.added.length>0&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2 flex items-center gap-1",children:[(0,r.jsx)(P.Z,{className:"w-4 h-4"}),"新增功能"]}),(0,r.jsx)("ul",{className:"space-y-1",children:e.added.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.changed&&e.changed.length>0&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 mb-2 flex items-center gap-1",children:[(0,r.jsx)(U.Z,{className:"w-4 h-4"}),"功能改进"]}),(0,r.jsx)("ul",{className:"space-y-1",children:e.changed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.fixed&&e.fixed.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-purple-700 dark:text-purple-400 mb-2 flex items-center gap-1",children:[(0,r.jsx)(A.Z,{className:"w-4 h-4"}),"问题修复"]}),(0,r.jsx)("ul",{className:"space-y-1",children:e.fixed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]})]},t))})]}),(0,r.jsxs)("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4",children:[(0,r.jsx)("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 pb-3 sm:pb-4",children:"变更日志"}),(0,r.jsx)("div",{className:"space-y-4",children:D.map(e=>y(e,e.version===T.w,!1))})]})]})})]})]});return s&&t?(0,I.createPortal)(b,document.body):null},F=()=>{var e,t;let a=(0,g.useRouter)(),[s,l]=(0,h.useState)(!1),[n,d]=(0,h.useState)(!1),[o,i]=(0,h.useState)(!1),[c,x]=(0,h.useState)(!1),[m,u]=(0,h.useState)(null),[f,y]=(0,h.useState)("localstorage"),[b,Z]=(0,h.useState)(!1),[P,U]=(0,h.useState)(!0),[A,R]=(0,h.useState)(""),[M,D]=(0,h.useState)(!0),[F,L]=(0,h.useState)("direct"),[z,B]=(0,h.useState)("direct"),[V,Y]=(0,h.useState)(""),[H,J]=(0,h.useState)(!1),[q,W]=(0,h.useState)(!1),X=[{value:"direct",label:"直连（服务器直接请求豆瓣）"},{value:"cors-proxy-zwei",label:"Cors Proxy By Zwei"},{value:"cmliussss-cdn-tencent",label:"豆瓣 CDN By CMLiussss（腾讯云）"},{value:"cmliussss-cdn-ali",label:"豆瓣 CDN By CMLiussss（阿里云）"},{value:"cors-anywhere",label:"Cors Anywhere（20 qpm）"},{value:"custom",label:"自定义代理"}],$=[{value:"direct",label:"直连（浏览器直接请求豆瓣）"},{value:"server",label:"服务器代理（由服务器代理请求豆瓣）"},{value:"img3",label:"豆瓣精品 CDN（阿里云）"},{value:"cmliussss-cdn-tencent",label:"豆瓣 CDN By CMLiussss（腾讯云）"},{value:"cmliussss-cdn-ali",label:"豆瓣 CDN By CMLiussss（阿里云）"},{value:"custom",label:"自定义代理"}],[K,Q]=(0,h.useState)(""),[ee,et]=(0,h.useState)(""),[ea,er]=(0,h.useState)(!1),[es,el]=(0,h.useState)(""),[en,ed]=(0,h.useState)(null),[eo,ei]=(0,h.useState)(!0);(0,h.useEffect)(()=>{Z(!0)},[]),(0,h.useEffect)(()=>{var e;u((0,_.v)()),y((null===(e=window.RUNTIME_CONFIG)||void 0===e?void 0:e.STORAGE_TYPE)||"localstorage")},[]),(0,h.useEffect)(()=>{{var e,t,a,r;let s=localStorage.getItem("defaultAggregateSearch");null!==s&&U(JSON.parse(s));let l=localStorage.getItem("doubanDataSource"),n=(null===(e=window.RUNTIME_CONFIG)||void 0===e?void 0:e.DOUBAN_PROXY_TYPE)||"direct";null!==l?L(l):n&&L(n);let d=localStorage.getItem("doubanProxyUrl"),o=(null===(t=window.RUNTIME_CONFIG)||void 0===t?void 0:t.DOUBAN_PROXY)||"";null!==d?R(d):o&&R(o);let i=localStorage.getItem("doubanImageProxyType"),c=(null===(a=window.RUNTIME_CONFIG)||void 0===a?void 0:a.DOUBAN_IMAGE_PROXY_TYPE)||"direct";null!==i?B(i):c&&B(c);let x=localStorage.getItem("doubanImageProxyUrl"),m=(null===(r=window.RUNTIME_CONFIG)||void 0===r?void 0:r.DOUBAN_IMAGE_PROXY)||"";null!==x?Y(x):m&&Y(m);let u=localStorage.getItem("enableOptimization");null!==u&&D(JSON.parse(u))}},[]),(0,h.useEffect)(()=>{(async()=>{try{let e=await (0,O.Df)();ed(e)}catch(e){console.warn("版本检查失败:",e)}finally{ei(!1)}})()},[]),(0,h.useEffect)(()=>{let e=e=>{H&&!e.target.closest('[data-dropdown="douban-datasource"]')&&J(!1)};if(H)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[H]),(0,h.useEffect)(()=>{let e=e=>{q&&!e.target.closest('[data-dropdown="douban-image-proxy"]')&&W(!1)};if(q)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[q]);let ec=()=>{l(!1)},ex=async()=>{try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){console.error("注销请求失败:",e)}window.location.href="/"},em=()=>{i(!1),Q(""),et(""),el("")},eu=async()=>{if(el(""),!K){el("新密码不得为空");return}if(K!==ee){el("两次输入的密码不一致");return}er(!0);try{let e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:K})}),t=await e.json();if(!e.ok){el(t.error||"修改密码失败");return}i(!1),await ex()}catch(e){el("网络错误，请稍后重试")}finally{er(!1)}},eg=()=>{d(!1)},eh=e=>{U(e),localStorage.setItem("defaultAggregateSearch",JSON.stringify(e))},ef=e=>{R(e),localStorage.setItem("doubanProxyUrl",e)},ey=e=>{D(e),localStorage.setItem("enableOptimization",JSON.stringify(e))},eb=e=>{L(e),localStorage.setItem("doubanDataSource",e)},ep=e=>{B(e),localStorage.setItem("doubanImageProxyType",e)},ev=e=>{Y(e),localStorage.setItem("doubanImageProxyUrl",e)},ej=e=>{switch(e){case"cors-proxy-zwei":return{text:"Thanks to @Zwei",url:"https://github.com/bestzwei"};case"cmliussss-cdn-tencent":case"cmliussss-cdn-ali":return{text:"Thanks to @CMLiussss",url:"https://github.com/cmliu"};default:return null}},ew=(null==m?void 0:m.role)==="owner"||(null==m?void 0:m.role)==="admin",eN=(null==m?void 0:m.role)!=="owner"&&"localstorage"!==f,ek=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-transparent z-[1000]",onClick:ec}),(0,r.jsxs)("div",{className:"fixed top-14 right-4 w-56 bg-white dark:bg-gray-900 rounded-lg shadow-xl z-[1001] border border-gray-200/50 dark:border-gray-700/50 overflow-hidden select-none",children:[(0,r.jsx)("div",{className:"px-3 py-2.5 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-gray-50 to-gray-100/50 dark:from-gray-800 dark:to-gray-800/50",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"当前用户"}),(0,r.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ".concat("owner"===((null==m?void 0:m.role)||"user")?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"admin"===((null==m?void 0:m.role)||"user")?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"),children:(e=>{switch(e){case"owner":return"站长";case"admin":return"管理员";case"user":return"用户";default:return""}})((null==m?void 0:m.role)||"user")})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm truncate",children:(null==m?void 0:m.username)||"default"}),(0,r.jsxs)("div",{className:"text-[10px] text-gray-400 dark:text-gray-500",children:["数据存储：","localstorage"===f?"本地":f]})]})]})}),(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("button",{onClick:()=>{l(!1),d(!0)},className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",children:[(0,r.jsx)(p.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,r.jsx)("span",{className:"font-medium",children:"设置"})]}),ew&&(0,r.jsxs)("button",{onClick:()=>{a.push("/admin")},className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,r.jsx)("span",{className:"font-medium",children:"管理面板"})]}),eN&&(0,r.jsxs)("button",{onClick:()=>{l(!1),i(!0),Q(""),et(""),el("")},className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),(0,r.jsx)("span",{className:"font-medium",children:"修改密码"})]}),(0,r.jsx)("div",{className:"my-1 border-t border-gray-200 dark:border-gray-700"}),(0,r.jsxs)("button",{onClick:ex,className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-sm",children:[(0,r.jsx)(w.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-medium",children:"登出"})]}),(0,r.jsx)("div",{className:"my-1 border-t border-gray-200 dark:border-gray-700"}),(0,r.jsx)("button",{onClick:()=>{x(!0),ec()},className:"w-full px-3 py-2 text-center flex items-center justify-center text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-xs",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsxs)("span",{className:"font-mono",children:["v",T.w]}),!eo&&en&&en!==O.qu.FETCH_FAILED&&(0,r.jsx)("div",{className:"w-2 h-2 rounded-full -translate-y-2 ".concat(en===O.qu.HAS_UPDATE?"bg-yellow-500":en===O.qu.NO_UPDATE?"bg-green-400":"")})]})})]})]})]}),eC=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000]",onClick:eg}),(0,r.jsxs)("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-xl shadow-xl z-[1001] p-6 overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"本地设置"}),(0,r.jsx)("button",{onClick:()=>{var e,t,a,r;let s=(null===(e=window.RUNTIME_CONFIG)||void 0===e?void 0:e.DOUBAN_PROXY_TYPE)||"direct",l=(null===(t=window.RUNTIME_CONFIG)||void 0===t?void 0:t.DOUBAN_PROXY)||"",n=(null===(a=window.RUNTIME_CONFIG)||void 0===a?void 0:a.DOUBAN_IMAGE_PROXY_TYPE)||"direct",d=(null===(r=window.RUNTIME_CONFIG)||void 0===r?void 0:r.DOUBAN_IMAGE_PROXY)||"";U(!0),D(!0),R(l),L(s),B(n),Y(d),localStorage.setItem("defaultAggregateSearch",JSON.stringify(!0)),localStorage.setItem("enableOptimization",JSON.stringify(!0)),localStorage.setItem("doubanProxyUrl",l),localStorage.setItem("doubanDataSource",s),localStorage.setItem("doubanImageProxyType",n),localStorage.setItem("doubanImageProxyUrl",d)},className:"px-2 py-1 text-xs text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 border border-red-200 hover:border-red-300 dark:border-red-800 dark:hover:border-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"重置为默认设置",children:"恢复默认"})]}),(0,r.jsx)("button",{onClick:eg,className:"w-8 h-8 p-1 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close",children:(0,r.jsx)(N.Z,{className:"w-full h-full"})})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣数据代理"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"选择获取豆瓣数据的方式"})]}),(0,r.jsxs)("div",{className:"relative","data-dropdown":"douban-datasource",children:[(0,r.jsx)("button",{type:"button",onClick:()=>J(!H),className:"w-full px-3 py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:border-gray-400 dark:hover:border-gray-500 text-left",children:null===(e=X.find(e=>e.value===F))||void 0===e?void 0:e.label}),(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,r.jsx)(k.Z,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform duration-200 ".concat(H?"rotate-180":"")})}),H&&(0,r.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:X.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>{eb(e.value),J(!1)},className:"w-full px-3 py-2.5 text-left text-sm transition-colors duration-150 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 ".concat(F===e.value?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"),children:[(0,r.jsx)("span",{className:"truncate",children:e.label}),F===e.value&&(0,r.jsx)(C.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 ml-2"})]},e.value))})]}),ej(F)&&(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsxs)("button",{type:"button",onClick:()=>window.open(ej(F).url,"_blank"),className:"flex items-center justify-center gap-1.5 w-full px-3 text-xs text-gray-500 dark:text-gray-400 cursor-pointer",children:[(0,r.jsx)("span",{className:"font-medium",children:ej(F).text}),(0,r.jsx)(S.Z,{className:"w-3.5 opacity-70"})]})})]}),"custom"===F&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣代理地址"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"自定义代理服务器地址"})]}),(0,r.jsx)("input",{type:"text",className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 shadow-sm hover:border-gray-400 dark:hover:border-gray-500",placeholder:"例如: https://proxy.example.com/fetch?url=",value:A,onChange:e=>ef(e.target.value)})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣图片代理"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"选择获取豆瓣图片的方式"})]}),(0,r.jsxs)("div",{className:"relative","data-dropdown":"douban-image-proxy",children:[(0,r.jsx)("button",{type:"button",onClick:()=>W(!q),className:"w-full px-3 py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:border-gray-400 dark:hover:border-gray-500 text-left",children:null===(t=$.find(e=>e.value===z))||void 0===t?void 0:t.label}),(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,r.jsx)(k.Z,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform duration-200 ".concat(H?"rotate-180":"")})}),q&&(0,r.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:$.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>{ep(e.value),W(!1)},className:"w-full px-3 py-2.5 text-left text-sm transition-colors duration-150 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 ".concat(z===e.value?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"),children:[(0,r.jsx)("span",{className:"truncate",children:e.label}),z===e.value&&(0,r.jsx)(C.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 ml-2"})]},e.value))})]}),ej(z)&&(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsxs)("button",{type:"button",onClick:()=>window.open(ej(z).url,"_blank"),className:"flex items-center justify-center gap-1.5 w-full px-3 text-xs text-gray-500 dark:text-gray-400 cursor-pointer",children:[(0,r.jsx)("span",{className:"font-medium",children:ej(z).text}),(0,r.jsx)(S.Z,{className:"w-3.5 opacity-70"})]})})]}),"custom"===z&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣图片代理地址"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"自定义图片代理服务器地址"})]}),(0,r.jsx)("input",{type:"text",className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 shadow-sm hover:border-gray-400 dark:hover:border-gray-500",placeholder:"例如: https://proxy.example.com/fetch?url=",value:V,onChange:e=>ev(e.target.value)})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"默认聚合搜索结果"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"搜索时默认按标题和年份聚合显示结果"})]}),(0,r.jsx)("label",{className:"flex items-center cursor-pointer",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:P,onChange:e=>eh(e.target.checked)}),(0,r.jsx)("div",{className:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),(0,r.jsx)("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform peer-checked:translate-x-5"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"启用优选和测速"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"如出现播放器劫持问题可关闭"})]}),(0,r.jsx)("label",{className:"flex items-center cursor-pointer",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:M,onChange:e=>ey(e.target.checked)}),(0,r.jsx)("div",{className:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),(0,r.jsx)("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform peer-checked:translate-x-5"})]})})]})]}),(0,r.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"这些设置保存在本地浏览器中"})})]})]}),eS=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000]",onClick:em}),(0,r.jsxs)("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white dark:bg-gray-900 rounded-xl shadow-xl z-[1001] p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"修改密码"}),(0,r.jsx)("button",{onClick:em,className:"w-8 h-8 p-1 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close",children:(0,r.jsx)(N.Z,{className:"w-full h-full"})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"新密码"}),(0,r.jsx)("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"请输入新密码",value:K,onChange:e=>Q(e.target.value),disabled:ea})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"确认密码"}),(0,r.jsx)("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"请再次输入新密码",value:ee,onChange:e=>et(e.target.value),disabled:ea})]}),es&&(0,r.jsx)("div",{className:"text-red-500 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-md border border-red-200 dark:border-red-800",children:es})]}),(0,r.jsxs)("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("button",{onClick:em,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors",disabled:ea,children:"取消"}),(0,r.jsx)("button",{onClick:eu,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:ea||!K||!ee,children:ea?"修改中...":"确认修改"})]}),(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"修改密码后需要重新登录"})})]})]});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>{l(!s)},className:"w-10 h-10 p-2 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 transition-colors","aria-label":"User Menu",children:(0,r.jsx)(E.Z,{className:"w-full h-full"})}),en===O.qu.HAS_UPDATE&&(0,r.jsx)("div",{className:"absolute top-[2px] right-[2px] w-2 h-2 bg-yellow-500 rounded-full"})]}),s&&b&&(0,I.createPortal)(ek,document.body),n&&b&&(0,I.createPortal)(eC,document.body),o&&b&&(0,I.createPortal)(eS,document.body),(0,r.jsx)(G,{isOpen:c,onClose:()=>x(!1)})]})};var L=e=>{let{showBackButton:t=!1}=e,{siteName:a}=(0,y.W)();return(0,r.jsxs)("header",{className:"md:hidden relative w-full bg-white/70 backdrop-blur-xl border-b border-gray-200/50 shadow-sm dark:bg-gray-900/70 dark:border-gray-700/50",children:[(0,r.jsxs)("div",{className:"h-12 flex items-center justify-between px-4",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:t&&(0,r.jsx)(l,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(b.T,{}),(0,r.jsx)(F,{})]})]}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,r.jsx)(u.default,{href:"/",className:"text-2xl font-bold text-green-600 tracking-tight hover:opacity-80 transition-opacity",children:a})})]})},z=a(8706);let B=(0,h.createContext)({isCollapsed:!1}),V=()=>{let{siteName:e}=(0,y.W)();return(0,r.jsx)(u.default,{href:"/",className:"flex items-center justify-center h-16 select-none hover:opacity-80 transition-opacity duration-200",children:(0,r.jsx)("span",{className:"text-2xl font-bold text-green-600 tracking-tight",children:e})})};var Y=e=>{let{onToggle:t,activePath:a="/"}=e,s=(0,g.useRouter)(),l=(0,g.usePathname)(),f=(0,g.useSearchParams)(),[y,b]=(0,h.useState)(()=>"boolean"==typeof window.__sidebarCollapsed&&window.__sidebarCollapsed);(0,h.useLayoutEffect)(()=>{let e=localStorage.getItem("sidebarCollapsed");if(null!==e){let t=JSON.parse(e);b(t),window.__sidebarCollapsed=t}},[]),(0,h.useLayoutEffect)(()=>{"undefined"!=typeof document&&(y?document.documentElement.dataset.sidebarCollapsed="true":delete document.documentElement.dataset.sidebarCollapsed)},[y]);let[p,v]=(0,h.useState)(a);(0,h.useEffect)(()=>{a?v(a):v((()=>{let e=f.toString();return e?"".concat(l,"?").concat(e):l})())},[a,l,f]);let j=(0,h.useCallback)(()=>{let e=!y;b(e),localStorage.setItem("sidebarCollapsed",JSON.stringify(e)),window.__sidebarCollapsed=e,null==t||t(e)},[y,t]),w=(0,h.useCallback)(()=>{s.push("/search")},[s]),[N,k]=(0,h.useState)([{icon:o.Z,label:"电影",href:"/douban?type=movie"},{icon:i.Z,label:"剧集",href:"/douban?type=tv"},{icon:c.Z,label:"动漫",href:"/douban?type=anime"},{icon:x.Z,label:"综艺",href:"/douban?type=show"}]);return(0,h.useEffect)(()=>{var e;let t=window.RUNTIME_CONFIG;(null==t?void 0:null===(e=t.CUSTOM_CATEGORIES)||void 0===e?void 0:e.length)>0&&k(e=>[...e,{icon:m.Z,label:"自定义",href:"/douban?type=custom"}])},[]),(0,r.jsx)(B.Provider,{value:{isCollapsed:y},children:(0,r.jsxs)("div",{className:"hidden md:flex",children:[(0,r.jsx)("aside",{"data-sidebar":!0,className:"fixed top-0 left-0 h-screen bg-white/40 backdrop-blur-xl transition-all duration-300 border-r border-gray-200/50 z-10 shadow-lg dark:bg-gray-900/70 dark:border-gray-700/50 ".concat(y?"w-16":"w-64"),style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:(0,r.jsxs)("div",{className:"flex h-full flex-col",children:[(0,r.jsxs)("div",{className:"relative h-16",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center transition-opacity duration-200 ".concat(y?"opacity-0":"opacity-100"),children:(0,r.jsx)("div",{className:"w-[calc(100%-4rem)] flex justify-center",children:!y&&(0,r.jsx)(V,{})})}),(0,r.jsx)("button",{onClick:j,className:"absolute top-1/2 -translate-y-1/2 flex items-center justify-center w-8 h-8 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100/50 transition-colors duration-200 z-10 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700/50 ".concat(y?"left-1/2 -translate-x-1/2":"right-2"),children:(0,r.jsx)(z.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("nav",{className:"px-2 mt-4 space-y-1",children:[(0,r.jsxs)(u.default,{href:"/",onClick:()=>v("/"),"data-active":"/"===p,className:"group flex items-center rounded-lg px-2 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 font-medium transition-colors duration-200 min-h-[40px] dark:text-gray-300 dark:hover:text-green-400 dark:data-[active=true]:bg-green-500/10 dark:data-[active=true]:text-green-400 ".concat(y?"w-full max-w-none mx-0":"mx-0"," gap-3 justify-start"),children:[(0,r.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,r.jsx)(n.Z,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600 data-[active=true]:text-green-700 dark:text-gray-400 dark:group-hover:text-green-400 dark:data-[active=true]:text-green-400"})}),!y&&(0,r.jsx)("span",{className:"whitespace-nowrap transition-opacity duration-200 opacity-100",children:"首页"})]}),(0,r.jsxs)(u.default,{href:"/search",onClick:e=>{e.preventDefault(),w(),v("/search")},"data-active":"/search"===p,className:"group flex items-center rounded-lg px-2 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 font-medium transition-colors duration-200 min-h-[40px] dark:text-gray-300 dark:hover:text-green-400 dark:data-[active=true]:bg-green-500/10 dark:data-[active=true]:text-green-400 ".concat(y?"w-full max-w-none mx-0":"mx-0"," gap-3 justify-start"),children:[(0,r.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,r.jsx)(d.Z,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600 data-[active=true]:text-green-700 dark:text-gray-400 dark:group-hover:text-green-400 dark:data-[active=true]:text-green-400"})}),!y&&(0,r.jsx)("span",{className:"whitespace-nowrap transition-opacity duration-200 opacity-100",children:"搜索"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-2 pt-4",children:(0,r.jsx)("div",{className:"space-y-1",children:N.map(e=>{var t;let a=null===(t=e.href.match(/type=([^&]+)/))||void 0===t?void 0:t[1],s=decodeURIComponent(p),l=s===decodeURIComponent(e.href)||s.startsWith("/douban")&&s.includes("type=".concat(a)),n=e.icon;return(0,r.jsxs)(u.default,{href:e.href,onClick:()=>v(e.href),"data-active":l,className:"group flex items-center rounded-lg px-2 py-2 pl-4 text-sm text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 transition-colors duration-200 min-h-[40px] dark:text-gray-300 dark:hover:text-green-400 dark:data-[active=true]:bg-green-500/10 dark:data-[active=true]:text-green-400 ".concat(y?"w-full max-w-none mx-0":"mx-0"," gap-3 justify-start"),children:[(0,r.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,r.jsx)(n,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600 data-[active=true]:text-green-700 dark:text-gray-400 dark:group-hover:text-green-400 dark:data-[active=true]:text-green-400"})}),!y&&(0,r.jsx)("span",{className:"whitespace-nowrap transition-opacity duration-200 opacity-100",children:e.label})]},e.label)})})})]})}),(0,r.jsx)("div",{className:"transition-all duration-300 sidebar-offset ".concat(y?"w-16":"w-64")})]})})},H=e=>{let{children:t,activePath:a="/"}=e;return(0,r.jsxs)("div",{className:"w-full min-h-screen",children:[(0,r.jsx)(L,{showBackButton:["/play"].includes(a)}),(0,r.jsxs)("div",{className:"flex md:grid md:grid-cols-[auto_1fr] w-full min-h-screen md:min-h-auto",children:[(0,r.jsx)("div",{className:"hidden md:block",children:(0,r.jsx)(Y,{activePath:a})}),(0,r.jsxs)("div",{className:"relative min-w-0 flex-1 transition-all duration-300",children:[["/play"].includes(a)&&(0,r.jsx)("div",{className:"absolute top-3 left-1 z-20 hidden md:flex",children:(0,r.jsx)(l,{})}),(0,r.jsxs)("div",{className:"absolute top-2 right-4 z-20 hidden md:flex items-center gap-2",children:[(0,r.jsx)(b.T,{}),(0,r.jsx)(F,{})]}),(0,r.jsx)("main",{className:"flex-1 md:min-h-0 mb-14 md:mb-0",style:{paddingBottom:"calc(3.5rem + env(safe-area-inset-bottom))"},children:t})]})]}),(0,r.jsx)("div",{className:"md:hidden",children:(0,r.jsx)(f,{activePath:a})})]})}},7119:function(e,t,a){a.d(t,{SiteProvider:function(){return d},W:function(){return n}});var r=a(4393),s=a(4908);let l=(0,s.createContext)({siteName:"MoonTV",announcement:"本网站仅提供影视信息搜索服务，所有内容均来自第三方网站。本站不存储任何视频资源，不对任何内容的准确性、合法性、完整性负责。"}),n=()=>(0,s.useContext)(l);function d(e){let{children:t,siteName:a,announcement:s}=e;return(0,r.jsx)(l.Provider,{value:{siteName:a,announcement:s},children:t})}},6775:function(e,t,a){a.d(t,{T:function(){return i}});var r=a(4393),s=a(3824),l=a(1634),n=a(1698),d=a(2132),o=a(4908);function i(){let[e,t]=(0,o.useState)(!1),{setTheme:a,resolvedTheme:i}=(0,d.F)(),c=(0,n.usePathname)(),x=e=>{let t=document.querySelector('meta[name="theme-color"]');if(t)t.setAttribute("content","dark"===e?"#0c111c":"#f9fbfe");else{let t=document.createElement("meta");t.name="theme-color",t.content="dark"===e?"#0c111c":"#f9fbfe",document.head.appendChild(t)}};return((0,o.useEffect)(()=>{t(!0)},[]),(0,o.useEffect)(()=>{e&&x(i)},[e,i,c]),e)?(0,r.jsx)("button",{onClick:()=>{let e="dark"===i?"light":"dark";if(x(e),!document.startViewTransition){a(e);return}document.startViewTransition(()=>{a(e)})},className:"w-10 h-10 p-2 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 transition-colors","aria-label":"Toggle theme",children:"dark"===i?(0,r.jsx)(s.Z,{className:"w-full h-full"}):(0,r.jsx)(l.Z,{className:"w-full h-full"})}):(0,r.jsx)("div",{className:"w-10 h-10"})}},3349:function(e,t,a){a.d(t,{v:function(){return r}});function r(){try{let e=document.cookie.split(";").reduce((e,t)=>{let a=t.trim(),r=a.indexOf("=");if(r>0){let t=a.substring(0,r),s=a.substring(r+1);t&&s&&(e[t]=s)}return e},{}).auth;if(!e)return null;let t=decodeURIComponent(e);return t.includes("%")&&(t=decodeURIComponent(t)),JSON.parse(t)}catch(e){return null}}},609:function(e,t,a){a.d(t,{w:function(){return r}});let r="2.4.1"},1125:function(e,t,a){a.d(t,{Df:function(){return n},n4:function(){return o},qu:function(){return s}});var r,s,l=a(609);async function n(){try{let e=await d("https://raw.githubusercontent.com/MoonTechLab/LunaTV/main/VERSION.txt");if(e)return o(e);let t=await d(["https://raw.githubusercontent.com/MoonTechLab/LunaTV/main/VERSION.txt"][1]);if(t)return o(t);return"fetch_failed"}catch(e){return console.error("版本检查失败:",e),"fetch_failed"}}async function d(e){try{let t=new AbortController,a=setTimeout(()=>t.abort(),5e3),r=Date.now(),s=e.includes("?")?"".concat(e,"&_t=").concat(r):"".concat(e,"?_t=").concat(r),l=await fetch(s,{method:"GET",signal:t.signal,headers:{"Content-Type":"text/plain"}});if(clearTimeout(a),!l.ok)throw Error("HTTP error! status: ".concat(l.status));return(await l.text()).trim()}catch(t){return console.warn("从 ".concat(e," 获取版本信息失败:"),t),null}}function o(e){if(e===l.w)return"no_update";try{let t=l.w.split(".").map(e=>{let t=parseInt(e,10);if(isNaN(t)||t<0)throw Error("无效的版本号格式: ".concat(l.w));return t}),a=e.split(".").map(t=>{let a=parseInt(t,10);if(isNaN(a)||a<0)throw Error("无效的版本号格式: ".concat(e));return a}),r=e=>{if(e.length>=3)return e.slice(0,3);{let t=[...e];for(;t.length<3;)t.push(0);return t}},s=r(t),n=r(a);for(let e=0;e<3;e++){if(n[e]>s[e])return"has_update";if(n[e]<s[e])break}return"no_update"}catch(t){return console.error("版本号比较失败:",t),e!==l.w?"has_update":"no_update"}}(r=s||(s={})).HAS_UPDATE="has_update",r.NO_UPDATE="no_update",r.FETCH_FAILED="fetch_failed"}}]);