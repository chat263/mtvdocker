"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{1187:function(e,t,o){o.d(t,{Z:function(){return a}});var r=o(4393);let a=e=>{let{aspectRatio:t}=e;return(0,r.jsx)("div",{className:"w-full ".concat(t," rounded-lg"),style:{background:"linear-gradient(90deg, var(--skeleton-color) 25%, var(--skeleton-highlight) 50%, var(--skeleton-color) 75%)",backgroundSize:"200% 100%",animation:"shine 1.5s infinite"},children:(0,r.jsx)("style",{children:"\n      @keyframes shine {\n        0% { background-position: -200% 0; }\n        100% { background-position: 200% 0; }\n      }\n      \n      /* 亮色模式变量 */\n      :root {\n        --skeleton-color: #f0f0f0;\n        --skeleton-highlight: #e0e0e0;\n      }\n      \n      /* 暗色模式变量 */\n      @media (prefers-color-scheme: dark) {\n        :root {\n          --skeleton-color: #2d2d2d;\n          --skeleton-highlight: #3d3d3d;\n        }\n      }\n      \n      .dark {\n        --skeleton-color: #2d2d2d;\n        --skeleton-highlight: #3d3d3d;\n      }\n    "})})}},6501:function(e,t,o){o.d(t,{Z:function(){return g}});var r=o(4393),a=o(4727),s=o(5324),n=o(4187),l=o(9564),i=o(7944),c=o(1698),d=o(4908),u=o(7467),h=o(1802),p=o(1187);function g(e){var t,o,g,v,m,x,b,f;let{id:w,title:y="",query:k="",poster:j="",episodes:N,source:C,source_name:P,progress:_=0,year:D,from:E,currentEpisode:S,douban_id:R,onDelete:z,rate:L,items:Z,type:q="",isBangumi:H=!1}=e,B=(0,c.useRouter)(),[I,Y]=(0,d.useState)(!1),[F,M]=(0,d.useState)(!1),U="search"===E&&!!(null==Z?void 0:Z.length),O=(0,d.useMemo)(()=>{if(!U||!Z)return null;let e=new Map,t=new Map;Z.forEach(o=>{var r;o.douban_id&&0!==o.douban_id&&e.set(o.douban_id,(e.get(o.douban_id)||0)+1);let a=(null===(r=o.episodes)||void 0===r?void 0:r.length)||0;a>0&&t.set(a,(t.get(a)||0)+1)});let o=e=>{let t,o=0;return e.forEach((e,r)=>{e>o&&(o=e,t=r)}),t};return{first:Z[0],mostFrequentDoubanId:o(e),mostFrequentEpisodes:o(t)||0}},[U,Z]),T=null!==(o=null==O?void 0:O.first.title)&&void 0!==o?o:y,A=null!==(g=null==O?void 0:O.first.poster)&&void 0!==g?g:j,J=null!==(v=null==O?void 0:O.first.source)&&void 0!==v?v:C,V=null!==(m=null==O?void 0:O.first.id)&&void 0!==m?m:w,W=null!==(x=null==O?void 0:O.mostFrequentDoubanId)&&void 0!==x?x:R,G=null!==(b=null==O?void 0:O.mostFrequentEpisodes)&&void 0!==b?b:N,K=null!==(f=null==O?void 0:O.first.year)&&void 0!==f?f:D,Q=k||"",X=U?(null==O?void 0:null===(t=O.first.episodes)||void 0===t?void 0:t.length)===1?"movie":"tv":q;(0,d.useEffect)(()=>{if("douban"===E||"search"===E||!J||!V)return;(async()=>{try{let e=await (0,u.at)(J,V);Y(e)}catch(e){throw Error("检查收藏状态失败")}})();let e=(0,u.sO)(J,V);return(0,u.rq)("favoritesUpdated",t=>{Y(!!t[e])})},[E,J,V]);let $=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"douban"!==E&&"search"!==E&&J&&V)try{I?(await (0,u.r7)(J,V),Y(!1)):(await (0,u.qn)(J,V,{title:T,source_name:P||"",year:K||"",cover:A,total_episodes:null!=G?G:1,save_time:Date.now()}),Y(!0))}catch(e){throw Error("切换收藏状态失败")}},[E,J,V,T,P,K,A,G,I]),ee=(0,d.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"playrecord"===E&&J&&V)try{await (0,u.Ji)(J,V),null==z||z()}catch(e){throw Error("删除播放记录失败")}},[E,J,V,z]),et=(0,d.useCallback)(()=>{"douban"===E?B.push("/play?title=".concat(encodeURIComponent(T.trim())).concat(K?"&year=".concat(K):"").concat(X?"&stype=".concat(X):"")):J&&V&&B.push("/play?source=".concat(J,"&id=").concat(V,"&title=").concat(encodeURIComponent(T)).concat(K?"&year=".concat(K):"").concat(U?"&prefer=true":"").concat(Q?"&stitle=".concat(encodeURIComponent(Q.trim())):"").concat(X?"&stype=".concat(X):""))},[E,J,V,B,T,K,U,Q,X]),eo=(0,d.useMemo)(()=>{let e={playrecord:{showSourceName:!0,showProgress:!0,showPlayButton:!0,showHeart:!0,showCheckCircle:!0,showDoubanLink:!1,showRating:!1,showYear:!1},favorite:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!0,showCheckCircle:!1,showDoubanLink:!1,showRating:!1,showYear:!1},search:{showSourceName:!0,showProgress:!1,showPlayButton:!0,showHeart:!1,showCheckCircle:!1,showDoubanLink:!1,showRating:!1,showYear:!0},douban:{showSourceName:!1,showProgress:!1,showPlayButton:!0,showHeart:!1,showCheckCircle:!1,showDoubanLink:!0,showRating:!!L,showYear:!1}};return e[E]||e.search},[E,U,W,L]);return(0,r.jsxs)("div",{className:"group relative w-full rounded-lg bg-transparent cursor-pointer transition-all duration-300 ease-in-out hover:scale-[1.05] hover:z-[500]",onClick:et,children:[(0,r.jsxs)("div",{className:"relative aspect-[2/3] overflow-hidden rounded-lg",children:[!F&&(0,r.jsx)(p.Z,{aspectRatio:"aspect-[2/3]"}),(0,r.jsx)(i.default,{src:(0,h.a8)(A),alt:T,fill:!0,className:"object-cover",referrerPolicy:"no-referrer",loading:"lazy",onLoadingComplete:()=>M(!0),onError:e=>{let t=e.target;t.dataset.retried||(t.dataset.retried="true",setTimeout(()=>{t.src=(0,h.a8)(A)},2e3))}}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 transition-opacity duration-300 ease-in-out group-hover:opacity-100"}),eo.showPlayButton&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-300 ease-in-out delay-75 group-hover:opacity-100 group-hover:scale-100",children:(0,r.jsx)(a.Z,{size:50,strokeWidth:.8,className:"text-white fill-transparent transition-all duration-300 ease-out hover:fill-green-500 hover:scale-[1.1]"})}),(eo.showHeart||eo.showCheckCircle)&&(0,r.jsxs)("div",{className:"absolute bottom-3 right-3 flex gap-3 opacity-0 translate-y-2 transition-all duration-300 ease-in-out group-hover:opacity-100 group-hover:translate-y-0",children:[eo.showCheckCircle&&(0,r.jsx)(s.Z,{onClick:ee,size:20,className:"text-white transition-all duration-300 ease-out hover:stroke-red-500 hover:scale-[1.1]"}),eo.showHeart&&(0,r.jsx)(n.Z,{onClick:$,size:20,className:"transition-all duration-300 ease-out ".concat(I?"fill-red-600 stroke-red-600":"fill-transparent stroke-white hover:stroke-red-400"," hover:scale-[1.1]")})]}),eo.showYear&&K&&"unknown"!==K&&""!==K.trim()&&(0,r.jsx)("div",{className:"absolute top-2 bg-black/50 text-white text-xs font-medium px-2 py-1 rounded backdrop-blur-sm shadow-sm transition-all duration-300 ease-out group-hover:opacity-90 ".concat(eo.showDoubanLink&&W&&0!==W?"left-2 group-hover:left-11":"left-2"),children:K}),eo.showRating&&L&&(0,r.jsx)("div",{className:"absolute top-2 right-2 bg-pink-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:L}),G&&G>1&&(0,r.jsx)("div",{className:"absolute top-2 right-2 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-md shadow-md transition-all duration-300 ease-out group-hover:scale-110",children:S?"".concat(S,"/").concat(G):G}),eo.showDoubanLink&&W&&0!==W&&(0,r.jsx)("a",{href:H?"https://bgm.tv/subject/".concat(W.toString()):"https://movie.douban.com/subject/".concat(W.toString()),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute top-2 left-2 opacity-0 -translate-x-2 transition-all duration-300 ease-in-out delay-100 group-hover:opacity-100 group-hover:translate-x-0",children:(0,r.jsx)("div",{className:"bg-green-500 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md hover:bg-green-600 hover:scale-[1.1] transition-all duration-300 ease-out",children:(0,r.jsx)(l.Z,{size:16})})}),U&&Z&&Z.length>0&&(()=>{let e=Array.from(new Set(Z.map(e=>e.source_name))),t=e.length;return(0,r.jsx)("div",{className:"absolute bottom-2 right-2 opacity-0 transition-all duration-300 ease-in-out delay-75 group-hover:opacity-100",children:(0,r.jsxs)("div",{className:"relative group/sources",children:[(0,r.jsx)("div",{className:"bg-gray-700 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-md hover:bg-gray-600 hover:scale-[1.1] transition-all duration-300 ease-out cursor-pointer",children:t}),(()=>{let t=["爱奇艺","腾讯视频","优酷","芒果TV","哔哩哔哩","Netflix","Disney+"],o=e.sort((e,o)=>{let r=t.indexOf(e),a=t.indexOf(o);return -1!==r&&-1!==a?r-a:-1!==r?-1:-1!==a?1:e.localeCompare(o)}),a=o.slice(0,6),s=o.length>6,n=o.length-6;return(0,r.jsx)("div",{className:"absolute bottom-full right-0 mb-2 opacity-0 invisible group-hover/sources:opacity-100 group-hover/sources:visible transition-all duration-200 ease-out delay-100 pointer-events-none z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800/90 backdrop-blur-sm text-white text-xs rounded-lg shadow-xl border border-white/10 p-2 min-w-[120px] max-w-[200px]",children:[(0,r.jsx)("div",{className:"space-y-1",children:a.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-1 h-1 bg-blue-400 rounded-full flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate text-xs",title:e,children:e})]},t))}),s&&(0,r.jsx)("div",{className:"mt-2 pt-1.5 border-t border-gray-700/50",children:(0,r.jsx)("div",{className:"flex items-center justify-center text-gray-400",children:(0,r.jsxs)("span",{className:"text-xs font-medium",children:["+",n," 播放源"]})})}),(0,r.jsx)("div",{className:"absolute top-full right-3 w-0 h-0 border-l-[6px] border-r-[6px] border-t-[6px] border-transparent border-t-gray-800/90"})]})})})()]})})})()]}),eo.showProgress&&void 0!==_&&(0,r.jsx)("div",{className:"mt-1 h-1 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-green-500 transition-all duration-500 ease-out",style:{width:"".concat(_,"%")}})}),(0,r.jsxs)("div",{className:"mt-2 text-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"block text-sm font-semibold truncate text-gray-900 dark:text-gray-100 transition-colors duration-300 ease-in-out group-hover:text-green-600 dark:group-hover:text-green-400 peer",children:T}),(0,r.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-xs rounded-md shadow-lg opacity-0 invisible peer-hover:opacity-100 peer-hover:visible transition-all duration-200 ease-out delay-100 whitespace-nowrap pointer-events-none",children:[T,(0,r.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),eo.showSourceName&&P&&(0,r.jsx)("span",{className:"block text-xs text-gray-500 dark:text-gray-400 mt-1",children:(0,r.jsx)("span",{className:"inline-block border rounded px-2 py-0.5 border-gray-500/60 dark:border-gray-400/60 transition-all duration-300 ease-in-out group-hover:border-green-500/60 group-hover:text-green-600 dark:group-hover:text-green-400",children:P})})]})]})}}}]);