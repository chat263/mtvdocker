(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8127:function(e,t,a){Promise.resolve().then(a.bind(a,7617))},7617:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var r=a(4393),s=a(4123);let n=(0,s.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var o=a(8660),i=a(4908),c=a(1829),l=a(7467),d=a(5384),m=e=>{let{options:t,active:a,onChange:s,className:n}=e,o=(0,i.useRef)(null),c=(0,i.useRef)([]),[l,d]=(0,i.useState)({left:0,width:0}),m=t.findIndex(e=>e.value===a),u=()=>{if(m>=0&&c.current[m]&&o.current){let e=c.current[m],t=o.current;if(e&&t){let a=e.getBoundingClientRect(),r=t.getBoundingClientRect();a.width>0&&d({left:a.left-r.left,width:a.width})}}};return(0,i.useEffect)(()=>{let e=setTimeout(u,0);return()=>clearTimeout(e)},[]),(0,i.useEffect)(()=>{let e=setTimeout(u,0);return()=>clearTimeout(e)},[m]),(0,r.jsxs)("div",{ref:o,className:"relative inline-flex bg-gray-300/80 rounded-full p-1 dark:bg-gray-700 ".concat(n||""),children:[l.width>0&&(0,r.jsx)("div",{className:"absolute top-1 bottom-1 bg-white dark:bg-gray-500 rounded-full shadow-sm transition-all duration-300 ease-out",style:{left:"".concat(l.left,"px"),width:"".concat(l.width,"px")}}),t.map((e,t)=>{let n=a===e.value;return(0,r.jsx)("button",{ref:e=>{c.current[t]=e},onClick:()=>s(e.value),className:"relative z-10 w-16 px-3 py-1 text-xs sm:w-20 sm:py-2 sm:text-sm rounded-full font-medium transition-all duration-200 cursor-pointer ".concat(n?"text-gray-900 dark:text-gray-100":"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100"),children:e.label},e.value)})]})};let u=(0,s.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);function g(e){let{children:t,scrollDistance:a=1e3}=e,s=(0,i.useRef)(null),[o,c]=(0,i.useState)(!1),[l,d]=(0,i.useState)(!1),[m,g]=(0,i.useState)(!1),h=()=>{if(s.current){let{scrollWidth:e,clientWidth:t,scrollLeft:a}=s.current;d(e-(a+t)>1),c(a>1)}};return(0,i.useEffect)(()=>{h(),window.addEventListener("resize",h);let e=new ResizeObserver(()=>{h()});return s.current&&e.observe(s.current),()=>{window.removeEventListener("resize",h),e.disconnect()}},[t]),(0,i.useEffect)(()=>{if(s.current){let e=new MutationObserver(()=>{setTimeout(h,100)});return e.observe(s.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),()=>e.disconnect()}},[]),(0,r.jsxs)("div",{className:"relative",onMouseEnter:()=>{g(!0),h()},onMouseLeave:()=>g(!1),children:[(0,r.jsx)("div",{ref:s,className:"flex space-x-6 overflow-x-auto scrollbar-hide py-1 sm:py-2 pb-12 sm:pb-14 px-4 sm:px-6",onScroll:h,children:t}),o&&(0,r.jsx)("div",{className:"hidden sm:flex absolute left-0 top-0 bottom-0 w-16 items-center justify-center z-[600] transition-opacity duration-200 ".concat(m?"opacity-100":"opacity-0"),style:{background:"transparent",pointerEvents:"none"},children:(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",style:{top:"40%",bottom:"60%",left:"-4.5rem",pointerEvents:"auto"},children:(0,r.jsx)("button",{onClick:()=>{s.current&&s.current.scrollBy({left:-a,behavior:"smooth"})},className:"w-12 h-12 bg-white/95 rounded-full shadow-lg flex items-center justify-center hover:bg-white border border-gray-200 transition-transform hover:scale-105 dark:bg-gray-800/90 dark:hover:bg-gray-700 dark:border-gray-600",children:(0,r.jsx)(u,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})})})}),l&&(0,r.jsx)("div",{className:"hidden sm:flex absolute right-0 top-0 bottom-0 w-16 items-center justify-center z-[600] transition-opacity duration-200 ".concat(m?"opacity-100":"opacity-0"),style:{background:"transparent",pointerEvents:"none"},children:(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",style:{top:"40%",bottom:"60%",right:"-4.5rem",pointerEvents:"auto"},children:(0,r.jsx)("button",{onClick:()=>{s.current&&s.current.scrollBy({left:a,behavior:"smooth"})},className:"w-12 h-12 bg-white/95 rounded-full shadow-lg flex items-center justify-center hover:bg-white border border-gray-200 transition-transform hover:scale-105 dark:bg-gray-800/90 dark:hover:bg-gray-700 dark:border-gray-600",children:(0,r.jsx)(n,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})})})})]})}var h=a(5629);function x(e){let{className:t}=e,[a,s]=(0,i.useState)([]),[n,o]=(0,i.useState)(!0),c=e=>{s(Object.entries(e).map(e=>{let[t,a]=e;return{...a,key:t}}).sort((e,t)=>t.save_time-e.save_time))};if((0,i.useEffect)(()=>((async()=>{try{o(!0);let e=await (0,l.Rr)();c(e)}catch(e){console.error("获取播放记录失败:",e),s([])}finally{o(!1)}})(),(0,l.rq)("playRecordsUpdated",e=>{c(e)})),[]),!n&&0===a.length)return null;let d=e=>0===e.total_time?0:e.play_time/e.total_time*100,m=e=>{let[t,a]=e.split("+");return{source:t,id:a}};return(0,r.jsxs)("section",{className:"mb-8 ".concat(t||""),children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"继续观看"}),!n&&a.length>0&&(0,r.jsx)("button",{className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:async()=>{await (0,l.jz)(),s([])},children:"清空"})]}),(0,r.jsx)(g,{children:n?Array.from({length:6}).map((e,t)=>(0,r.jsxs)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:[(0,r.jsx)("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-lg bg-gray-200 animate-pulse dark:bg-gray-800",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-300 dark:bg-gray-700"})}),(0,r.jsx)("div",{className:"mt-2 h-4 bg-gray-200 rounded animate-pulse dark:bg-gray-800"}),(0,r.jsx)("div",{className:"mt-1 h-3 bg-gray-200 rounded animate-pulse dark:bg-gray-800"})]},t)):a.map(e=>{let{source:t,id:a}=m(e.key);return(0,r.jsx)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:(0,r.jsx)(h.Z,{id:a,title:e.title,poster:e.cover,year:e.year,source:t,source_name:e.source_name,progress:d(e),episodes:e.total_episodes,currentEpisode:e.index,query:e.search_title,from:"playrecord",onDelete:()=>s(t=>t.filter(t=>t.key!==e.key)),type:e.total_episodes>1?"tv":""})},e.key)})})]})}var p=a(6488),y=a(7119);function v(){let[e,t]=(0,i.useState)("home"),[a,s]=(0,i.useState)([]),[u,v]=(0,i.useState)([]),[f,b]=(0,i.useState)([]),[w,j]=(0,i.useState)([]),[N,k]=(0,i.useState)(!0),{announcement:_}=(0,y.W)(),[E,S]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(_){let e=localStorage.getItem("hasSeenAnnouncement");e!==_?S(!0):S(!!(!e&&_))}},[_]);let[T,C]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{try{k(!0);let[e,t,a,r]=await Promise.all([(0,d.Z_)({kind:"movie",category:"热门",type:"全部"}),(0,d.Z_)({kind:"tv",category:"tv",type:"tv"}),(0,d.Z_)({kind:"tv",category:"show",type:"show"}),(0,c.W)()]);200===e.code&&s(e.list),200===t.code&&v(t.list),200===a.code&&b(a.list),j(r)}catch(e){console.error("获取推荐数据失败:",e)}finally{k(!1)}})()},[]);let R=async e=>{let t=await (0,l.Rr)();C(Object.entries(e).sort((e,t)=>{let[,a]=e,[,r]=t;return r.save_time-a.save_time}).map(e=>{let[a,r]=e,s=a.indexOf("+"),n=a.slice(0,s),o=a.slice(s+1),i=t[a],c=null==i?void 0:i.index;return{id:o,source:n,title:r.title,year:r.year,poster:r.cover,episodes:r.total_episodes,source_name:r.source_name,currentEpisode:c,search_title:null==r?void 0:r.search_title}}))};(0,i.useEffect)(()=>{if("favorites"===e)return(async()=>{let e=await (0,l.EE)();await R(e)})(),(0,l.rq)("favoritesUpdated",e=>{R(e)})},[e]);let A=e=>{S(!1),localStorage.setItem("hasSeenAnnouncement",e)};return(0,r.jsxs)(p.Z,{children:[(0,r.jsxs)("div",{className:"px-2 sm:px-10 py-4 sm:py-8 overflow-visible",children:[(0,r.jsx)("div",{className:"mb-8 flex justify-center",children:(0,r.jsx)(m,{options:[{label:"首页",value:"home"},{label:"收藏夹",value:"favorites"}],active:e,onChange:e=>t(e)})}),(0,r.jsx)("div",{className:"max-w-[95%] mx-auto",children:"favorites"===e?(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"我的收藏"}),T.length>0&&(0,r.jsx)("button",{className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:async()=>{await (0,l.j5)(),C([])},children:"清空"})]}),(0,r.jsxs)("div",{className:"justify-start grid grid-cols-3 gap-x-2 gap-y-14 sm:gap-y-20 px-0 sm:px-2 sm:grid-cols-[repeat(auto-fill,_minmax(11rem,_1fr))] sm:gap-x-8",children:[T.map(e=>(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(h.Z,{query:e.search_title,...e,from:"favorite",type:e.episodes>1?"tv":""})},e.id+e.source)),0===T.length&&(0,r.jsx)("div",{className:"col-span-full text-center text-gray-500 py-8 dark:text-gray-400",children:"暂无收藏内容"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x,{}),(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"热门电影"}),(0,r.jsxs)(o.default,{href:"/douban?type=movie",className:"flex items-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:["查看更多",(0,r.jsx)(n,{className:"w-4 h-4 ml-1"})]})]}),(0,r.jsx)(g,{children:N?Array.from({length:8}).map((e,t)=>(0,r.jsxs)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:[(0,r.jsx)("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-lg bg-gray-200 animate-pulse dark:bg-gray-800",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-300 dark:bg-gray-700"})}),(0,r.jsx)("div",{className:"mt-2 h-4 bg-gray-200 rounded animate-pulse dark:bg-gray-800"})]},t)):a.map((e,t)=>(0,r.jsx)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:(0,r.jsx)(h.Z,{from:"douban",title:e.title,poster:e.poster,douban_id:Number(e.id),rate:e.rate,year:e.year,type:"movie"})},t))})]}),(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"热门剧集"}),(0,r.jsxs)(o.default,{href:"/douban?type=tv",className:"flex items-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:["查看更多",(0,r.jsx)(n,{className:"w-4 h-4 ml-1"})]})]}),(0,r.jsx)(g,{children:N?Array.from({length:8}).map((e,t)=>(0,r.jsxs)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:[(0,r.jsx)("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-lg bg-gray-200 animate-pulse dark:bg-gray-800",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-300 dark:bg-gray-700"})}),(0,r.jsx)("div",{className:"mt-2 h-4 bg-gray-200 rounded animate-pulse dark:bg-gray-800"})]},t)):u.map((e,t)=>(0,r.jsx)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:(0,r.jsx)(h.Z,{from:"douban",title:e.title,poster:e.poster,douban_id:Number(e.id),rate:e.rate,year:e.year})},t))})]}),(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"新番放送"}),(0,r.jsxs)(o.default,{href:"/douban?type=anime",className:"flex items-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:["查看更多",(0,r.jsx)(n,{className:"w-4 h-4 ml-1"})]})]}),(0,r.jsx)(g,{children:N?Array.from({length:8}).map((e,t)=>(0,r.jsxs)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:[(0,r.jsx)("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-lg bg-gray-200 animate-pulse dark:bg-gray-800",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-300 dark:bg-gray-700"})}),(0,r.jsx)("div",{className:"mt-2 h-4 bg-gray-200 rounded animate-pulse dark:bg-gray-800"})]},t)):(()=>{var e;let t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date().getDay()];return((null===(e=w.find(e=>e.weekday.en===t))||void 0===e?void 0:e.items)||[]).map((e,t)=>{var a,s,n,o;return(0,r.jsx)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:(0,r.jsx)(h.Z,{from:"douban",title:e.name_cn||e.name,poster:e.images.large||e.images.common||e.images.medium||e.images.small||e.images.grid,douban_id:e.id,rate:(null===(s=e.rating)||void 0===s?void 0:null===(a=s.score)||void 0===a?void 0:a.toString())||"",year:(null===(o=e.air_date)||void 0===o?void 0:null===(n=o.split("-"))||void 0===n?void 0:n[0])||"",isBangumi:!0})},"".concat(e.id,"-").concat(t))})})()})]}),(0,r.jsxs)("section",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"热门综艺"}),(0,r.jsxs)(o.default,{href:"/douban?type=show",className:"flex items-center text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:["查看更多",(0,r.jsx)(n,{className:"w-4 h-4 ml-1"})]})]}),(0,r.jsx)(g,{children:N?Array.from({length:8}).map((e,t)=>(0,r.jsxs)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:[(0,r.jsx)("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-lg bg-gray-200 animate-pulse dark:bg-gray-800",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-300 dark:bg-gray-700"})}),(0,r.jsx)("div",{className:"mt-2 h-4 bg-gray-200 rounded animate-pulse dark:bg-gray-800"})]},t)):f.map((e,t)=>(0,r.jsx)("div",{className:"min-w-[96px] w-24 sm:min-w-[180px] sm:w-44",children:(0,r.jsx)(h.Z,{from:"douban",title:e.title,poster:e.poster,douban_id:Number(e.id),rate:e.rate,year:e.year})},t))})]})]})})]}),_&&E&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm dark:bg-black/70 p-4 transition-opacity duration-300 ".concat(E?"":"opacity-0 pointer-events-none"),onTouchStart:e=>{e.target===e.currentTarget&&e.preventDefault()},onTouchMove:e=>{e.target===e.currentTarget&&(e.preventDefault(),e.stopPropagation())},onTouchEnd:e=>{e.target===e.currentTarget&&e.preventDefault()},style:{touchAction:"none"},children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white p-6 shadow-xl dark:bg-gray-900 transform transition-all duration-300 hover:shadow-2xl",onTouchMove:e=>{e.stopPropagation()},style:{touchAction:"auto"},children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold tracking-tight text-gray-800 dark:text-white border-b border-green-500 pb-1",children:"提示"}),(0,r.jsx)("button",{onClick:()=>A(_),className:"text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-white transition-colors","aria-label":"关闭"})]}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"relative overflow-hidden rounded-lg mb-4 bg-green-50 dark:bg-green-900/20",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 w-1.5 bg-green-500 dark:bg-green-400"}),(0,r.jsx)("p",{className:"ml-4 text-gray-600 dark:text-gray-300 leading-relaxed",children:_})]})}),(0,r.jsx)("button",{onClick:()=>A(_),className:"w-full rounded-lg bg-gradient-to-r from-green-600 to-green-700 px-4 py-3 text-white font-medium shadow-md hover:shadow-lg hover:from-green-700 hover:to-green-800 dark:from-green-600 dark:to-green-700 dark:hover:from-green-700 dark:hover:to-green-800 transition-all duration-300 transform hover:-translate-y-0.5",children:"我知道了"})]})})]})}function f(){return(0,r.jsx)(i.Suspense,{children:(0,r.jsx)(v,{})})}},1829:function(e,t,a){"use strict";async function r(){let e=await fetch("https://api.bgm.tv/calendar");return await e.json()}a.d(t,{W:function(){return r}})},5384:function(e,t,a){"use strict";async function r(e,t){let a=new AbortController,r=setTimeout(()=>a.abort(),1e4),s="https://cors-anywhere.com/"===t?"".concat(t).concat(e):t?"".concat(t).concat(encodeURIComponent(e)):e,n={signal:a.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Referer:"https://movie.douban.com/",Accept:"application/json, text/plain, */*"}};try{let e=await fetch(s,n);return clearTimeout(r),e}catch(e){throw clearTimeout(r),e}}function s(){var e,t;return{proxyType:localStorage.getItem("doubanDataSource")||(null===(e=window.RUNTIME_CONFIG)||void 0===e?void 0:e.DOUBAN_PROXY_TYPE)||"melody-cdn-sharon",proxyUrl:localStorage.getItem("doubanProxyUrl")||(null===(t=window.RUNTIME_CONFIG)||void 0===t?void 0:t.DOUBAN_PROXY)||""}}async function n(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{kind:n,category:o,type:i,pageLimit:c=20,pageStart:l=0}=e;if(!["tv","movie"].includes(n))throw Error("kind 参数必须是 tv 或 movie");if(!o||!i)throw Error("category 和 type 参数不能为空");if(c<1||c>100)throw Error("pageLimit 必须在 1-100 之间");if(l<0)throw Error("pageStart 不能小于 0");let d=a?"https://m.douban.cmliussss.net/rexxar/api/v2/subject/recent_hot/".concat(n,"?start=").concat(l,"&limit=").concat(c,"&category=").concat(o,"&type=").concat(i):s?"https://m.douban.cmliussss.com/rexxar/api/v2/subject/recent_hot/".concat(n,"?start=").concat(l,"&limit=").concat(c,"&category=").concat(o,"&type=").concat(i):"https://m.douban.com/rexxar/api/v2/subject/recent_hot/".concat(n,"?start=").concat(l,"&limit=").concat(c,"&category=").concat(o,"&type=").concat(i);try{let e=await r(d,a||s?"":t);if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let n=(await e.json()).items.map(e=>{var t,a,r,s,n;return{id:e.id,title:e.title,poster:(null===(t=e.pic)||void 0===t?void 0:t.normal)||(null===(a=e.pic)||void 0===a?void 0:a.large)||"",rate:(null===(r=e.rating)||void 0===r?void 0:r.value)?e.rating.value.toFixed(1):"",year:(null===(n=e.card_subtitle)||void 0===n?void 0:null===(s=n.match(/(\d{4})/))||void 0===s?void 0:s[1])||""}});return{code:200,message:"获取成功",list:n}}catch(e){throw window.dispatchEvent(new CustomEvent("globalError",{detail:{message:"获取豆瓣分类数据失败"}})),Error("获取豆瓣分类数据失败: ".concat(e.message))}}async function o(e){let{kind:t,category:a,type:r,pageLimit:o=20,pageStart:i=0}=e,{proxyType:c,proxyUrl:l}=s();switch(c){case"melody-cdn-sharon":return n(e,"https://douban.ihtw.moe/");case"cors-proxy-zwei":return n(e,"https://ciao-cors.is-an.org/");case"cmliussss-cdn-tencent":return n(e,"",!0,!1);case"cmliussss-cdn-ali":return n(e,"",!1,!0);case"cors-anywhere":return n(e,"https://cors-anywhere.com/");case"custom":return n(e,l);default:return(await fetch("/api/douban/categories?kind=".concat(t,"&category=").concat(a,"&type=").concat(r,"&limit=").concat(o,"&start=").concat(i))).json()}}async function i(e){let{tag:t,type:a,pageLimit:r=20,pageStart:n=0}=e,{proxyType:o,proxyUrl:i}=s();switch(o){case"melody-cdn-sharon":return c(e,"https://douban.ihtw.moe/");case"cors-proxy-zwei":return c(e,"https://ciao-cors.is-an.org/");case"cmliussss-cdn-tencent":return c(e,"",!0,!1);case"cmliussss-cdn-ali":return c(e,"",!1,!0);case"cors-anywhere":return c(e,"https://cors-anywhere.com/");case"custom":return c(e,i);default:return(await fetch("/api/douban?tag=".concat(t,"&type=").concat(a,"&pageSize=").concat(r,"&pageStart=").concat(n))).json()}}async function c(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{tag:n,type:o,pageLimit:i=20,pageStart:c=0}=e;if(!n||!o)throw Error("tag 和 type 参数不能为空");if(!["tv","movie"].includes(o))throw Error("type 参数必须是 tv 或 movie");if(i<1||i>100)throw Error("pageLimit 必须在 1-100 之间");if(c<0)throw Error("pageStart 不能小于 0");let l=a?"https://movie.douban.cmliussss.net/j/search_subjects?type=".concat(o,"&tag=").concat(n,"&sort=recommend&page_limit=").concat(i,"&page_start=").concat(c):s?"https://movie.douban.cmliussss.com/j/search_subjects?type=".concat(o,"&tag=").concat(n,"&sort=recommend&page_limit=").concat(i,"&page_start=").concat(c):"https://movie.douban.com/j/search_subjects?type=".concat(o,"&tag=").concat(n,"&sort=recommend&page_limit=").concat(i,"&page_start=").concat(c);try{let e=await r(l,a||s?"":t);if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let n=(await e.json()).subjects.map(e=>{var t,a;return{id:e.id,title:e.title,poster:e.cover,rate:e.rate,year:(null===(a=e.card_subtitle)||void 0===a?void 0:null===(t=a.match(/(\d{4})/))||void 0===t?void 0:t[1])||""}});return{code:200,message:"获取成功",list:n}}catch(e){throw window.dispatchEvent(new CustomEvent("globalError",{detail:{message:"获取豆瓣列表数据失败"}})),Error("获取豆瓣分类数据失败: ".concat(e.message))}}async function l(e){let{kind:t,pageLimit:a=20,pageStart:r=0,category:n,format:o,label:i,region:c,year:l,platform:m,sort:u}=e,{proxyType:g,proxyUrl:h}=s();switch(g){case"melody-cdn-sharon":return d(e,"https://douban.ihtw.moe/");case"cors-proxy-zwei":return d(e,"https://ciao-cors.is-an.org/");case"cmliussss-cdn-tencent":return d(e,"",!0,!1);case"cmliussss-cdn-ali":return d(e,"",!1,!0);case"cors-anywhere":return d(e,"https://cors-anywhere.com/");case"custom":return d(e,h);default:return(await fetch("/api/douban/recommends?kind=".concat(t,"&limit=").concat(a,"&start=").concat(r,"&category=").concat(n,"&format=").concat(o,"&region=").concat(c,"&year=").concat(l,"&platform=").concat(m,"&sort=").concat(u,"&label=").concat(i))).json()}}async function d(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],{kind:n,pageLimit:o=20,pageStart:i=0}=e,{category:c,format:l,region:d,year:m,platform:u,sort:g,label:h}=e;"all"===c&&(c=""),"all"===l&&(l=""),"all"===h&&(h=""),"all"===d&&(d=""),"all"===m&&(m=""),"all"===u&&(u=""),"T"===g&&(g="");let x={类型:c};l&&(x["形式"]=l),d&&(x["地区"]=d);let p=[];c&&p.push(c),!c&&l&&p.push(l),h&&p.push(h),d&&p.push(d),m&&p.push(m),u&&p.push(u);let y=new URLSearchParams;y.append("refresh","0"),y.append("start",i.toString()),y.append("count",o.toString()),y.append("selected_categories",JSON.stringify(x)),y.append("uncollect","false"),y.append("score_range","0,10"),y.append("tags",p.join(",")),g&&y.append("sort",g);let v="".concat(a?"https://m.douban.cmliussss.net/rexxar/api/v2/".concat(n,"/recommend"):s?"https://m.douban.cmliussss.com/rexxar/api/v2/".concat(n,"/recommend"):"https://m.douban.com/rexxar/api/v2/".concat(n,"/recommend"),"?").concat(y.toString());console.log(v);try{let e=await r(v,a||s?"":t);if(!e.ok)throw Error("HTTP error! Status: ".concat(e.status));let n=(await e.json()).items.filter(e=>"movie"==e.type||"tv"==e.type).map(e=>{var t,a,r;return{id:e.id,title:e.title,poster:(null===(t=e.pic)||void 0===t?void 0:t.normal)||(null===(a=e.pic)||void 0===a?void 0:a.large)||"",rate:(null===(r=e.rating)||void 0===r?void 0:r.value)?e.rating.value.toFixed(1):"",year:e.year}});return{code:200,message:"获取成功",list:n}}catch(e){throw Error("获取豆瓣推荐数据失败: ".concat(e.message))}}a.d(t,{$E:function(){return i},Z_:function(){return o},tv:function(){return l}})}},function(e){e.O(0,[447,816,238,918,488,78,629,541,242,744],function(){return e(e.s=8127)}),_N_E=e.O()}]);