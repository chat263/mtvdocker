(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{4119:function(e,t,r){Promise.resolve().then(r.bind(r,9156))},9156:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var a=r(4393),l=r(4582),n=r(477),s=r(2709),o=r(1698),i=r(4908),c=r(7467);let d=["伦理片","福利","里番动漫","门事件","萝莉少女","制服诱惑","国产传媒","cosplay","黑丝诱惑","无码","日本无码","有码","日本有码","SWAG","网红主播","色情片","同性片","福利视频","福利片","写真热舞"];var u=r(6488),m=r(4123);let g=(0,m.Z)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]),x=(0,m.Z)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);var h=r(1349);let p={source:"all",title:"all",year:"all",yearOrder:"desc"};var y=e=>{var t;let{categories:r,values:l,onChange:n}=e,[s,o]=(0,i.useState)(null),[c,d]=(0,i.useState)({x:0,y:0,width:0}),u=(0,i.useRef)({}),m=(0,i.useRef)(null),y=(0,i.useMemo)(()=>({...p,...l}),[l]),f=e=>{let t=u.current[e];if(t){let r=t.getBoundingClientRect(),a=window.innerWidth,l=r.left,n=Math.max(r.width,"title"===e?400:240),s=!1;a<768&&(s=!0,l+(n=Math.min(n,a-32))>a-16&&(l=a-n-16),l<16&&(l=16)),d({x:l,y:r.bottom,width:s?n:r.width})}},v=e=>{s===e?o(null):(o(e),f(e))},b=(e,t)=>{n({...y,[e]:t}),o(null)},k=e=>{let t=r.find(t=>t.key===e);if(!t)return"";let a=y[e];if(!a||a===p[e])return t.label;let l=t.options.find(e=>e.value===a);return(null==l?void 0:l.label)||t.label},w=e=>{let t=y[e];return!t||t===p[e]},j=(e,t)=>{var r;return(null!==(r=y[e])&&void 0!==r?r:p[e])===t};return(0,i.useEffect)(()=>{let e=()=>{s&&o(null)},t=()=>{s&&f(s)};return document.body.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",t),()=>{document.body.removeEventListener("scroll",e),window.removeEventListener("resize",t)}},[s]),(0,i.useEffect)(()=>{let e=e=>{!m.current||m.current.contains(e.target)||Object.values(u.current).some(t=>t&&t.contains(e.target))||o(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative inline-flex rounded-full p-0.5 sm:p-1 bg-transparent gap-1 sm:gap-2",children:[r.map(e=>(0,a.jsx)("div",{ref:t=>{u.current[e.key]=t},className:"relative",children:(0,a.jsxs)("button",{onClick:()=>v(e.key),className:"relative z-10 px-1.5 py-0.5 sm:px-2 sm:py-1 md:px-4 md:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ".concat(s===e.key?w(e.key)?"text-gray-900 dark:text-gray-100 cursor-default":"text-green-600 dark:text-green-400 cursor-default":w(e.key)?"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer":"text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 cursor-pointer"),children:[(0,a.jsx)("span",{children:k(e.key)}),(0,a.jsx)("svg",{className:"inline-block w-2.5 h-2.5 sm:w-3 sm:h-3 ml-0.5 sm:ml-1 transition-transform duration-200 ".concat(s===e.key?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})},e.key)),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("button",{onClick:()=>{let e="desc"===y.yearOrder?"asc":"desc";n({...y,yearOrder:e})},className:"relative z-10 px-1.5 py-0.5 sm:px-2 sm:py-1 md:px-4 md:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ".concat("desc"===y.yearOrder?"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer":"text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 cursor-pointer"),"aria-label":"按年份".concat("desc"===y.yearOrder?"降序":"升序","排序"),children:[(0,a.jsx)("span",{children:"年份"}),"desc"===y.yearOrder?(0,a.jsx)(g,{className:"inline-block ml-1 w-4 h-4 sm:w-4 sm:h-4"}):(0,a.jsx)(x,{className:"inline-block ml-1 w-4 h-4 sm:w-4 sm:h-4"})]})})]}),s&&(0,h.createPortal)((0,a.jsx)("div",{ref:m,className:"fixed z-[9999] bg-white/95 dark:bg-gray-800/95 rounded-xl border border-gray-200/50 dark:border-gray-700/50 backdrop-blur-sm max-h-[50vh] flex flex-col",style:{left:"".concat(c.x,"px"),top:"".concat(c.y,"px"),...window.innerWidth<768?{width:"".concat(c.width,"px")}:{minWidth:"".concat(Math.max(c.width,"title"===s?400:240),"px")},maxWidth:"600px",position:"fixed"},children:(0,a.jsx)("div",{className:"p-2 sm:p-4 overflow-y-auto flex-1 min-h-0",children:(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-1 sm:gap-2",children:null===(t=r.find(e=>e.key===s))||void 0===t?void 0:t.options.map(e=>(0,a.jsx)("button",{onClick:()=>b(s,e.value),className:"px-2 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm rounded-lg transition-all duration-200 text-left ".concat(j(s,e.value)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border border-green-200 dark:border-green-700":"text-gray-700 dark:text-gray-300 hover:bg-gray-100/80 dark:hover:bg-gray-700/80"),children:e.label},e.value))})})}),document.body)]})};function f(e){let{query:t,isVisible:r,onSelect:l,onClose:n}=e,[s,o]=(0,i.useState)([]),[c,d]=(0,i.useState)(-1),u=(0,i.useRef)(null),m=(0,i.useRef)(null),g=(0,i.useRef)(null),x=(0,i.useCallback)(async e=>{g.current&&g.current.abort();let t=new AbortController;g.current=t;try{let r=await fetch("/api/search/suggestions?q=".concat(encodeURIComponent(e)),{signal:t.signal});if(r.ok){let e=(await r.json()).suggestions.map(e=>({text:e.text,type:"related"}));o(e),d(-1)}}catch(e){e instanceof Error?"AbortError"!==e.name&&(o([]),d(-1)):(o([]),d(-1))}},[]),h=(0,i.useCallback)(e=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{e.trim()&&r?x(e):(o([]),d(-1))},300)},[r,x]);return((0,i.useEffect)(()=>{if(!t.trim()||!r){o([]),d(-1);return}return h(t),()=>{m.current&&clearTimeout(m.current)}},[t,r,h]),(0,i.useEffect)(()=>{let e=e=>{if(r&&0!==s.length)switch(e.key){case"ArrowDown":e.preventDefault(),d(e=>e<s.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),d(e=>e>0?e-1:s.length-1);break;case"Enter":e.preventDefault(),c>=0&&c<s.length?l(s[c].text):l(t);break;case"Escape":e.preventDefault(),n()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r,t,s,c,l,n]),(0,i.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&n()};return r&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r,n]),r&&0!==s.length)?(0,a.jsx)("div",{ref:u,className:"absolute top-full left-0 right-0 z-50 mt-1 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 max-h-80 overflow-y-auto",children:s.map((e,t)=>(0,a.jsx)("button",{onClick:()=>l(e.text),onMouseEnter:()=>d(t),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150 flex items-center gap-3 ".concat(c===t?"bg-gray-100 dark:bg-gray-700":""),children:(0,a.jsx)("span",{className:"flex-1 text-sm text-gray-700 dark:text-gray-300 truncate",children:e.text})},"related-".concat(e.text)))}):null}var v=r(6501);function b(){let[e,t]=(0,i.useState)([]),[r,m]=(0,i.useState)(!1),g=(0,o.useRouter)(),x=(0,o.useSearchParams)(),h=(0,i.useRef)(""),[p,b]=(0,i.useState)(""),[k,w]=(0,i.useState)(!1),[j,N]=(0,i.useState)(!1),[E,C]=(0,i.useState)([]),[S,M]=(0,i.useState)(!1),[A,L]=(0,i.useState)({source:"all",title:"all",year:"all",yearOrder:"desc"}),[_,I]=(0,i.useState)({source:"all",title:"all",year:"all",yearOrder:"desc"}),R=()=>{{let e=localStorage.getItem("defaultAggregateSearch");if(null!==e)return JSON.parse(e)}return!0},[O,q]=(0,i.useState)(()=>R()?"agg":"all"),D=(e,t,r)=>{let a=!e||"unknown"===e,l=!t||"unknown"===t;if(a&&l)return 0;if(a)return 1;if(l)return -1;let n=parseInt(e,10),s=parseInt(t,10);return"asc"===r?n-s:s-n},U=(0,i.useMemo)(()=>{let e=new Map;return E.forEach(t=>{let r="".concat(t.title.replaceAll(" ",""),"-").concat(t.year||"unknown","-").concat(1===t.episodes.length?"movie":"tv"),a=e.get(r)||[];a.push(t),e.set(r,a)}),Array.from(e.entries())},[E]),W=(0,i.useMemo)(()=>{let e=new Map,t=new Set,r=new Set;E.forEach(a=>{a.source&&a.source_name&&e.set(a.source,a.source_name),a.title&&t.add(a.title),a.year&&r.add(a.year)});let a=[{label:"全部来源",value:"all"},...Array.from(e.entries()).sort((e,t)=>e[1].localeCompare(t[1])).map(e=>{let[t,r]=e;return{label:r,value:t}})],l=[{label:"全部标题",value:"all"},...Array.from(t.values()).sort((e,t)=>e.localeCompare(t)).map(e=>({label:e,value:e}))],n=Array.from(r.values()),s=n.filter(e=>"unknown"!==e).sort((e,t)=>parseInt(t)-parseInt(e)),o=n.includes("unknown"),i=[{label:"全部年份",value:"all"},...s.map(e=>({label:e,value:e})),...o?[{label:"未知",value:"unknown"}]:[]];return{categoriesAll:[{key:"source",label:"来源",options:a},{key:"title",label:"标题",options:l},{key:"year",label:"年份",options:i}],categoriesAgg:[{key:"source",label:"来源",options:a},{key:"title",label:"标题",options:l},{key:"year",label:"年份",options:i}]}},[E]),F=(0,i.useMemo)(()=>{let{source:e,title:t,year:r,yearOrder:a}=A;return E.filter(a=>("all"===e||a.source===e)&&("all"===t||a.title===t)&&("all"===r||a.year===r)).sort((e,t)=>{let r=D(e.year,t.year,a);if(0!==r)return r;let l=e.title===p.trim(),n=t.title===p.trim();return l&&!n?-1:!l&&n?1:"asc"===a?e.title.localeCompare(t.title):t.title.localeCompare(e.title)})},[E,A,p]),T=(0,i.useMemo)(()=>{let{source:e,title:t,year:r,yearOrder:a}=_;return U.filter(a=>{var l,n,s,o;let[i,c]=a,d=null!==(s=null===(l=c[0])||void 0===l?void 0:l.title)&&void 0!==s?s:"",u=null!==(o=null===(n=c[0])||void 0===n?void 0:n.year)&&void 0!==o?o:"unknown";return!!("all"===e||c.some(t=>t.source===e))&&("all"===t||d===t)&&("all"===r||u===r)}).sort((e,t)=>{let r=D(e[1][0].year,t[1][0].year,a);if(0!==r)return r;let l=e[1][0].title===p.trim(),n=t[1][0].title===p.trim();if(l&&!n)return -1;if(!l&&n)return 1;let s=e[1][0].title,o=t[1][0].title;return"asc"===a?s.localeCompare(o):o.localeCompare(s)})},[U,_,p]);(0,i.useEffect)(()=>{var e;x.get("q")||null===(e=document.getElementById("searchInput"))||void 0===e||e.focus(),(0,c.nO)().then(t);let r=(0,c.rq)("searchHistoryUpdated",e=>{t(e)}),a=()=>document.body.scrollTop||0,l=!1,n=()=>{l&&(m(a()>300),requestAnimationFrame(n))};l=!0,n();let s=()=>{m(a()>300)};return document.body.addEventListener("scroll",s,{passive:!0}),()=>{r(),l=!1,document.body.removeEventListener("scroll",s)}},[]),(0,i.useEffect)(()=>{let e=x.get("q")||"";h.current=e.trim(),e?(b(e),Z(e),M(!1),(0,c.F0)(e)):(N(!1),M(!1))},[x]);let Z=async e=>{let t=e.trim();try{var r;w(!0);let e=await fetch("/api/search?q=".concat(encodeURIComponent(t))),a=(await e.json()).results;if((null===(r=window.RUNTIME_CONFIG)||void 0===r?void 0:r.DISABLE_YELLOW_FILTER)||(a=a.filter(e=>{let t=e.type_name||"";return!d.some(e=>t.includes(e))})),h.current!==t)return;C(a),N(!0)}catch(e){C([])}finally{w(!1)}};return(0,a.jsxs)(u.Z,{activePath:"/search",children:[(0,a.jsxs)("div",{className:"px-4 sm:px-10 py-4 sm:py-8 overflow-visible mb-10",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault();let t=p.trim().replace(/\s+/g," ");t&&(b(t),w(!0),N(!0),M(!1),g.push("/search?q=".concat(encodeURIComponent(t))),Z(t),(0,c.F0)(t))},className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.Z,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400 dark:text-gray-500"}),(0,a.jsx)("input",{id:"searchInput",type:"text",value:p,onChange:e=>{let t=e.target.value;b(t),t.trim()?M(!0):M(!1)},onFocus:()=>{p.trim()&&M(!0)},placeholder:"搜索电影、电视剧...",className:"w-full h-12 rounded-lg bg-gray-50/80 py-3 pl-10 pr-4 text-sm text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-400 focus:bg-white border border-gray-200/50 shadow-sm dark:bg-gray-800 dark:text-gray-300 dark:placeholder-gray-500 dark:focus:bg-gray-700 dark:border-gray-700"}),(0,a.jsx)(f,{query:p,isVisible:S,onSelect:e=>{b(e),M(!1),w(!0),N(!0),g.push("/search?q=".concat(encodeURIComponent(e))),Z(e),(0,c.F0)(e)},onClose:()=>M(!1)})]})})}),(0,a.jsx)("div",{className:"max-w-[95%] mx-auto mt-12 overflow-visible",children:k?(0,a.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):j?(0,a.jsxs)("section",{className:"mb-12",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"搜索结果"})}),(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between gap-3",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0",children:"agg"===O?(0,a.jsx)(y,{categories:W.categoriesAgg,values:_,onChange:e=>I(e)}):(0,a.jsx)(y,{categories:W.categoriesAll,values:A,onChange:e=>L(e)})}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer select-none shrink-0",children:[(0,a.jsx)("span",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:"聚合"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:"agg"===O,onChange:()=>q("agg"===O?"all":"agg")}),(0,a.jsx)("div",{className:"w-9 h-5 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),(0,a.jsx)("div",{className:"absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4"})]})]})]}),(0,a.jsxs)("div",{className:"justify-start grid grid-cols-3 gap-x-2 gap-y-14 sm:gap-y-20 px-0 sm:px-2 sm:grid-cols-[repeat(auto-fill,_minmax(11rem,_1fr))] sm:gap-x-8",children:["agg"===O?T.map(e=>{let[t,r]=e;return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(v.Z,{from:"search",items:r,query:p.trim()!==r[0].title?p.trim():""})},"agg-".concat(t))}):F.map(e=>(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(v.Z,{id:e.id,title:e.title,poster:e.poster,episodes:e.episodes.length,source:e.source,source_name:e.source_name,douban_id:e.douban_id,query:p.trim()!==e.title?p.trim():"",year:e.year,from:"search",type:e.episodes.length>1?"tv":"movie"})},"all-".concat(e.source,"-").concat(e.id))),0===E.length&&(0,a.jsx)("div",{className:"col-span-full text-center text-gray-500 py-8 dark:text-gray-400",children:"未找到相关结果"})]},"search-results-".concat(O))]}):e.length>0?(0,a.jsxs)("section",{className:"mb-12",children:[(0,a.jsxs)("h2",{className:"mb-4 text-xl font-bold text-gray-800 text-left dark:text-gray-200",children:["搜索历史",e.length>0&&(0,a.jsx)("button",{onClick:()=>{(0,c.Ev)()},className:"ml-3 text-sm text-gray-500 hover:text-red-500 transition-colors dark:text-gray-400 dark:hover:text-red-500",children:"清空"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("button",{onClick:()=>{b(e),g.push("/search?q=".concat(encodeURIComponent(e.trim())))},className:"px-4 py-2 bg-gray-500/10 hover:bg-gray-300 rounded-full text-sm text-gray-700 transition-colors duration-200 dark:bg-gray-700/50 dark:hover:bg-gray-600 dark:text-gray-300",children:e}),(0,a.jsx)("button",{"aria-label":"删除搜索历史",onClick:t=>{t.stopPropagation(),t.preventDefault(),(0,c.Rw)(e)},className:"absolute -top-1 -right-1 w-4 h-4 opacity-0 group-hover:opacity-100 bg-gray-400 hover:bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] transition-colors",children:(0,a.jsx)(n.Z,{className:"w-3 h-3"})})]},e))})]}):null})]}),(0,a.jsx)("button",{onClick:()=>{try{document.body.scrollTo({top:0,behavior:"smooth"})}catch(e){document.body.scrollTop=0}},className:"fixed bottom-20 md:bottom-6 right-6 z-[500] w-12 h-12 bg-green-500/90 hover:bg-green-500 text-white rounded-full shadow-lg backdrop-blur-sm transition-all duration-300 ease-in-out flex items-center justify-center group ".concat(r?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 translate-y-4 pointer-events-none"),"aria-label":"返回顶部",children:(0,a.jsx)(s.Z,{className:"w-6 h-6 transition-transform group-hover:scale-110"})})]})}function k(){return(0,a.jsx)(i.Suspense,{children:(0,a.jsx)(b,{})})}}},function(e){e.O(0,[447,816,238,918,488,78,501,541,242,744],function(){return e(e.s=4119)}),_N_E=e.O()}]);