(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{2093:function(e,r,t){Promise.resolve().then(t.bind(t,7520))},7520:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return z}});var a=t(4393),s=t(8964),n=t(9320),l=t(6081),o=t(2444),d=t(2709),i=t(546),c=t(4769),g=t(1183),x=t(507),u=t(1177),m=t(1005),y=t(6104),b=t(3189),h=t(2765),p=t(5346),f=t(4908),k=t(5676),j=t.n(k),w=t(3349),v=t(6349),N=t(5018),C=t(6218),S=t(283),D=t(7169),T=e=>{let{onRefreshConfig:r}=e,[t,s]=(0,f.useState)(""),[n,l]=(0,f.useState)(""),[o,d]=(0,f.useState)(null),[i,c]=(0,f.useState)(!1),[g,x]=(0,f.useState)(!1),u=(0,f.useRef)(null),m=async()=>{if(!t.trim()){j().fire({icon:"error",title:"错误",text:"请输入加密密码",returnFocus:!1});return}try{c(!0);let e=await fetch("/api/admin/data_migration/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||"导出失败: ".concat(e.status))}let r=e.headers.get("content-disposition"),a=null==r?void 0:r.match(/filename="(.+)"/),n=(null==a?void 0:a[1])||"moontv-backup.dat",l=await e.blob(),o=window.URL.createObjectURL(l),d=document.createElement("a");d.href=o,d.download=n,d.style.display="none",d.style.position="fixed",d.style.top="0",d.style.left="0",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(o),document.body.removeChild(d),j().fire({icon:"success",title:"导出成功",text:"数据已成功导出，请妥善保管备份文件和密码",timer:3e3,showConfirmButton:!1,returnFocus:!1}),s("")}catch(e){j().fire({icon:"error",title:"导出失败",text:e instanceof Error?e.message:"导出过程中发生错误",returnFocus:!1})}finally{c(!1)}},y=async()=>{if(!o){j().fire({icon:"error",title:"错误",text:"请选择备份文件",returnFocus:!1});return}if(!n.trim()){j().fire({icon:"error",title:"错误",text:"请输入解密密码",returnFocus:!1});return}try{x(!0);let e=new FormData;e.append("file",o),e.append("password",n);let t=await fetch("/api/admin/data_migration/import",{method:"POST",body:e}),a=await t.json();if(!t.ok)throw Error(a.error||"导入失败: ".concat(t.status));await j().fire({icon:"success",title:"导入成功",html:'\n          <div class="text-left">\n            <p><strong>导入完成！</strong></p>\n            <p class="mt-2">导入的用户数量: '.concat(a.importedUsers,"</p>\n            <p>备份时间: ").concat(new Date(a.timestamp).toLocaleString("zh-CN"),"</p>\n            <p>服务器版本: ").concat(a.serverVersion||"未知版本",'</p>\n            <p class="mt-3 text-orange-600">请刷新页面以查看最新数据。</p>\n          </div>\n        '),confirmButtonText:"刷新页面",returnFocus:!1}),d(null),l(""),u.current&&(u.current.value=""),r&&await r(),window.location.reload()}catch(e){j().fire({icon:"error",title:"导入失败",text:e instanceof Error?e.message:"导入过程中发生错误",returnFocus:!1})}finally{x(!1)}};return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-amber-200 dark:border-amber-700 rounded-lg bg-amber-50/30 dark:bg-amber-900/5",children:[(0,a.jsx)(v.Z,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0"}),(0,a.jsx)("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"数据迁移操作请谨慎，确保已备份重要数据"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-6 bg-white dark:bg-gray-800 hover:shadow-sm transition-shadow flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center",children:(0,a.jsx)(N.Z,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"数据导出"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"创建加密备份文件"})]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"加密密码"]}),(0,a.jsx)("input",{type:"password",value:t,onChange:e=>s(e.target.value),placeholder:"设置强密码保护备份文件",className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",disabled:i}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"导入时需要使用相同密码"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"备份内容："}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,a.jsx)("div",{children:"• 管理配置"}),(0,a.jsx)("div",{children:"• 用户数据"}),(0,a.jsx)("div",{children:"• 播放记录"}),(0,a.jsx)("div",{children:"• 收藏夹"})]})]})]}),(0,a.jsx)("button",{onClick:m,disabled:i||!t.trim(),className:"w-full px-4 py-2.5 rounded-lg font-medium transition-colors mt-10 ".concat(i||!t.trim()?"bg-gray-100 dark:bg-gray-700 cursor-not-allowed text-gray-500 dark:text-gray-400":"bg-blue-600 hover:bg-blue-700 text-white"),children:i?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"导出中..."]}):(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4"}),"导出数据"]})})]})]}),(0,a.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-6 bg-white dark:bg-gray-800 hover:shadow-sm transition-shadow flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg bg-red-50 dark:bg-red-900/20 flex items-center justify-center",children:(0,a.jsx)(S.Z,{className:"w-4 h-4 text-red-600 dark:text-red-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"数据导入"}),(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:"⚠️ 将清空现有数据"})]})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[(0,a.jsx)(D.Z,{className:"w-4 h-4"}),"备份文件",o&&(0,a.jsxs)("span",{className:"ml-auto text-xs text-green-600 dark:text-green-400 font-normal",children:[o.name," (",(o.size/1024).toFixed(1)," KB)"]})]}),(0,a.jsx)("input",{ref:u,type:"file",accept:".dat",onChange:e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];t&&d(t)},className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-red-500 focus:border-red-500 file:mr-3 file:py-1.5 file:px-3 file:rounded file:border-0 file:text-sm file:font-medium file:bg-gray-50 dark:file:bg-gray-600 file:text-gray-700 dark:file:text-gray-300 hover:file:bg-gray-100 dark:hover:file:bg-gray-500 transition-colors",disabled:g})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[(0,a.jsx)(C.Z,{className:"w-4 h-4"}),"解密密码"]}),(0,a.jsx)("input",{type:"password",value:n,onChange:e=>l(e.target.value),placeholder:"输入导出时的加密密码",className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors",disabled:g})]})]}),(0,a.jsx)("button",{onClick:y,disabled:g||!o||!n.trim(),className:"w-full px-4 py-2.5 rounded-lg font-medium transition-colors mt-10 ".concat(!g&&o&&n.trim()?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-100 dark:bg-gray-700 cursor-not-allowed text-gray-500 dark:text-gray-400"),children:g?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"导入中..."]}):(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4"}),"导入数据"]})})]})]})]})]})},P=t(6488);let E=e=>j().fire({icon:"error",title:"错误",text:e}),F=e=>j().fire({icon:"success",title:"成功",text:e,timer:2e3,showConfirmButton:!1}),O=e=>{let{title:r,icon:t,isExpanded:s,onToggle:n,children:l}=e;return(0,a.jsxs)("div",{className:"rounded-xl shadow-sm mb-4 overflow-hidden bg-white/80 backdrop-blur-md dark:bg-gray-800/50 dark:ring-1 dark:ring-gray-700",children:[(0,a.jsxs)("button",{onClick:n,className:"w-full px-6 py-4 flex items-center justify-between bg-gray-50/70 dark:bg-gray-800/60 hover:bg-gray-100/80 dark:hover:bg-gray-700/60 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[t,(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:r})]}),(0,a.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:s?(0,a.jsx)(d.Z,{size:20}):(0,a.jsx)(i.Z,{size:20})})]}),s&&(0,a.jsx)("div",{className:"px-6 py-4",children:l})]})},Z=e=>{var r;let{config:t,role:s,refreshConfig:n}=e,[l,o]=(0,f.useState)({enableRegistration:!1}),[d,i]=(0,f.useState)(!1),[c,g]=(0,f.useState)(!1),[x,u]=(0,f.useState)({username:"",password:""}),[m,y]=(0,f.useState)({username:"",password:""}),b=(null===(r=(0,w.v)())||void 0===r?void 0:r.username)||null;(0,f.useEffect)(()=>{(null==t?void 0:t.UserConfig)&&o({enableRegistration:t.UserConfig.AllowRegister})},[t]);let h=async e=>{try{o(r=>({...r,enableRegistration:e}));let r=await fetch("/api/admin/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"setAllowRegister",allowRegister:e})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"操作失败: ".concat(r.status))}await n()}catch(r){E(r instanceof Error?r.message:"操作失败"),o(r=>({...r,enableRegistration:!e}))}},p=async e=>{await P("ban",e)},k=async e=>{await P("unban",e)},v=async e=>{await P("setAdmin",e)},N=async e=>{await P("cancelAdmin",e)},C=async()=>{x.username&&x.password&&(await P("add",x.username,x.password),u({username:"",password:""}),i(!1))},S=async()=>{m.username&&m.password&&(await P("changePassword",m.username,m.password),y({username:"",password:""}),g(!1))},D=e=>{y({username:e,password:""}),g(!0),i(!1)},T=async e=>{let{isConfirmed:r}=await j().fire({title:"确认删除用户",text:"删除用户 ".concat(e," 将同时删除其搜索历史、播放记录和收藏夹，此操作不可恢复！"),icon:"warning",showCancelButton:!0,confirmButtonText:"确认删除",cancelButtonText:"取消",confirmButtonColor:"#dc2626"});r&&await P("deleteUser",e)},P=async(e,r,t)=>{try{let a=await fetch("/api/admin/user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUsername:r,...t?{targetPassword:t}:{},action:e})});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||"操作失败: ".concat(a.status))}await n()}catch(e){E(e instanceof Error?e.message:"操作失败")}};return t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"用户统计"}),(0,a.jsxs)("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-800 dark:text-green-300",children:t.UserConfig.Users.length}),(0,a.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400",children:"总用户数"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"注册设置"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"text-gray-700 dark:text-gray-300\n              }",children:"允许新用户注册"}),(0,a.jsx)("button",{onClick:()=>h(!l.enableRegistration),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 ".concat(l.enableRegistration?"bg-green-600":"bg-gray-200 dark:bg-gray-700"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(l.enableRegistration?"translate-x-6":"translate-x-1")})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"用户列表"}),(0,a.jsx)("button",{onClick:()=>{i(!d),c&&(g(!1),y({username:"",password:""}))},className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors",children:d?"取消":"添加用户"})]}),d&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"用户名",value:x.username,onChange:e=>u(r=>({...r,username:e.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,a.jsx)("input",{type:"password",placeholder:"密码",value:x.password,onChange:e=>u(r=>({...r,password:e.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,a.jsx)("button",{onClick:C,disabled:!x.username||!x.password,className:"w-full sm:w-auto px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:"添加"})]})}),c&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-3",children:"修改用户密码"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"用户名",value:m.username,disabled:!0,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 cursor-not-allowed"}),(0,a.jsx)("input",{type:"password",placeholder:"新密码",value:m.password,onChange:e=>y(r=>({...r,password:e.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,a.jsx)("button",{onClick:S,disabled:!m.password,className:"w-full sm:w-auto px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:"修改密码"}),(0,a.jsx)("button",{onClick:()=>{g(!1),y({username:"",password:""})},className:"w-full sm:w-auto px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"取消"})]})]}),(0,a.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg max-h-[28rem] overflow-y-auto overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"用户名"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"角色"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"状态"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"操作"})]})}),(()=>{let e=[...t.UserConfig.Users].sort((e,r)=>{let t=e=>e.username===b?0:"owner"===e.role?1:"admin"===e.role?2:3;return t(e)-t(r)});return(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:e.map(e=>{let r="owner"!==e.role&&("owner"===s||"admin"===s&&("user"===e.role||e.username===b)),t=e.username!==b&&("owner"===s||"admin"===s&&"user"===e.role),n=e.username!==b&&("owner"===s||"admin"===s&&"user"===e.role);return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100",children:e.username}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("owner"===e.role?"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300":"admin"===e.role?"bg-purple-100 dark:bg-purple-900/20 text-purple-800 dark:text-purple-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300"),children:"owner"===e.role?"站长":"admin"===e.role?"管理员":"普通用户"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(e.banned?"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300":"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300"),children:e.banned?"已封禁":"正常"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[r&&(0,a.jsx)("button",{onClick:()=>D(e.username),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900/40 dark:hover:bg-blue-900/60 dark:text-blue-200 transition-colors",children:"修改密码"}),n&&(0,a.jsxs)(a.Fragment,{children:["user"===e.role&&(0,a.jsx)("button",{onClick:()=>v(e.username),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 hover:bg-purple-200 dark:bg-purple-900/40 dark:hover:bg-purple-900/60 dark:text-purple-200 transition-colors",children:"设为管理"}),"admin"===e.role&&(0,a.jsx)("button",{onClick:()=>N(e.username),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700/40 dark:hover:bg-gray-700/60 dark:text-gray-200 transition-colors",children:"取消管理"}),"owner"!==e.role&&(e.banned?(0,a.jsx)("button",{onClick:()=>k(e.username),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900/40 dark:hover:bg-green-900/60 dark:text-green-300 transition-colors",children:"解封"}):(0,a.jsx)("button",{onClick:()=>p(e.username),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-red-100 text-red-800 hover:bg-red-200 dark:bg-red-900/40 dark:hover:bg-red-900/60 dark:text-red-300 transition-colors",children:"封禁"}))]}),t&&(0,a.jsx)("button",{onClick:()=>T(e.username),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-red-600 text-white hover:bg-red-700 dark:bg-red-600 dark:hover:bg-red-700 transition-colors",children:"删除用户"})]})]},e.username)})})})()]})})]})]}):(0,a.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"加载中..."})},I=e=>{let{config:r,refreshConfig:t}=e,[d,i]=(0,f.useState)([]),[c,g]=(0,f.useState)(!1),[x,u]=(0,f.useState)(!1),[m,y]=(0,f.useState)({name:"",key:"",api:"",detail:"",disabled:!1,from:"config"}),b=(0,s.Dy)((0,s.VT)(s.we,{activationConstraint:{distance:5}}),(0,s.VT)(s.LO,{activationConstraint:{delay:150,tolerance:5}}));(0,f.useEffect)(()=>{(null==r?void 0:r.SourceConfig)&&(i(r.SourceConfig),u(!1))},[r]);let h=async e=>{try{let r=await fetch("/api/admin/source",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"操作失败: ".concat(r.status))}await t()}catch(e){throw E(e instanceof Error?e.message:"操作失败"),e}},k=e=>{let r=d.find(r=>r.key===e);if(!r)return;let t=r.disabled?"enable":"disable";h({action:t,key:e}).catch(()=>{console.error("操作失败",t,e)})},j=e=>{h({action:"delete",key:e}).catch(()=>{console.error("操作失败","delete",e)})},w=e=>{let{source:r}=e,{attributes:t,listeners:s,setNodeRef:n,transform:d,transition:i}=(0,l.nB)({id:r.key}),c={transform:o.ux.Transform.toString(d),transition:i};return(0,a.jsxs)("tr",{ref:n,style:c,className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors select-none",children:[(0,a.jsx)("td",{className:"px-2 py-4 cursor-grab text-gray-400",style:{touchAction:"none"},...t,...s,children:(0,a.jsx)(p.Z,{size:16})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:r.name}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:r.key}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100 max-w-[12rem] truncate",title:r.api,children:r.api}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100 max-w-[8rem] truncate",title:r.detail||"-",children:r.detail||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap max-w-[1rem]",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(r.disabled?"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300":"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300"),children:r.disabled?"已禁用":"启用中"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[(0,a.jsx)("button",{onClick:()=>k(r.key),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium ".concat(r.disabled?"bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/60":"bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/60"," transition-colors"),children:r.disabled?"启用":"禁用"}),"config"!==r.from&&(0,a.jsx)("button",{onClick:()=>j(r.key),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700/40 dark:hover:bg-gray-700/60 dark:text-gray-200 transition-colors",children:"删除"})]})]})};return r?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"视频源列表"}),(0,a.jsx)("button",{onClick:()=>g(!c),className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors",children:c?"取消":"添加视频源"})]}),c&&(0,a.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"名称",value:m.name,onChange:e=>y(r=>({...r,name:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),(0,a.jsx)("input",{type:"text",placeholder:"Key",value:m.key,onChange:e=>y(r=>({...r,key:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),(0,a.jsx)("input",{type:"text",placeholder:"API 地址",value:m.api,onChange:e=>y(r=>({...r,api:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),(0,a.jsx)("input",{type:"text",placeholder:"Detail 地址（选填）",value:m.detail,onChange:e=>y(r=>({...r,detail:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{m.name&&m.key&&m.api&&h({action:"add",key:m.key,name:m.name,api:m.api,detail:m.detail}).then(()=>{y({name:"",key:"",api:"",detail:"",disabled:!1,from:"custom"}),g(!1)}).catch(()=>{console.error("操作失败","add",m)})},disabled:!m.name||!m.key||!m.api,className:"w-full sm:w-auto px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:"添加"})})]}),(0,a.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg max-h-[28rem] overflow-y-auto overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"w-8"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"名称"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Key"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"API 地址"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Detail 地址"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"状态"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)(s.LB,{sensors:b,collisionDetection:s.pE,onDragEnd:e=>{let{active:r,over:t}=e;if(!t||r.id===t.id)return;let a=d.findIndex(e=>e.key===r.id),s=d.findIndex(e=>e.key===t.id);i(e=>(0,l.Rp)(e,a,s)),u(!0)},autoScroll:!1,modifiers:[n.DL,n.F4],children:(0,a.jsx)(l.Fo,{items:d.map(e=>e.key),strategy:l.qw,children:(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.map(e=>(0,a.jsx)(w,{source:e},e.key))})})})]})}),x&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{let e=d.map(e=>e.key);h({action:"sort",order:e}).then(()=>{u(!1)}).catch(()=>{console.error("操作失败","sort",e)})},className:"px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"保存排序"})})]}):(0,a.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"加载中..."})},L=e=>{let{config:r,refreshConfig:t}=e,[d,i]=(0,f.useState)([]),[c,g]=(0,f.useState)(!1),[x,u]=(0,f.useState)(!1),[m,y]=(0,f.useState)({name:"",type:"movie",query:"",disabled:!1,from:"config"}),b=(0,s.Dy)((0,s.VT)(s.we,{activationConstraint:{distance:5}}),(0,s.VT)(s.LO,{activationConstraint:{delay:150,tolerance:5}}));(0,f.useEffect)(()=>{(null==r?void 0:r.CustomCategories)&&(i(r.CustomCategories),u(!1))},[r]);let h=async e=>{try{let r=await fetch("/api/admin/category",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"操作失败: ".concat(r.status))}await t()}catch(e){throw E(e instanceof Error?e.message:"操作失败"),e}},k=(e,r)=>{let t=d.find(t=>t.query===e&&t.type===r);if(!t)return;let a=t.disabled?"enable":"disable";h({action:a,query:e,type:r}).catch(()=>{console.error("操作失败",a,e,r)})},j=(e,r)=>{h({action:"delete",query:e,type:r}).catch(()=>{console.error("操作失败","delete",e,r)})},w=e=>{let{category:r}=e,{attributes:t,listeners:s,setNodeRef:n,transform:d,transition:i}=(0,l.nB)({id:"".concat(r.query,":").concat(r.type)}),c={transform:o.ux.Transform.toString(d),transition:i};return(0,a.jsxs)("tr",{ref:n,style:c,className:"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors select-none",children:[(0,a.jsx)("td",{className:"px-2 py-4 cursor-grab text-gray-400",style:{touchAction:"none"},...t,...s,children:(0,a.jsx)(p.Z,{size:16})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:r.name||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("movie"===r.type?"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300":"bg-purple-100 dark:bg-purple-900/20 text-purple-800 dark:text-purple-300"),children:"movie"===r.type?"电影":"电视剧"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100 max-w-[12rem] truncate",title:r.query,children:r.query}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap max-w-[1rem]",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat(r.disabled?"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300":"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300"),children:r.disabled?"已禁用":"启用中"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[(0,a.jsx)("button",{onClick:()=>k(r.query,r.type),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium ".concat(r.disabled?"bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/60":"bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/60"," transition-colors"),children:r.disabled?"启用":"禁用"}),"config"!==r.from&&(0,a.jsx)("button",{onClick:()=>j(r.query,r.type),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700/40 dark:hover:bg-gray-700/60 dark:text-gray-200 transition-colors",children:"删除"})]})]})};return r?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"自定义分类列表"}),(0,a.jsx)("button",{onClick:()=>g(!c),className:"px-3 py-1 text-sm rounded-lg transition-colors bg-green-600 hover:bg-green-700 text-white",children:c?"取消":"添加分类"})]}),c&&(0,a.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"分类名称",value:m.name,onChange:e=>y(r=>({...r,name:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),(0,a.jsxs)("select",{value:m.type,onChange:e=>y(r=>({...r,type:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[(0,a.jsx)("option",{value:"movie",children:"电影"}),(0,a.jsx)("option",{value:"tv",children:"电视剧"})]}),(0,a.jsx)("input",{type:"text",placeholder:"搜索关键词",value:m.query,onChange:e=>y(r=>({...r,query:e.target.value})),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{m.name&&m.query&&h({action:"add",name:m.name,type:m.type,query:m.query}).then(()=>{y({name:"",type:"movie",query:"",disabled:!1,from:"custom"}),g(!1)}).catch(()=>{console.error("操作失败","add",m)})},disabled:!m.name||!m.query,className:"w-full sm:w-auto px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:"添加"})})]}),(0,a.jsx)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg max-h-[28rem] overflow-y-auto overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"w-8"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"分类名称"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"类型"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"搜索关键词"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"状态"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"操作"})]})}),(0,a.jsx)(s.LB,{sensors:b,collisionDetection:s.pE,onDragEnd:e=>{let{active:r,over:t}=e;if(!t||r.id===t.id)return;let a=d.findIndex(e=>"".concat(e.query,":").concat(e.type)===r.id),s=d.findIndex(e=>"".concat(e.query,":").concat(e.type)===t.id);i(e=>(0,l.Rp)(e,a,s)),u(!0)},autoScroll:!1,modifiers:[n.DL,n.F4],children:(0,a.jsx)(l.Fo,{items:d.map(e=>"".concat(e.query,":").concat(e.type)),strategy:l.qw,children:(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:d.map(e=>(0,a.jsx)(w,{category:e},"".concat(e.query,":").concat(e.type)))})})})]})}),x&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{let e=d.map(e=>"".concat(e.query,":").concat(e.type));h({action:"sort",order:e}).then(()=>{u(!1)}).catch(()=>{console.error("操作失败","sort",e)})},className:"px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"保存排序"})})]}):(0,a.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"加载中..."})},R=e=>{let{config:r,refreshConfig:t}=e,[s,n]=(0,f.useState)(""),[l,o]=(0,f.useState)(!1),[d,i]=(0,f.useState)(""),[c,g]=(0,f.useState)(!1),[x,u]=(0,f.useState)(!1),[m,y]=(0,f.useState)("");(0,f.useEffect)(()=>{(null==r?void 0:r.ConfigFile)&&n(r.ConfigFile),(null==r?void 0:r.ConfigSubscribtion)&&(i(r.ConfigSubscribtion.URL),g(r.ConfigSubscribtion.AutoUpdate),y(r.ConfigSubscribtion.LastCheck||""))},[r]);let b=async()=>{if(!d.trim()){E("请输入订阅URL");return}try{u(!0);let e=await fetch("/api/admin/config_subscription/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d})});if(!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||"拉取失败: ".concat(e.status))}let r=await e.json();if(r.configContent){n(r.configContent);let e=new Date().toISOString();y(e),F("配置拉取成功")}else E("拉取失败：未获取到配置内容")}catch(e){E(e instanceof Error?e.message:"拉取失败")}finally{u(!1)}},h=async()=>{try{o(!0);let e=await fetch("/api/admin/config_file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configFile:s,subscriptionUrl:d,autoUpdate:c,lastCheckTime:m||new Date().toISOString()})});if(!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||"保存失败: ".concat(e.status))}F("配置文件保存成功"),await t()}catch(e){E(e instanceof Error?e.message:"保存失败")}finally{o(!1)}};return r?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"配置订阅"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 px-3 py-1.5 rounded-full",children:["最后更新: ",m?new Date(m).toLocaleString("zh-CN"):"从未更新"]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"订阅URL"}),(0,a.jsx)("input",{type:"url",value:d,onChange:e=>i(e.target.value),placeholder:"https://example.com/config.json",disabled:!1,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 shadow-sm hover:border-gray-400 dark:hover:border-gray-500"}),(0,a.jsx)("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"输入配置文件的订阅地址，要求 JSON 格式，且使用 Base58 编码"})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)("button",{onClick:b,disabled:x||!d.trim(),className:"w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 ".concat(x||!d.trim()?"bg-gray-300 dark:bg-gray-600 cursor-not-allowed text-gray-500 dark:text-gray-400":"bg-green-600 hover:bg-green-700 text-white shadow-sm hover:shadow-md transform hover:-translate-y-0.5"),children:x?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"拉取中…"]}):"拉取配置"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"自动更新"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"启用后系统将定期自动拉取最新配置"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>g(!c),disabled:!1,className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 ".concat(c?"bg-green-600":"bg-gray-200 dark:bg-gray-700"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(c?"translate-x-6":"translate-x-1")})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("textarea",{value:s,onChange:e=>n(e.target.value),rows:20,placeholder:"请输入配置文件内容（JSON 格式）...",disabled:!1,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono text-sm leading-relaxed resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-gray-400 dark:hover:border-gray-500",style:{fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace'},spellCheck:!1,"data-gramm":!1})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"支持 JSON 格式，用于配置视频源和自定义分类"}),(0,a.jsx)("button",{onClick:h,disabled:l,className:"px-4 py-2 rounded-lg transition-colors ".concat(l?"bg-gray-400 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-700 text-white"),children:l?"保存中…":"保存"})]})]})]}):(0,a.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"加载中..."})},B=e=>{var r,t;let{config:s,refreshConfig:n}=e,[l,o]=(0,f.useState)({SiteName:"",Announcement:"",SearchDownstreamMaxPage:1,SiteInterfaceCacheTime:7200,DoubanProxyType:"melody-cdn-sharon",DoubanProxy:"",DoubanImageProxyType:"melody-cdn-sharon",DoubanImageProxy:"",DisableYellowFilter:!1,FluidSearch:!0}),[d,x]=(0,f.useState)(!1),[u,m]=(0,f.useState)(!1),[y,b]=(0,f.useState)(!1),h=[{value:"direct",label:"直连（服务器直接请求豆瓣）"},{value:"melody-cdn-sharon",label:"豆瓣 CDN By 旋律（Sharon CDN）"},{value:"cors-proxy-zwei",label:"Cors Proxy By Zwei"},{value:"cmliussss-cdn-tencent",label:"豆瓣 CDN By CMLiussss（腾讯云）"},{value:"cmliussss-cdn-ali",label:"豆瓣 CDN By CMLiussss（阿里云）"},{value:"custom",label:"自定义代理"}],p=[{value:"direct",label:"直连（浏览器直接请求豆瓣）"},{value:"server",label:"服务器代理（由服务器代理请求豆瓣）"},{value:"img3",label:"豆瓣官方精品 CDN（阿里云）"},{value:"melody-cdn-sharon",label:"豆瓣 CDN By 旋律（Sharon CDN）"},{value:"cmliussss-cdn-tencent",label:"豆瓣 CDN By CMLiussss（腾讯云）"},{value:"cmliussss-cdn-ali",label:"豆瓣 CDN By CMLiussss（阿里云）"},{value:"custom",label:"自定义代理"}],k=e=>{switch(e){case"melody-cdn-sharon":return{text:"Thanks to @JohnsonRan",url:"https://github.com/JohnsonRan"};case"cors-proxy-zwei":return{text:"Thanks to @Zwei",url:"https://github.com/bestzwei"};case"cmliussss-cdn-tencent":case"cmliussss-cdn-ali":return{text:"Thanks to @CMLiussss",url:"https://github.com/cmliu"};default:return null}};(0,f.useEffect)(()=>{(null==s?void 0:s.SiteConfig)&&o({...s.SiteConfig,DoubanProxyType:s.SiteConfig.DoubanProxyType||"melody-cdn-sharon",DoubanProxy:s.SiteConfig.DoubanProxy||"",DoubanImageProxyType:s.SiteConfig.DoubanImageProxyType||"melody-cdn-sharon",DoubanImageProxy:s.SiteConfig.DoubanImageProxy||"",DisableYellowFilter:s.SiteConfig.DisableYellowFilter||!1,FluidSearch:s.SiteConfig.FluidSearch||!0})},[s]),(0,f.useEffect)(()=>{let e=e=>{u&&!e.target.closest('[data-dropdown="douban-datasource"]')&&m(!1)};if(u)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[u]),(0,f.useEffect)(()=>{let e=e=>{y&&!e.target.closest('[data-dropdown="douban-image-proxy"]')&&b(!1)};if(y)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[y]);let j=e=>{o(r=>({...r,DoubanProxyType:e}))},w=e=>{o(r=>({...r,DoubanImageProxyType:e}))},v=async()=>{try{x(!0);let e=await fetch("/api/admin/site",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l})});if(!e.ok){let r=await e.json().catch(()=>({}));throw Error(r.error||"保存失败: ".concat(e.status))}F("保存成功, 请刷新页面"),await n()}catch(e){E(e instanceof Error?e.message:"保存失败")}finally{x(!1)}};return s?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"站点名称"}),(0,a.jsx)("input",{type:"text",value:l.SiteName,onChange:e=>o(r=>({...r,SiteName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"站点公告"}),(0,a.jsx)("textarea",{value:l.Announcement,onChange:e=>o(r=>({...r,Announcement:e.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"豆瓣数据代理"}),(0,a.jsxs)("div",{className:"relative","data-dropdown":"douban-datasource",children:[(0,a.jsx)("button",{type:"button",onClick:()=>m(!u),className:"w-full px-3 py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:border-gray-400 dark:hover:border-gray-500 text-left",children:null===(r=h.find(e=>e.value===l.DoubanProxyType))||void 0===r?void 0:r.label}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,a.jsx)(i.Z,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform duration-200 ".concat(u?"rotate-180":"")})}),u&&(0,a.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:h.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{j(e.value),m(!1)},className:"w-full px-3 py-2.5 text-left text-sm transition-colors duration-150 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 ".concat(l.DoubanProxyType===e.value?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"),children:[(0,a.jsx)("span",{className:"truncate",children:e.label}),l.DoubanProxyType===e.value&&(0,a.jsx)(c.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 ml-2"})]},e.value))})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"选择获取豆瓣数据的方式"}),k(l.DoubanProxyType)&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("button",{type:"button",onClick:()=>window.open(k(l.DoubanProxyType).url,"_blank"),className:"flex items-center justify-center gap-1.5 w-full px-3 text-xs text-gray-500 dark:text-gray-400 cursor-pointer",children:[(0,a.jsx)("span",{className:"font-medium",children:k(l.DoubanProxyType).text}),(0,a.jsx)(g.Z,{className:"w-3.5 opacity-70"})]})})]}),"custom"===l.DoubanProxyType&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"豆瓣代理地址"}),(0,a.jsx)("input",{type:"text",placeholder:"例如: https://proxy.example.com/fetch?url=",value:l.DoubanProxy,onChange:e=>o(r=>({...r,DoubanProxy:e.target.value})),className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 shadow-sm hover:border-gray-400 dark:hover:border-gray-500"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"自定义代理服务器地址"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"豆瓣图片代理"}),(0,a.jsxs)("div",{className:"relative","data-dropdown":"douban-image-proxy",children:[(0,a.jsx)("button",{type:"button",onClick:()=>b(!y),className:"w-full px-3 py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:border-gray-400 dark:hover:border-gray-500 text-left",children:null===(t=p.find(e=>e.value===l.DoubanImageProxyType))||void 0===t?void 0:t.label}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,a.jsx)(i.Z,{className:"w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform duration-200 ".concat(y?"rotate-180":"")})}),y&&(0,a.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:p.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{w(e.value),b(!1)},className:"w-full px-3 py-2.5 text-left text-sm transition-colors duration-150 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 ".concat(l.DoubanImageProxyType===e.value?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"),children:[(0,a.jsx)("span",{className:"truncate",children:e.label}),l.DoubanImageProxyType===e.value&&(0,a.jsx)(c.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 ml-2"})]},e.value))})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"选择获取豆瓣图片的方式"}),k(l.DoubanImageProxyType)&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("button",{type:"button",onClick:()=>window.open(k(l.DoubanImageProxyType).url,"_blank"),className:"flex items-center justify-center gap-1.5 w-full px-3 text-xs text-gray-500 dark:text-gray-400 cursor-pointer",children:[(0,a.jsx)("span",{className:"font-medium",children:k(l.DoubanImageProxyType).text}),(0,a.jsx)(g.Z,{className:"w-3.5 opacity-70"})]})})]}),"custom"===l.DoubanImageProxyType&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"豆瓣图片代理地址"}),(0,a.jsx)("input",{type:"text",placeholder:"例如: https://proxy.example.com/fetch?url=",value:l.DoubanImageProxy,onChange:e=>o(r=>({...r,DoubanImageProxy:e.target.value})),className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 shadow-sm hover:border-gray-400 dark:hover:border-gray-500"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"自定义图片代理服务器地址"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"搜索接口可拉取最大页数"}),(0,a.jsx)("input",{type:"number",min:1,value:l.SearchDownstreamMaxPage,onChange:e=>o(r=>({...r,SearchDownstreamMaxPage:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"站点接口缓存时间（秒）"}),(0,a.jsx)("input",{type:"number",min:1,value:l.SiteInterfaceCacheTime,onChange:e=>o(r=>({...r,SiteInterfaceCacheTime:Number(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"禁用黄色过滤器"}),(0,a.jsx)("button",{type:"button",onClick:()=>o(e=>({...e,DisableYellowFilter:!e.DisableYellowFilter})),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 ".concat(l.DisableYellowFilter?"bg-green-600":"bg-gray-200 dark:bg-gray-700"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(l.DisableYellowFilter?"translate-x-6":"translate-x-1")})})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"禁用黄色内容的过滤功能，允许显示所有内容。"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"启用流式搜索"}),(0,a.jsx)("button",{type:"button",onClick:()=>o(e=>({...e,FluidSearch:!e.FluidSearch})),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 ".concat(l.FluidSearch?"bg-green-600":"bg-gray-200 dark:bg-gray-700"),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(l.FluidSearch?"translate-x-6":"translate-x-1")})})]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"启用后搜索结果将实时流式返回，提升用户体验。"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:v,disabled:d,className:"px-4 py-2 ".concat(d?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"," text-white rounded-lg transition-colors"),children:d?"保存中…":"保存"})})]}):(0,a.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"加载中..."})};function q(){let[e,r]=(0,f.useState)(null),[t,s]=(0,f.useState)(!0),[n,l]=(0,f.useState)(null),[o,d]=(0,f.useState)(null),[i,c]=(0,f.useState)({userConfig:!1,videoSource:!1,siteConfig:!1,categoryConfig:!1,configFile:!1,dataMigration:!1}),g=(0,f.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e&&s(!0);let t=await fetch("/api/admin/config");if(!t.ok){let e=await t.json();throw Error("获取配置失败: ".concat(e.error))}let a=await t.json();r(a.Config),d(a.Role)}catch(r){let e=r instanceof Error?r.message:"获取配置失败";E(e),l(e)}finally{e&&s(!1)}},[]);(0,f.useEffect)(()=>{g(!0)},[g]);let p=e=>{c(r=>({...r,[e]:!r[e]}))},k=async()=>{let{isConfirmed:e}=await j().fire({title:"确认重置配置",text:"此操作将重置用户封禁和管理员设置、自定义视频源，站点配置将重置为默认值，是否继续？",icon:"warning",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"});if(e)try{let e=await fetch("/api/admin/reset");if(!e.ok)throw Error("重置失败: ".concat(e.status));F("重置成功，请刷新页面！"),await g()}catch(e){E(e instanceof Error?e.message:"重置失败")}};return t?(0,a.jsx)(P.Z,{activePath:"/admin",children:(0,a.jsx)("div",{className:"px-2 sm:px-10 py-4 sm:py-8",children:(0,a.jsxs)("div",{className:"max-w-[95%] mx-auto",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-8",children:"管理员设置"}),(0,a.jsx)("div",{className:"space-y-4",children:Array.from({length:3}).map((e,r)=>(0,a.jsx)("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg animate-pulse"},r))})]})})}):n?null:(0,a.jsx)(P.Z,{activePath:"/admin",children:(0,a.jsx)("div",{className:"px-2 sm:px-10 py-4 sm:py-8",children:(0,a.jsxs)("div",{className:"max-w-[95%] mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"管理员设置"}),e&&"owner"===o&&(0,a.jsx)("button",{onClick:k,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-md transition-colors",children:"重置配置"})]}),"owner"===o&&(0,a.jsx)(O,{title:"配置文件",icon:(0,a.jsx)(x.Z,{size:20,className:"text-gray-600 dark:text-gray-400"}),isExpanded:i.configFile,onToggle:()=>p("configFile"),children:(0,a.jsx)(R,{config:e,refreshConfig:g})}),(0,a.jsx)(O,{title:"站点配置",icon:(0,a.jsx)(u.Z,{size:20,className:"text-gray-600 dark:text-gray-400"}),isExpanded:i.siteConfig,onToggle:()=>p("siteConfig"),children:(0,a.jsx)(B,{config:e,refreshConfig:g})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(O,{title:"用户配置",icon:(0,a.jsx)(m.Z,{size:20,className:"text-gray-600 dark:text-gray-400"}),isExpanded:i.userConfig,onToggle:()=>p("userConfig"),children:(0,a.jsx)(Z,{config:e,role:o,refreshConfig:g})}),(0,a.jsx)(O,{title:"视频源配置",icon:(0,a.jsx)(y.Z,{size:20,className:"text-gray-600 dark:text-gray-400"}),isExpanded:i.videoSource,onToggle:()=>p("videoSource"),children:(0,a.jsx)(I,{config:e,refreshConfig:g})}),(0,a.jsx)(O,{title:"分类配置",icon:(0,a.jsx)(b.Z,{size:20,className:"text-gray-600 dark:text-gray-400"}),isExpanded:i.categoryConfig,onToggle:()=>p("categoryConfig"),children:(0,a.jsx)(L,{config:e,refreshConfig:g})}),"owner"===o&&(0,a.jsx)(O,{title:"数据迁移",icon:(0,a.jsx)(h.Z,{size:20,className:"text-gray-600 dark:text-gray-400"}),isExpanded:i.dataMigration,onToggle:()=>p("dataMigration"),children:(0,a.jsx)(T,{onRefreshConfig:g})})]})]})})})}function z(){return(0,a.jsx)(f.Suspense,{children:(0,a.jsx)(q,{})})}}},function(e){e.O(0,[434,816,806,488,541,242,744],function(){return e(e.s=2093)}),_N_E=e.O()}]);