(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{61:function(e,t,r){Promise.resolve().then(r.bind(r,4650))},4650:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(4393),a=r(9539),l=r.n(a),s=r(2258),o=r(4187),i=r(1698),c=r(4908),u=r(7467),d=r(1802),h=e=>{let{totalEpisodes:t,episodes_titles:r,episodesPerPage:a=50,value:l=1,onChange:s,onSourceChange:o,currentSource:u,currentId:h,videoTitle:m,availableSources:f=[],sourceSearchLoading:g=!1,sourceSearchError:x=null,precomputedVideoInfo:p}=e,v=(0,i.useRouter)(),y=Math.ceil(t/a),[w,b]=(0,c.useState)(new Map),[j,k]=(0,c.useState)(new Set),N=(0,c.useRef)(new Set),S=(0,c.useRef)(new Map);(0,c.useEffect)(()=>{N.current=j},[j]),(0,c.useEffect)(()=>{S.current=w},[w]);let[M,D]=(0,c.useState)(t>1?"episodes":"sources"),[E,C]=(0,c.useState)(Math.floor((l-1)/a)),[R,_]=(0,c.useState)(!1),L=(0,c.useMemo)(()=>R?y-1-E:E,[E,R,y]),T=(0,c.useCallback)(async e=>{let t="".concat(e.source,"-").concat(e.id);if(N.current.has(t)||!e.episodes||0===e.episodes.length)return;let r=e.episodes.length>1?e.episodes[1]:e.episodes[0];k(e=>new Set(e).add(t));try{let e=await (0,d.e9)(r);b(r=>new Map(r).set(t,e))}catch(e){b(e=>new Map(e).set(t,{quality:"错误",loadSpeed:"未知",pingTime:0,hasError:!0}))}},[]);(0,c.useEffect)(()=>{p&&p.size>0&&(b(e=>{let t=new Map(e);return p.forEach((e,r)=>{t.set(r,e)}),t}),k(e=>{let t=new Set(e);return p.forEach((e,r)=>{e.hasError||t.add(r)}),t}),p.forEach((e,t)=>{e.hasError||N.current.add(t)}))},[p]);let[P]=(0,c.useState)(()=>{{let e=localStorage.getItem("enableOptimization");if(null!==e)try{return JSON.parse(e)}catch(e){}}return!0});(0,c.useEffect)(()=>{(async()=>{if(!P||"sources"!==M||0===f.length)return;let e=f.filter(e=>{let t="".concat(e.source,"-").concat(e.id);return!N.current.has(t)});if(0===e.length)return;let t=Math.ceil(e.length/2);for(let r=0;r<e.length;r+=t){let n=e.slice(r,r+t);await Promise.all(n.map(T))}})()},[M,f,T,P]);let I=(0,c.useMemo)(()=>Array.from({length:y},(e,r)=>{let n=r*a+1,l=Math.min(n+a-1,t);return{start:n,end:l}}),[y,a,t]),A=(0,c.useMemo)(()=>R?[...I].reverse().map(e=>{let{start:t,end:r}=e;return"".concat(r,"-").concat(t)}):I.map(e=>{let{start:t,end:r}=e;return"".concat(t,"-").concat(r)}),[I,R]),B=(0,c.useRef)(null),Z=(0,c.useRef)([]);(0,c.useEffect)(()=>{let e=Z.current[L],t=B.current;if(e&&t){let r=t.getBoundingClientRect(),n=e.getBoundingClientRect(),a=t.scrollLeft,l=n.left-r.left+a,s=n.width,o=r.width;t.scrollTo({left:l-(o-s)/2,behavior:"smooth"})}},[L,y]);let O=(0,c.useCallback)(e=>{R?C(y-1-e):C(e)},[R,y]),U=(0,c.useCallback)(e=>{null==s||s(e)},[s]),F=(0,c.useCallback)(e=>{null==o||o(e.source,e.id,e.title)},[o]),W=E*a+1,z=Math.min(W+a-1,t);return(0,n.jsxs)("div",{className:"md:ml-2 px-4 py-0 h-full rounded-xl bg-black/10 dark:bg-white/5 flex flex-col border border-white/0 dark:border-white/30 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex mb-1 -mx-6 flex-shrink-0",children:[t>1&&(0,n.jsx)("div",{onClick:()=>D("episodes"),className:"flex-1 py-3 px-6 text-center cursor-pointer transition-all duration-200 font-medium\n              ".concat("episodes"===M?"text-green-600 dark:text-green-400":"text-gray-700 hover:text-green-600 bg-black/5 dark:bg-white/5 dark:text-gray-300 dark:hover:text-green-400 hover:bg-black/3 dark:hover:bg-white/3","\n            ").trim(),children:"选集"}),(0,n.jsx)("div",{onClick:()=>{D("sources")},className:"flex-1 py-3 px-6 text-center cursor-pointer transition-all duration-200 font-medium\n            ".concat("sources"===M?"text-green-600 dark:text-green-400":"text-gray-700 hover:text-green-600 bg-black/5 dark:bg-white/5 dark:text-gray-300 dark:hover:text-green-400 hover:bg-black/3 dark:hover:bg-white/3","\n          ").trim(),children:"换源"})]}),"episodes"===M&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-4 border-b border-gray-300 dark:border-gray-700 -mx-6 px-6 flex-shrink-0",children:[(0,n.jsx)("div",{className:"flex-1 overflow-x-auto",ref:B,children:(0,n.jsx)("div",{className:"flex gap-2 min-w-max",children:A.map((e,t)=>{let r=t===L;return(0,n.jsxs)("button",{ref:e=>{Z.current[t]=e},onClick:()=>O(t),className:"w-20 relative py-2 text-sm font-medium transition-colors whitespace-nowrap flex-shrink-0 text-center \n                        ".concat(r?"text-green-500 dark:text-green-400":"text-gray-700 hover:text-green-600 dark:text-gray-300 dark:hover:text-green-400","\n                      ").trim(),children:[e,r&&(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-green-500 dark:bg-green-400"})]},e)})})}),(0,n.jsx)("button",{className:"flex-shrink-0 w-8 h-8 rounded-md flex items-center justify-center text-gray-700 hover:text-green-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-green-400 dark:hover:bg-white/20 transition-colors transform translate-y-[-4px]",onClick:()=>{_(e=>!e)},children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})})})]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-3 overflow-y-auto flex-1 content-start pb-4",children:Array.from({length:z-W+1},(e,t)=>R?z-t:W+t).map(e=>{let t=e===l;return(0,n.jsx)("button",{onClick:()=>U(e-1),className:"h-10 min-w-10 px-3 py-2 flex items-center justify-center text-sm font-medium rounded-md transition-all duration-200 whitespace-nowrap font-mono\n                    ".concat(t?"bg-green-500 text-white shadow-lg shadow-green-500/25 dark:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300 hover:scale-105 dark:bg-white/10 dark:text-gray-300 dark:hover:bg-white/20").trim(),children:(()=>{let t=null==r?void 0:r[e-1];if(!t)return e;let n=t.match(/(?:第)?(\d+)(?:集|话)/);return n?n[1]:t})()},e)})})]}),"sources"===M&&(0,n.jsxs)("div",{className:"flex flex-col h-full mt-4",children:[g&&(0,n.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"}),(0,n.jsx)("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-300",children:"搜索中..."})]}),x&&(0,n.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-red-500 text-2xl mb-2",children:"⚠️"}),(0,n.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:x})]})}),!g&&!x&&0===f.length&&(0,n.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-gray-400 text-2xl mb-2",children:"\uD83D\uDCFA"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"暂无可用的换源"})]})}),!g&&!x&&f.length>0&&(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-2 pb-20",children:[f.sort((e,t)=>{var r,n,a,l;let s=(null===(r=e.source)||void 0===r?void 0:r.toString())===(null==u?void 0:u.toString())&&(null===(n=e.id)||void 0===n?void 0:n.toString())===(null==h?void 0:h.toString()),o=(null===(a=t.source)||void 0===a?void 0:a.toString())===(null==u?void 0:u.toString())&&(null===(l=t.id)||void 0===l?void 0:l.toString())===(null==h?void 0:h.toString());return s&&!o?-1:!s&&o?1:0}).map((e,t)=>{var r,a;let l=(null===(r=e.source)||void 0===r?void 0:r.toString())===(null==u?void 0:u.toString())&&(null===(a=e.id)||void 0===a?void 0:a.toString())===(null==h?void 0:h.toString());return(0,n.jsxs)("div",{onClick:()=>!l&&F(e),className:"flex items-start gap-3 px-2 py-3 rounded-lg transition-all select-none duration-200 relative\n                      ".concat(l?"bg-green-500/10 dark:bg-green-500/20 border-green-500/30 border":"hover:bg-gray-200/50 dark:hover:bg-white/10 hover:scale-[1.02] cursor-pointer").trim(),children:[(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-20 bg-gray-300 dark:bg-gray-600 rounded overflow-hidden",children:e.episodes&&e.episodes.length>0&&(0,n.jsx)("img",{src:(0,d.a8)(e.poster),alt:e.title,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col justify-between h-20",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3 h-6",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0 relative group/title",children:[(0,n.jsx)("h3",{className:"font-medium text-base truncate text-gray-900 dark:text-gray-100 leading-none",children:e.title}),0!==t&&(0,n.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1 bg-gray-800 text-white text-xs rounded-md shadow-lg opacity-0 invisible group-hover/title:opacity-100 group-hover/title:visible transition-all duration-200 ease-out delay-100 whitespace-nowrap z-[500] pointer-events-none",children:[e.title,(0,n.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),(()=>{let t="".concat(e.source,"-").concat(e.id),r=w.get(t);if(r&&"未知"!==r.quality){if(r.hasError)return(0,n.jsx)("div",{className:"bg-gray-500/10 dark:bg-gray-400/20 text-red-600 dark:text-red-400 px-1.5 py-0 rounded text-xs flex-shrink-0 min-w-[50px] text-center",children:"检测失败"});{let e=["4K","2K"].includes(r.quality),t=["1080p","720p"].includes(r.quality);return(0,n.jsx)("div",{className:"bg-gray-500/10 dark:bg-gray-400/20 ".concat(e?"text-purple-600 dark:text-purple-400":t?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"," px-1.5 py-0 rounded text-xs flex-shrink-0 min-w-[50px] text-center"),children:r.quality})}}return null})()]}),(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{className:"text-xs px-2 py-1 border border-gray-500/60 rounded text-gray-700 dark:text-gray-300",children:e.source_name}),e.episodes.length>1&&(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:[e.episodes.length," 集"]})]}),(0,n.jsx)("div",{className:"flex items-end h-6",children:(()=>{let t="".concat(e.source,"-").concat(e.id),r=w.get(t);if(r)return r.hasError?(0,n.jsx)("div",{className:"text-red-500/90 dark:text-red-400 font-medium text-xs",children:"无测速数据"}):(0,n.jsxs)("div",{className:"flex items-end gap-3 text-xs",children:[(0,n.jsx)("div",{className:"text-green-600 dark:text-green-400 font-medium text-xs",children:r.loadSpeed}),(0,n.jsxs)("div",{className:"text-orange-600 dark:text-orange-400 font-medium text-xs",children:[r.pingTime,"ms"]})]})})()})]})]},"".concat(e.source,"-").concat(e.id))}),(0,n.jsx)("div",{className:"flex-shrink-0 mt-auto pt-2 border-t border-gray-400 dark:border-gray-700",children:(0,n.jsx)("button",{onClick:()=>{m&&v.push("/search?q=".concat(encodeURIComponent(m)))},className:"w-full text-center text-xs text-gray-500 dark:text-gray-400 hover:text-green-500 dark:hover:text-green-400 transition-colors py-2",children:"影片匹配有误？点击去搜索"})})]})]})]})},m=r(6488),f=r(8766);function g(){var e,t;let r=(0,i.useRouter)(),a=(0,i.useSearchParams)(),[o,g]=(0,c.useState)(!0),[p,v]=(0,c.useState)("searching"),[y,w]=(0,c.useState)("正在搜索播放源..."),[b,j]=(0,c.useState)(null),[k,N]=(0,c.useState)(null),[S,M]=(0,c.useState)(!1),[D,E]=(0,c.useState)({enable:!1,intro_time:0,outro_time:0}),C=(0,c.useRef)(D);(0,c.useEffect)(()=>{C.current=D},[D,D.enable,D.intro_time,D.outro_time]);let R=(0,c.useRef)(0),[_,L]=(0,c.useState)(()=>{{let e=localStorage.getItem("enable_blockad");if(null!==e)return"true"===e}return!0}),T=(0,c.useRef)(_);(0,c.useEffect)(()=>{T.current=_},[_]);let[P,I]=(0,c.useState)(a.get("title")||""),[A,B]=(0,c.useState)(a.get("year")||""),[Z,O]=(0,c.useState)(""),[U,F]=(0,c.useState)(0),[W,z]=(0,c.useState)(a.get("source")||""),[q,V]=(0,c.useState)(a.get("id")||""),[G]=(0,c.useState)(a.get("stitle")||""),[K]=(0,c.useState)(a.get("stype")||""),[Y,H]=(0,c.useState)("true"===a.get("prefer")),J=(0,c.useRef)(Y);(0,c.useEffect)(()=>{J.current=Y},[Y]);let[X,Q]=(0,c.useState)(0),$=(0,c.useRef)(W),ee=(0,c.useRef)(q),et=(0,c.useRef)(P),er=(0,c.useRef)(A),en=(0,c.useRef)(k),ea=(0,c.useRef)(X);(0,c.useEffect)(()=>{$.current=W,ee.current=q,en.current=k,ea.current=X,et.current=P,er.current=A},[W,q,k,X,P,A]);let[el,es]=(0,c.useState)(""),eo=(null==k?void 0:null===(e=k.episodes)||void 0===e?void 0:e.length)||0,ei=(0,c.useRef)(null),ec=(0,c.useRef)(.7),eu=(0,c.useRef)(1),[ed,eh]=(0,c.useState)([]),[em,ef]=(0,c.useState)(!1),[eg,ex]=(0,c.useState)(null),[ep]=(0,c.useState)(()=>{{let e=localStorage.getItem("enableOptimization");if(null!==e)try{return JSON.parse(e)}catch(e){}}return!0}),[ev,ey]=(0,c.useState)(new Map),[ew,eb]=(0,c.useState)(!1),[ej,ek]=(0,c.useState)(!0),[eN,eS]=(0,c.useState)("initing"),eM=(0,c.useRef)(null),eD=(0,c.useRef)(0),eE=(0,c.useRef)(null),eC=(0,c.useRef)(null),eR=(0,c.useRef)(null),e_=async e=>{if(1===e.length)return e[0];let t=Math.ceil(e.length/2),r=[];for(let n=0;n<e.length;n+=t){let a=e.slice(n,n+t),l=await Promise.all(a.map(async e=>{try{if(!e.episodes||0===e.episodes.length)return console.warn("播放源 ".concat(e.source_name," 没有可用的播放地址")),null;let t=e.episodes.length>1?e.episodes[1]:e.episodes[0],r=await (0,d.e9)(t);return{source:e,testResult:r}}catch(e){return null}}));r.push(...l)}let n=new Map;r.forEach((t,r)=>{let a=e[r],l="".concat(a.source,"-").concat(a.id);t&&n.set(l,t.testResult)});let a=r.filter(Boolean);if(ey(n),0===a.length)return console.warn("所有播放源测速都失败，使用第一个播放源"),e[0];let l=a.map(e=>{let t=e.testResult.loadSpeed;if("未知"===t||"测量中..."===t)return 0;let r=t.match(/^([\d.]+)\s*(KB\/s|MB\/s)$/);if(!r)return 0;let n=parseFloat(r[1]);return"MB/s"===r[2]?1024*n:n}).filter(e=>e>0),s=l.length>0?Math.max(...l):1024,o=a.map(e=>e.testResult.pingTime).filter(e=>e>0),i=o.length>0?Math.min(...o):50,c=o.length>0?Math.max(...o):1e3,u=a.map(e=>({...e,score:eL(e.testResult,s,i,c)}));return u.sort((e,t)=>t.score-e.score),console.log("播放源评分排序结果:"),u.forEach((e,t)=>{console.log("".concat(t+1,". ").concat(e.source.source_name," - 评分: ").concat(e.score.toFixed(2)," (").concat(e.testResult.quality,", ").concat(e.testResult.loadSpeed,", ").concat(e.testResult.pingTime,"ms)"))}),u[0].source},eL=(e,t,r,n)=>{let a;return Math.round(100*(0+.4*(()=>{switch(e.quality){case"4K":return 100;case"2K":return 85;case"1080p":return 75;case"720p":return 60;case"480p":return 40;case"SD":return 20;default:return 0}})()+.4*(()=>{let r=e.loadSpeed;if("未知"===r||"测量中..."===r)return 30;let n=r.match(/^([\d.]+)\s*(KB\/s|MB\/s)$/);if(!n)return 30;let a=parseFloat(n[1]);return Math.min(100,Math.max(0,("MB/s"===n[2]?1024*a:a)/t*100))})()+.2*(()=>{let t=e.pingTime;return t<=0?0:n===r?100:Math.min(100,Math.max(0,(n-t)/(n-r)*100))})()))/100},eT=(e,t)=>{if(!e||!e.episodes||t>=e.episodes.length){es("");return}let r=(null==e?void 0:e.episodes[t])||"";r!==el&&es(r)},eP=(e,t)=>{if(!e||!t)return;let r=Array.from(e.getElementsByTagName("source"));if(!r.some(e=>e.src===t)){r.forEach(e=>e.remove());let n=document.createElement("source");n.src=t,e.appendChild(n)}e.disableRemotePlayback=!1,e.hasAttribute("disableRemotePlayback")&&e.removeAttribute("disableRemotePlayback")},eI=async()=>{try{"wakeLock"in navigator&&(eR.current=await navigator.wakeLock.request("screen"),console.log("Wake Lock 已启用"))}catch(e){console.warn("Wake Lock 请求失败:",e)}},eA=async()=>{try{eR.current&&(await eR.current.release(),eR.current=null,console.log("Wake Lock 已释放"))}catch(e){console.warn("Wake Lock 释放失败:",e)}},eB=()=>{if(eE.current)try{eE.current.video&&eE.current.video.hls&&eE.current.video.hls.destroy(),eE.current.destroy(),eE.current=null,console.log("播放器资源已清理")}catch(e){console.warn("清理播放器资源时出错:",e),eE.current=null}},eZ=async e=>{if($.current&&ee.current)try{E(e),e.enable||e.intro_time||e.outro_time?await (0,u.C2)($.current,ee.current,e):(await (0,u.Lj)($.current,ee.current),eE.current.setting.update({name:"跳过片头片尾",html:"跳过片头片尾",switch:C.current.enable,onSwitch:function(e){let t={...C.current,enable:!e.switch};return eZ(t),!e.switch}}),eE.current.setting.update({name:"设置片头",html:"设置片头",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="5" cy="12" r="2" fill="#ffffff"/><path d="M9 12L17 12" stroke="#ffffff" stroke-width="2"/><path d="M17 6L17 18" stroke="#ffffff" stroke-width="2"/></svg>',tooltip:0===C.current.intro_time?"设置片头时间":"".concat(eO(C.current.intro_time)),onClick:function(){var e;let t=(null===(e=eE.current)||void 0===e?void 0:e.currentTime)||0;if(t>0){let e={...C.current,intro_time:t};return eZ(e),"".concat(eO(t))}}}),eE.current.setting.update({name:"设置片尾",html:"设置片尾",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 6L7 18" stroke="#ffffff" stroke-width="2"/><path d="M7 12L15 12" stroke="#ffffff" stroke-width="2"/><circle cx="19" cy="12" r="2" fill="#ffffff"/></svg>',tooltip:C.current.outro_time>=0?"设置片尾时间":"-".concat(eO(-C.current.outro_time)),onClick:function(){var e,t;let r=-((null===(e=eE.current)||void 0===e?void 0:e.duration)-(null===(t=eE.current)||void 0===t?void 0:t.currentTime))||0;if(r<0){let e={...C.current,outro_time:r};return eZ(e),"-".concat(eO(-r))}}})),console.log("跳过片头片尾配置已保存:",e)}catch(e){console.error("保存跳过片头片尾配置失败:",e)}},eO=e=>{if(0===e)return"00:00";let t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.round(e%60);return 0===t?"".concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")):"".concat(t.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))};class eU extends s.ZP.DefaultConfig.loader{constructor(e){super(e);let t=this.load.bind(this);this.load=function(e,r,n){if("manifest"===e.type||"level"===e.type){let e=n.onSuccess;n.onSuccess=function(t,r,n){return t.data&&"string"==typeof t.data&&(t.data=function(e){if(!e)return"";let t=e.split("\n"),r=[];for(let e=0;e<t.length;e++){let n=t[e];n.includes("#EXT-X-DISCONTINUITY")||r.push(n)}return r.join("\n")}(t.data)),e(t,r,n,null)}}t(e,r,n)}}}(0,c.useEffect)(()=>{eT(k,X)},[k,X]),(0,c.useEffect)(()=>{let e=async(e,t)=>{try{let r=await fetch("/api/detail?source=".concat(e,"&id=").concat(t));if(!r.ok)throw Error("获取视频详情失败");let n=await r.json();return eh([n]),[n]}catch(e){return console.error("获取视频详情失败:",e),[]}finally{ef(!1)}},t=async e=>{try{let t=await fetch("/api/search?q=".concat(encodeURIComponent(e.trim())));if(!t.ok)throw Error("搜索失败");let r=(await t.json()).results.filter(e=>e.title.replaceAll(" ","").toLowerCase()===et.current.replaceAll(" ","").toLowerCase()&&(!er.current||e.year.toLowerCase()===er.current.toLowerCase())&&(!K||"tv"===K&&e.episodes.length>1||"movie"===K&&1===e.episodes.length));return eh(r),r}catch(e){return ex(e instanceof Error?e.message:"搜索失败"),eh([]),[]}finally{ef(!1)}};(async()=>{if(!W&&!q&&!P&&!G){j("缺少必要参数"),g(!1);return}g(!0),v(W&&q?"fetching":"searching"),w(W&&q?"\uD83C\uDFAC 正在获取视频详情...":"\uD83D\uDD0D 正在搜索播放源...");let r=await t(G||P);if(W&&q&&!r.some(e=>e.source===W&&e.id===q)&&(r=await e(W,q)),0===r.length){j("未找到匹配结果"),g(!1);return}let n=r[0];if(W&&q&&!J.current){let e=r.find(e=>e.source===W&&e.id===q);if(e)n=e;else{j("未找到匹配结果"),g(!1);return}}(!W||!q||J.current)&&ep&&(v("preferring"),w("⚡ 正在优选最佳播放源..."),n=await e_(r)),console.log(n.source,n.id),H(!1),z(n.source),V(n.id),B(n.year),I(n.title||et.current),O(n.poster),F(n.douban_id||0),N(n),X>=n.episodes.length&&Q(0);let a=new URL(window.location.href);a.searchParams.set("source",n.source),a.searchParams.set("id",n.id),a.searchParams.set("year",n.year),a.searchParams.set("title",n.title),a.searchParams.delete("prefer"),window.history.replaceState({},"",a.toString()),v("ready"),w("✨ 准备就绪，即将开始播放..."),setTimeout(()=>{g(!1)},1e3)})()},[]),(0,c.useEffect)(()=>{(async()=>{if(W&&q)try{let e=(await (0,u.Rr)())[(0,u.sO)(W,q)];if(e){let t=e.index-1,r=e.play_time;t!==X&&Q(t),ei.current=r}}catch(e){console.error("读取播放记录失败:",e)}})()},[]),(0,c.useEffect)(()=>{(async()=>{if(W&&q)try{let e=await (0,u.bP)(W,q);e&&E(e)}catch(e){console.error("读取跳过片头片尾配置失败:",e)}})()},[]);let eF=async(e,t,r)=>{try{var n;eS("sourceChanging"),ek(!0);let a=(null===(n=eE.current)||void 0===n?void 0:n.currentTime)||0;if(console.log("换源前当前播放时间:",a),$.current&&ee.current)try{await (0,u.Ji)($.current,ee.current),console.log("已清除前一个播放记录")}catch(e){console.error("清除播放记录失败:",e)}if($.current&&ee.current)try{await (0,u.Lj)($.current,ee.current),await (0,u.C2)(e,t,C.current)}catch(e){console.error("清除跳过片头片尾配置失败:",e)}let l=ed.find(r=>r.source===e&&r.id===t);if(!l){j("未找到匹配结果");return}let s=X;(!l.episodes||s>=l.episodes.length)&&(s=0),s!==X?ei.current=0:(!ei.current||0===ei.current)&&a>1&&(ei.current=a);let o=new URL(window.location.href);o.searchParams.set("source",e),o.searchParams.set("id",t),o.searchParams.set("year",l.year),window.history.replaceState({},"",o.toString()),I(l.title||r),B(l.year),O(l.poster),F(l.douban_id||0),z(e),V(t),N(l),Q(s)}catch(e){ek(!1),j(e instanceof Error?e.message:"换源失败")}};(0,c.useEffect)(()=>(document.addEventListener("keydown",eq),()=>{document.removeEventListener("keydown",eq)}),[]);let eW=()=>{let e=en.current,t=ea.current;e&&e.episodes&&t>0&&(eE.current&&!eE.current.paused&&eV(),Q(t-1))},ez=()=>{let e=en.current,t=ea.current;e&&e.episodes&&t<e.episodes.length-1&&(eE.current&&!eE.current.paused&&eV(),Q(t+1))},eq=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if(e.altKey&&"ArrowLeft"===e.key&&en.current&&ea.current>0&&(eW(),e.preventDefault()),e.altKey&&"ArrowRight"===e.key){let t=en.current,r=ea.current;t&&r<t.episodes.length-1&&(ez(),e.preventDefault())}!e.altKey&&"ArrowLeft"===e.key&&eE.current&&eE.current.currentTime>5&&(eE.current.currentTime-=10,e.preventDefault()),!e.altKey&&"ArrowRight"===e.key&&eE.current&&eE.current.currentTime<eE.current.duration-5&&(eE.current.currentTime+=10,e.preventDefault()),"ArrowUp"===e.key&&eE.current&&eE.current.volume<1&&(eE.current.volume=Math.round((eE.current.volume+.1)*10)/10,eE.current.notice.show="音量: ".concat(Math.round(100*eE.current.volume)),e.preventDefault()),"ArrowDown"===e.key&&eE.current&&eE.current.volume>0&&(eE.current.volume=Math.round((eE.current.volume-.1)*10)/10,eE.current.notice.show="音量: ".concat(Math.round(100*eE.current.volume)),e.preventDefault())," "===e.key&&eE.current&&(eE.current.toggle(),e.preventDefault()),("f"===e.key||"F"===e.key)&&eE.current&&(eE.current.fullscreen=!eE.current.fullscreen,e.preventDefault())}},eV=async()=>{var e,t,r,n,a,l;if(!eE.current||!$.current||!ee.current||!et.current||!(null===(e=en.current)||void 0===e?void 0:e.source_name))return;let s=eE.current,o=s.currentTime||0,i=s.duration||0;if(!(o<1)&&i)try{await (0,u.c1)($.current,ee.current,{title:et.current,source_name:(null===(t=en.current)||void 0===t?void 0:t.source_name)||"",year:null===(r=en.current)||void 0===r?void 0:r.year,cover:(null===(n=en.current)||void 0===n?void 0:n.poster)||"",index:ea.current+1,total_episodes:(null===(a=en.current)||void 0===a?void 0:a.episodes.length)||1,play_time:Math.floor(o),total_time:Math.floor(i),save_time:Date.now(),search_title:G}),eD.current=Date.now(),console.log("播放进度已保存:",{title:et.current,episode:ea.current+1,year:null===(l=en.current)||void 0===l?void 0:l.year,progress:"".concat(Math.floor(o),"/").concat(Math.floor(i))})}catch(e){console.error("保存播放进度失败:",e)}};(0,c.useEffect)(()=>{let e=()=>{eV(),eA(),eB()},t=()=>{"hidden"===document.visibilityState?(eV(),eA()):"visible"===document.visibilityState&&eE.current&&!eE.current.paused&&eI()};return window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("beforeunload",e),document.removeEventListener("visibilitychange",t)}},[X,k,eE.current]),(0,c.useEffect)(()=>()=>{eM.current&&clearInterval(eM.current)},[]),(0,c.useEffect)(()=>{W&&q&&(async()=>{try{let e=await (0,u.at)(W,q);M(e)}catch(e){console.error("检查收藏状态失败:",e)}})()},[W,q]),(0,c.useEffect)(()=>{if(W&&q)return(0,u.rq)("favoritesUpdated",e=>{M(!!e[(0,u.sO)(W,q)])})},[W,q]);let eG=async()=>{if(et.current&&en.current&&$.current&&ee.current)try{if(S)await (0,u.r7)($.current,ee.current),M(!1);else{var e,t,r,n;await (0,u.qn)($.current,ee.current,{title:et.current,source_name:(null===(e=en.current)||void 0===e?void 0:e.source_name)||"",year:null===(t=en.current)||void 0===t?void 0:t.year,cover:(null===(r=en.current)||void 0===r?void 0:r.poster)||"",total_episodes:(null===(n=en.current)||void 0===n?void 0:n.episodes.length)||1,save_time:Date.now(),search_title:G}),M(!0)}}catch(e){console.error("切换收藏失败:",e)}};return((0,c.useEffect)(()=>{var e,t;if(!l()||!s.ZP||!el||o||null===X||!eC.current)return;if(!k||!k.episodes||X>=k.episodes.length||X<0){j("选集索引无效，当前共 ".concat(eo," 集"));return}if(!el){j("视频地址无效");return}console.log(el);let r="function"==typeof window.webkitConvertPointFromNodeToPage;if(!r&&eE.current){eE.current.switch=el,eE.current.title="".concat(P," - 第").concat(X+1,"集"),eE.current.poster=Z,(null===(e=eE.current)||void 0===e?void 0:e.video)&&eP(eE.current.video,el);return}eE.current&&eB();try{l().PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2,3],l().USE_RAF=!0,eE.current=new(l())({container:eC.current,url:el,poster:Z,volume:.7,isLive:!1,muted:!1,autoplay:!0,pip:!0,autoSize:!1,autoMini:!1,screenshot:!1,setting:!0,loop:!1,flip:!1,playbackRate:!0,aspectRatio:!1,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!1,miniProgressBar:!1,mutex:!0,playsInline:!0,autoPlayback:!1,airplay:!0,theme:"#22c55e",lang:"zh-cn",hotkey:!1,fastForward:!0,autoOrientation:!0,lock:!0,moreVideoAttr:{crossOrigin:"anonymous"},customType:{m3u8:function(e,t){if(!s.ZP){console.error("HLS.js 未加载");return}e.hls&&e.hls.destroy();let r=new s.ZP({debug:!1,enableWorker:!0,lowLatencyMode:!0,maxBufferLength:30,backBufferLength:30,maxBufferSize:6e7,loader:T.current?eU:s.ZP.DefaultConfig.loader});r.loadSource(t),r.attachMedia(e),e.hls=r,eP(e,t),r.on(s.ZP.Events.ERROR,function(e,t){if(console.error("HLS Error:",e,t),t.fatal)switch(t.type){case s.ZP.ErrorTypes.NETWORK_ERROR:console.log("网络错误，尝试恢复..."),r.startLoad();break;case s.ZP.ErrorTypes.MEDIA_ERROR:console.log("媒体错误，尝试恢复..."),r.recoverMediaError();break;default:console.log("无法恢复的错误"),r.destroy()}})}},icons:{loading:'<img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48cGF0aCBkPSJNMjUuMjUxIDYuNDYxYy0xMC4zMTggMC0xOC42ODMgOC4zNjUtMTguNjgzIDE4LjY4M2g0LjA2OGMwLTguMDcgNi41NDUtMTQuNjE1IDE0LjYxNS0xNC42MTVWNi40NjF6IiBmaWxsPSIjMDA5Njg4Ij48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIGF0dHJpYnV0ZVR5cGU9IlhNTCIgZHVyPSIxcyIgZnJvbT0iMCAyNSAyNSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHRvPSIzNjAgMjUgMjUiIHR5cGU9InJvdGF0ZSIvPjwvcGF0aD48L3N2Zz4=">'},settings:[{html:"去广告",icon:'<text x="50%" y="50%" font-size="20" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#ffffff">AD</text>',tooltip:_?"已开启":"已关闭",onClick(){let e=!_;try{localStorage.setItem("enable_blockad",String(e)),eE.current&&(ei.current=eE.current.currentTime,eE.current.video&&eE.current.video.hls&&eE.current.video.hls.destroy(),eE.current.destroy(),eE.current=null),L(e)}catch(e){}return e?"当前开启":"当前关闭"}},{name:"跳过片头片尾",html:"跳过片头片尾",switch:C.current.enable,onSwitch:function(e){let t={...C.current,enable:!e.switch};return eZ(t),!e.switch}},{html:"删除跳过配置",onClick:function(){return eZ({enable:!1,intro_time:0,outro_time:0}),""}},{name:"设置片头",html:"设置片头",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="5" cy="12" r="2" fill="#ffffff"/><path d="M9 12L17 12" stroke="#ffffff" stroke-width="2"/><path d="M17 6L17 18" stroke="#ffffff" stroke-width="2"/></svg>',tooltip:0===C.current.intro_time?"设置片头时间":"".concat(eO(C.current.intro_time)),onClick:function(){var e;let t=(null===(e=eE.current)||void 0===e?void 0:e.currentTime)||0;if(t>0){let e={...C.current,intro_time:t};return eZ(e),"".concat(eO(t))}}},{name:"设置片尾",html:"设置片尾",icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 6L7 18" stroke="#ffffff" stroke-width="2"/><path d="M7 12L15 12" stroke="#ffffff" stroke-width="2"/><circle cx="19" cy="12" r="2" fill="#ffffff"/></svg>',tooltip:C.current.outro_time>=0?"设置片尾时间":"-".concat(eO(-C.current.outro_time)),onClick:function(){var e,t;let r=-((null===(e=eE.current)||void 0===e?void 0:e.duration)-(null===(t=eE.current)||void 0===t?void 0:t.currentTime))||0;if(r<0){let e={...C.current,outro_time:r};return eZ(e),"-".concat(eO(-r))}}}],controls:[{position:"left",index:13,html:'<i class="art-icon flex"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" fill="currentColor"/></svg></i>',tooltip:"播放下一集",click:function(){ez()}}]}),eE.current.on("ready",()=>{j(null),eE.current&&!eE.current.paused&&eI()}),eE.current.on("play",()=>{eI()}),eE.current.on("pause",()=>{eA(),eV()}),eE.current.on("video:ended",()=>{eA()}),eE.current&&!eE.current.paused&&eI(),eE.current.on("video:volumechange",()=>{ec.current=eE.current.volume}),eE.current.on("video:ratechange",()=>{eu.current=eE.current.playbackRate}),eE.current.on("video:canplay",()=>{if(ei.current&&ei.current>0)try{let e=eE.current.duration||0,t=ei.current;e&&t>=e-2&&(t=Math.max(0,e-5)),eE.current.currentTime=t,console.log("成功恢复播放进度到:",ei.current)}catch(e){console.warn("恢复播放进度失败:",e)}ei.current=null,setTimeout(()=>{Math.abs(eE.current.volume-ec.current)>.01&&(eE.current.volume=ec.current),Math.abs(eE.current.playbackRate-eu.current)>.01&&r&&(eE.current.playbackRate=eu.current),eE.current.notice.show=""},0),ek(!1)}),eE.current.on("video:timeupdate",()=>{if(!C.current.enable)return;let e=eE.current.currentTime||0,t=eE.current.duration||0,r=Date.now();if(!(r-R.current<1500)&&(R.current=r,C.current.intro_time>0&&e<C.current.intro_time&&(eE.current.currentTime=C.current.intro_time,eE.current.notice.show="已跳过片头 (".concat(eO(C.current.intro_time),")")),C.current.outro_time<0&&t>0&&e>eE.current.duration+C.current.outro_time)){var n,a;ea.current<((null===(a=en.current)||void 0===a?void 0:null===(n=a.episodes)||void 0===n?void 0:n.length)||1)-1?ez():eE.current.pause(),eE.current.notice.show="已跳过片尾 (".concat(eO(C.current.outro_time),")")}}),eE.current.on("error",e=>{if(console.error("播放器错误:",e),eE.current.currentTime>0)return}),eE.current.on("video:ended",()=>{let e=en.current,t=ea.current;e&&e.episodes&&t<e.episodes.length-1&&setTimeout(()=>{Q(t+1)},1e3)}),eE.current.on("video:timeupdate",()=>{let e=Date.now(),t=5e3;"upstash"===f.env.NEXT_PUBLIC_STORAGE_TYPE&&(t=2e4),e-eD.current>t&&(eV(),eD.current=e)}),eE.current.on("pause",()=>{eV()}),(null===(t=eE.current)||void 0===t?void 0:t.video)&&eP(eE.current.video,el)}catch(e){console.error("创建播放器失败:",e),j("播放器初始化失败")}},[l(),s.ZP,el,o,_]),(0,c.useEffect)(()=>()=>{eM.current&&clearInterval(eM.current),eA(),eB()},[]),o)?(0,n.jsx)(m.Z,{activePath:"/play",children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-transparent",children:(0,n.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"relative mx-auto w-24 h-24 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300",children:[(0,n.jsxs)("div",{className:"text-white text-4xl",children:["searching"===p&&"\uD83D\uDD0D","preferring"===p&&"⚡","fetching"===p&&"\uD83C\uDFAC","ready"===p&&"✨"]}),(0,n.jsx)("div",{className:"absolute -inset-2 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl opacity-20 animate-spin"})]}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2 w-2 h-2 bg-green-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"absolute top-4 right-4 w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-3 left-6 w-1 h-1 bg-lime-400 rounded-full animate-bounce",style:{animationDelay:"1s"}})]})]}),(0,n.jsxs)("div",{className:"mb-6 w-80 mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-center space-x-2 mb-4",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-500 ".concat("searching"===p||"fetching"===p?"bg-green-500 scale-125":"preferring"===p||"ready"===p?"bg-green-500":"bg-gray-300")}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-500 ".concat("preferring"===p?"bg-green-500 scale-125":"ready"===p?"bg-green-500":"bg-gray-300")}),(0,n.jsx)("div",{className:"w-3 h-3 rounded-full transition-all duration-500 ".concat("ready"===p?"bg-green-500 scale-125":"bg-gray-300")})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-600 rounded-full transition-all duration-1000 ease-out",style:{width:"searching"===p||"fetching"===p?"33%":"preferring"===p?"66%":"100%"}})})]}),(0,n.jsx)("div",{className:"space-y-2",children:(0,n.jsx)("p",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200 animate-pulse",children:y})})]})})}):b?(0,n.jsx)(m.Z,{activePath:"/play",children:(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-transparent",children:(0,n.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"relative mx-auto w-24 h-24 bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300",children:[(0,n.jsx)("div",{className:"text-white text-4xl",children:"\uD83D\uDE35"}),(0,n.jsx)("div",{className:"absolute -inset-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl opacity-20 animate-pulse"})]}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2 w-2 h-2 bg-red-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"absolute top-4 right-4 w-1.5 h-1.5 bg-orange-400 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-3 left-6 w-1 h-1 bg-yellow-400 rounded-full animate-bounce",style:{animationDelay:"1s"}})]})]}),(0,n.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:"哎呀，出现了一些问题"}),(0,n.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,n.jsx)("p",{className:"text-red-600 dark:text-red-400 font-medium",children:b})}),(0,n.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"请检查网络连接或尝试刷新页面"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("button",{onClick:()=>P?r.push("/search?q=".concat(encodeURIComponent(P))):r.back(),className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-medium hover:from-green-600 hover:to-emerald-700 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl",children:P?"\uD83D\uDD0D 返回搜索":"← 返回上页"}),(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200",children:"\uD83D\uDD04 重新尝试"})]})]})})}):(0,n.jsx)(m.Z,{activePath:"/play",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-4 px-5 lg:px-[3rem] 2xl:px-20",children:[(0,n.jsx)("div",{className:"py-1",children:(0,n.jsxs)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:[P||"影片标题",eo>1&&(0,n.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:" > ".concat((null==k?void 0:null===(t=k.episodes_titles)||void 0===t?void 0:t[X])||"第 ".concat(X+1," 集"))})]})}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"hidden lg:flex justify-end",children:(0,n.jsxs)("button",{onClick:()=>eb(!ew),className:"group relative flex items-center space-x-1.5 px-3 py-1.5 rounded-full bg-white/80 hover:bg-white dark:bg-gray-800/80 dark:hover:bg-gray-800 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50 shadow-sm hover:shadow-md transition-all duration-200",title:ew?"显示选集面板":"隐藏选集面板",children:[(0,n.jsx)("svg",{className:"w-3.5 h-3.5 text-gray-500 dark:text-gray-400 transition-transform duration-200 ".concat(ew?"rotate-180":"rotate-0"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,n.jsx)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:ew?"显示":"隐藏"}),(0,n.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full transition-all duration-200 ".concat(ew?"bg-orange-400 animate-pulse":"bg-green-400")})]})}),(0,n.jsxs)("div",{className:"grid gap-4 lg:h-[500px] xl:h-[650px] 2xl:h-[750px] transition-all duration-300 ease-in-out ".concat(ew?"grid-cols-1":"grid-cols-1 md:grid-cols-4"),children:[(0,n.jsx)("div",{className:"h-full transition-all duration-300 ease-in-out rounded-xl border border-white/0 dark:border-white/30 ".concat(ew?"col-span-1":"md:col-span-3"),children:(0,n.jsxs)("div",{className:"relative w-full h-[300px] lg:h-full",children:[(0,n.jsx)("div",{ref:eC,className:"bg-black w-full h-full rounded-xl overflow-hidden shadow-lg"}),ej&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black/85 backdrop-blur-sm rounded-xl flex items-center justify-center z-[500] transition-all duration-300",children:(0,n.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"relative mx-auto w-24 h-24 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl shadow-2xl flex items-center justify-center transform hover:scale-105 transition-transform duration-300",children:[(0,n.jsx)("div",{className:"text-white text-4xl",children:"\uD83C\uDFAC"}),(0,n.jsx)("div",{className:"absolute -inset-2 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl opacity-20 animate-spin"})]}),(0,n.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute top-2 left-2 w-2 h-2 bg-green-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"absolute top-4 right-4 w-1.5 h-1.5 bg-emerald-400 rounded-full animate-bounce",style:{animationDelay:"0.5s"}}),(0,n.jsx)("div",{className:"absolute bottom-3 left-6 w-1 h-1 bg-lime-400 rounded-full animate-bounce",style:{animationDelay:"1s"}})]})]}),(0,n.jsx)("div",{className:"space-y-2",children:(0,n.jsx)("p",{className:"text-xl font-semibold text-white animate-pulse",children:"sourceChanging"===eN?"\uD83D\uDD04 切换播放源...":"\uD83D\uDD04 视频加载中..."})})]})})]})}),(0,n.jsx)("div",{className:"h-[300px] lg:h-full md:overflow-hidden transition-all duration-300 ease-in-out ".concat(ew?"md:col-span-1 lg:hidden lg:opacity-0 lg:scale-95":"md:col-span-1 lg:opacity-100 lg:scale-100"),children:(0,n.jsx)(h,{totalEpisodes:eo,episodes_titles:(null==k?void 0:k.episodes_titles)||[],value:X+1,onChange:e=>{e>=0&&e<eo&&(eE.current&&eE.current.paused&&eV(),Q(e))},onSourceChange:eF,currentSource:W,currentId:q,videoTitle:G||P,availableSources:ed,sourceSearchLoading:em,sourceSearchError:eg,precomputedVideoInfo:ev})})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,n.jsx)("div",{className:"md:col-span-3",children:(0,n.jsxs)("div",{className:"p-6 flex flex-col min-h-0",children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold mb-2 tracking-wide flex items-center flex-shrink-0 text-center md:text-left w-full",children:[P||"影片标题",(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),eG()},className:"ml-3 flex-shrink-0 hover:opacity-80 transition-opacity",children:(0,n.jsx)(x,{filled:S})})]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-base mb-4 opacity-80 flex-shrink-0",children:[(null==k?void 0:k.class)&&(0,n.jsx)("span",{className:"text-green-600 font-semibold",children:k.class}),((null==k?void 0:k.year)||A)&&(0,n.jsx)("span",{children:(null==k?void 0:k.year)||A}),(null==k?void 0:k.source_name)&&(0,n.jsx)("span",{className:"border border-gray-500/60 px-2 py-[1px] rounded",children:k.source_name}),(null==k?void 0:k.type_name)&&(0,n.jsx)("span",{children:k.type_name})]}),(null==k?void 0:k.desc)&&(0,n.jsx)("div",{className:"mt-0 text-base leading-relaxed opacity-90 overflow-y-auto pr-2 flex-1 min-h-0 scrollbar-hide",style:{whiteSpace:"pre-line"},children:k.desc})]})}),(0,n.jsx)("div",{className:"hidden md:block md:col-span-1 md:order-first",children:(0,n.jsx)("div",{className:"pl-0 py-4 pr-6",children:(0,n.jsx)("div",{className:"relative bg-gray-300 dark:bg-gray-700 aspect-[2/3] flex items-center justify-center rounded-xl overflow-hidden",children:Z?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("img",{src:(0,d.a8)(Z),alt:P,className:"w-full h-full object-cover"}),0!==U&&(0,n.jsx)("a",{href:"https://movie.douban.com/subject/".concat(U.toString()),target:"_blank",rel:"noopener noreferrer",className:"absolute top-3 left-3",children:(0,n.jsx)("div",{className:"bg-green-500 text-white text-xs font-bold w-8 h-8 rounded-full flex items-center justify-center shadow-md hover:bg-green-600 hover:scale-[1.1] transition-all duration-300 ease-out",children:(0,n.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),(0,n.jsx)("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})})})]}):(0,n.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"封面图片"})})})})]})]})})}let x=e=>{let{filled:t}=e;return t?(0,n.jsx)("svg",{className:"h-7 w-7",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#ef4444",stroke:"#ef4444",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,n.jsx)(o.Z,{className:"h-7 w-7 stroke-[1] text-gray-600 dark:text-gray-300"})};function p(){return(0,n.jsx)(c.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading..."}),children:(0,n.jsx)(g,{})})}}},function(e){e.O(0,[447,816,238,539,488,78,541,242,744],function(){return e(e.s=61)}),_N_E=e.O()}]);