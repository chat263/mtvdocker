"use strict";exports.id=8300,exports.ids=[8300],exports.modules={73953:(e,t,a)=>{a.d(t,{Z:()=>H});var r=a(19681),s=a(46127);function l(){return r.jsx("button",{onClick:()=>window.history.back(),className:"w-10 h-10 p-2 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 transition-colors","aria-label":"Back",children:r.jsx(s.Z,{className:"w-full h-full"})})}var d=a(12196),n=a(76625),o=a(72295),i=a(17147),c=a(56611),x=a(1887),m=a(53892),g=a(30657),h=a(18202),u=a(73301);let f=({activePath:e})=>{let t=(0,h.usePathname)(),a=e??t,[s,l]=(0,u.useState)([{icon:d.Z,label:"首页",href:"/"},{icon:n.Z,label:"搜索",href:"/search"},{icon:o.Z,label:"电影",href:"/douban?type=movie"},{icon:i.Z,label:"剧集",href:"/douban?type=tv"},{icon:c.Z,label:"动漫",href:"/douban?type=anime"},{icon:x.Z,label:"综艺",href:"/douban?type=show"}]);(0,u.useEffect)(()=>{let e=window.RUNTIME_CONFIG;e?.CUSTOM_CATEGORIES?.length>0&&l(e=>[...e,{icon:m.Z,label:"自定义",href:"/douban?type=custom"}])},[]);let f=e=>{let t=e.match(/type=([^&]+)/)?.[1],r=decodeURIComponent(a);return r===decodeURIComponent(e)||r.startsWith("/douban")&&r.includes(`type=${t}`)};return r.jsx("nav",{className:"md:hidden fixed left-0 right-0 z-[600] bg-white/90 backdrop-blur-xl border-t border-gray-200/50 overflow-hidden dark:bg-gray-900/80 dark:border-gray-700/50",style:{bottom:0,paddingBottom:"env(safe-area-inset-bottom)",minHeight:"calc(3.5rem + env(safe-area-inset-bottom))"},children:r.jsx("ul",{className:"flex items-center overflow-x-auto scrollbar-hide",children:s.map(e=>{let t=f(e.href);return r.jsx("li",{className:"flex-shrink-0",style:{width:"20vw",minWidth:"20vw"},children:(0,r.jsxs)(g.default,{href:e.href,className:"flex flex-col items-center justify-center w-full h-14 gap-1 text-xs",children:[r.jsx(e.icon,{className:`h-6 w-6 ${t?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`}),r.jsx("span",{className:t?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-300",children:e.label})]})},e.href)})})})};var y=a(72687),b=a(97214),p=a(1239),v=a(49432),j=a(19556),w=a(68766),k=a(35128),N=a(80690),C=a(4540),E=a(53558),S=a(86294),T=a(15501),Z=a(46768),_=a(30045),A=a(36915),O=a(48935),I=a(83042),D=a(35938),P=a(17155),R=a(30648);let $=[{version:"2.7.1",date:"2025-08-17",added:[],changed:[],fixed:["修复 iOS 下版本面板可穿透滚动背景的问题"]},{version:"2.7.0",date:"2025-08-17",added:["视频卡片新增移动端操作面板，优化触控屏操作体验"],changed:["优化集数标题的匹配和展示逻辑"],fixed:["修复设置面板和修改密码面板背景可被拖动的问题"]},{version:"2.6.0",date:"2025-08-17",added:["新增搜索流式输出接口，并设置流式搜索为默认搜索接口，优化搜索体验","新增源站搜索结果内存缓存，粒度为源站+关键词+页数，缓存 10 分钟","新增豆瓣 CDN provided by @JohnsonRan"],changed:["搜索结果默认为无排序状态，不再默认按照年份排序","常规搜索接口无结果时，不再设置响应的缓存头","移除豆瓣数据源中的 cors-anywhere 方式"],fixed:["数据导出时导出站长密码，保证迁移到新账户时原站长用户可正常登录","聚合卡片优化移动端源信息展示"]},{version:"2.4.1",date:"2025-08-15",added:[],changed:[],fixed:["对导入和 db 读取的配置文件做自检，防止 USERNAME 修改导致用户状态异常"]},{version:"2.4.0",date:"2025-08-15",added:["支持 kvrocks 存储（持久化 kv 存储）"],changed:[],fixed:["修复搜索结果排序不稳定的问题","导入数据时同时更新内存缓存的管理员配置"]},{version:"2.3.0",date:"2025-08-15",added:["支持站长导入导出整站数据"],changed:["仅允许站长操作配置文件","微调搜索结果过滤面板的移动端样式"],fixed:[]},{version:"2.2.1",date:"2025-08-14",added:[],changed:[],fixed:["修复了筛选 panel 打开时滚动页面 panel 不跟随的问题"]},{version:"2.2.0",date:"2025-08-14",added:["搜索结果支持按播放源、标题和年份筛选，支持按年份排序","搜索界面视频卡片展示年份信息，聚合卡片展示播放源"],changed:[],fixed:["修复 /api/search/resources 返回空的问题","修复 upstash 实例无法编辑自定义分类的问题"]},{version:"2.1.0",date:"2025-08-13",added:["支持通过订阅获取配置文件"],changed:["微调部分文案和 UI","删除部分无用代码"],fixed:[]},{version:"2.0.1",date:"2025-08-13",added:[],changed:["版本检查和变更日志请求 Github"],fixed:["微调管理面板样式"]},{version:"2.0.0",date:"2025-08-13",added:["支持配置文件在线配置和编辑","搜索页搜索框实时联想","去除对 localstorage 模式的支持"],changed:["播放记录删除按钮改为垃圾桶图标以消除歧义"],fixed:["限制设置面板的最大长度，防止超出视口"]},{version:"1.1.1",date:"2025-08-12",added:[],changed:["修正 zwei 提供的 cors proxy 地址","移除废弃代码"],fixed:["[运维] docker workflow release 日期使用东八区日期"]},{version:"1.1.0",date:"2025-08-12",added:["每日新番放送功能，展示每日新番放送的番剧"],changed:[],fixed:["修复远程 CHANGELOG 无法提取变更内容的问题"]},{version:"1.0.5",date:"2025-08-12",added:[],changed:["实现基于 Git 标签的自动 Release 工作流"],fixed:[]},{version:"1.0.4",date:"2025-08-11",added:["优化版本管理工作流，实现单点修改"],changed:["版本号现在从 CHANGELOG 自动提取，无需手动维护 VERSION.txt"],fixed:[]},{version:"1.0.3",date:"2025-08-11",added:[],changed:["升级播放器 Artplayer 至版本 5.2.5"],fixed:[]},{version:"1.0.2",date:"2025-08-11",added:[],changed:["版本号比较机制恢复为数字比较，仅当最新版本大于本地版本时才认为有更新","[运维] 自动替换 version.ts 中的版本号为 VERSION.txt 中的版本号"],fixed:[]},{version:"1.0.1",date:"2025-08-11",added:[],changed:[],fixed:["修复版本检查功能，只要与最新版本号不一致即认为有更新"]},{version:"1.0.0",date:"2025-08-10",added:["基于 Semantic Versioning 的版本号机制","版本信息面板，展示本地变更日志和远程更新日志"],changed:[],fixed:[]}],M=({isOpen:e,onClose:t})=>{let[a,s]=(0,u.useState)(!1),[l,d]=(0,u.useState)([]),[n,o]=(0,u.useState)(!1),[i,c]=(0,u.useState)(""),[x,m]=(0,u.useState)(!1);(0,u.useEffect)(()=>(s(!0),()=>s(!1)),[]),(0,u.useEffect)(()=>{if(e){let e=document.body,t=document.documentElement,a=e.style.overflow,r=t.style.overflow;return e.style.overflow="hidden",t.style.overflow="hidden",()=>{e.style.overflow=a,t.style.overflow=r}}},[e]),(0,u.useEffect)(()=>{e&&g()},[e]);let g=async()=>{try{let e=await fetch("https://raw.githubusercontent.com/MoonTechLab/LunaTV/main/CHANGELOG");if(e.ok){let t=await e.text(),a=h(t);if(d(a),a.length>0){let e=a[0];c(e.version),o((0,_.n4)(e.version)===_.qu.HAS_UPDATE)}}else console.error("获取远程变更日志失败:",e.status,e.statusText)}catch(e){console.error("获取远程变更日志失败:",e)}},h=e=>{let t=e.split("\n"),a=[],r=null,s=null,l=!1;for(let e of t){let t=e.trim(),d=t.match(/^## \[([\d.]+)\] - (\d{4}-\d{2}-\d{2})$/);if(d){r&&a.push(r),r={version:d[1],date:d[2],added:[],changed:[],fixed:[]},s=null,l=!0;continue}if(l&&r){if("### Added"===t){s="added";continue}if("### Changed"===t){s="changed";continue}if("### Fixed"===t){s="fixed";continue}if(t.startsWith("- ")&&s){let e=t.substring(2);"added"===s?r.added.push(e):"changed"===s?r.changed.push(e):"fixed"===s&&r.fixed.push(e)}}}return r&&a.push(r),a},f=(e,t=!1,a=!1)=>{let s=a&&n&&e.version===i;return(0,r.jsxs)("div",{className:`p-4 rounded-lg border ${t?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-gray-50 dark:bg-gray-800/60 border-gray-200 dark:border-gray-700"}`,children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["v",e.version]}),t&&r.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-full",children:"当前版本"}),s&&(0,r.jsxs)("span",{className:"px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full flex items-center gap-1",children:[r.jsx(A.Z,{className:"w-3 h-3"}),"可更新"]})]}),r.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:e.date})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[e.added.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-green-700 dark:text-green-400 mb-2 flex items-center gap-1",children:[r.jsx(O.Z,{className:"w-4 h-4"}),"新增功能"]}),r.jsx("ul",{className:"space-y-1",children:e.added.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.changed.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-blue-700 dark:text-blue-400 mb-2 flex items-center gap-1",children:[r.jsx(I.Z,{className:"w-4 h-4"}),"功能改进"]}),r.jsx("ul",{className:"space-y-1",children:e.changed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.fixed.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-purple-700 dark:text-purple-400 mb-2 flex items-center gap-1",children:[r.jsx(D.Z,{className:"w-4 h-4"}),"问题修复"]}),r.jsx("ul",{className:"space-y-1",children:e.fixed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]})]})]},e.version)},y=(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000]",onClick:t,onTouchMove:e=>{e.preventDefault()},onWheel:e=>{e.preventDefault()},style:{touchAction:"none"}}),(0,r.jsxs)("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-xl shadow-xl z-[1001] overflow-hidden",onTouchMove:e=>{e.stopPropagation()},style:{touchAction:"auto"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[r.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-800 dark:text-gray-200",children:"版本信息"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2",children:[(0,r.jsxs)("span",{className:"px-2 sm:px-3 py-1 text-xs sm:text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full",children:["v",Z.w]}),n&&(0,r.jsxs)("span",{className:"px-2 sm:px-3 py-1 text-xs sm:text-sm font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full flex items-center gap-1",children:[r.jsx(A.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"有新版本可用"}),r.jsx("span",{className:"sm:hidden",children:"可更新"})]})]})]}),r.jsx("button",{onClick:t,className:"w-6 h-6 sm:w-8 sm:h-8 p-1 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"关闭",children:r.jsx(k.Z,{className:"w-full h-full"})})]}),r.jsx("div",{className:"p-3 sm:p-6 overflow-y-auto max-h-[calc(95vh-140px)] sm:max-h-[calc(90vh-120px)]",children:(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-6",children:[n&&r.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 sm:p-4",children:(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[r.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-yellow-100 dark:bg-yellow-800/40 rounded-full flex items-center justify-center flex-shrink-0",children:r.jsx(A.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-600 dark:text-yellow-400"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[r.jsx("h4",{className:"text-sm sm:text-base font-semibold text-yellow-800 dark:text-yellow-200",children:"发现新版本"}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-yellow-700 dark:text-yellow-300 break-all",children:["v",Z.w," → v",i]})]})]}),(0,r.jsxs)("a",{href:"https://github.com/MoonTechLab/LunaTV",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white text-xs sm:text-sm rounded-lg transition-colors shadow-sm w-full",children:[r.jsx(A.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"前往仓库"]})]})}),!n&&r.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 sm:p-4",children:(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 sm:gap-3",children:[r.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 dark:bg-green-800/40 rounded-full flex items-center justify-center flex-shrink-0",children:r.jsx(P.Z,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600 dark:text-green-400"})}),(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[r.jsx("h4",{className:"text-sm sm:text-base font-semibold text-green-800 dark:text-green-200",children:"当前为最新版本"}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-green-700 dark:text-green-300 break-all",children:["已是最新版本 v",Z.w]})]})]}),(0,r.jsxs)("a",{href:"https://github.com/MoonTechLab/LunaTV",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-xs sm:text-sm rounded-lg transition-colors shadow-sm w-full",children:[r.jsx(P.Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"前往仓库"]})]})}),n&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2",children:[r.jsx(A.Z,{className:"w-5 h-5 text-yellow-500"}),"远程更新内容"]}),r.jsx("button",{onClick:()=>m(!x),className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 dark:bg-yellow-800/30 dark:hover:bg-yellow-800/50 dark:text-yellow-200 rounded-lg transition-colors text-sm w-full sm:w-auto",children:x?(0,r.jsxs)(r.Fragment,{children:[r.jsx(R.Z,{className:"w-4 h-4"}),"收起"]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(N.Z,{className:"w-4 h-4"}),"查看更新内容"]})})]}),x&&l.length>0&&r.jsx("div",{className:"space-y-4",children:l.filter(e=>!$.map(e=>e.version).includes(e.version)).map((e,t)=>(0,r.jsxs)("div",{className:`p-4 rounded-lg border ${e.version===i?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-gray-50 dark:bg-gray-800/60 border-gray-200 dark:border-gray-700"}`,children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)("h4",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:["v",e.version]}),e.version===i&&r.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded-full flex items-center gap-1",children:"远程最新"})]}),r.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:e.date})]}),e.added&&e.added.length>0&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2 flex items-center gap-1",children:[r.jsx(O.Z,{className:"w-4 h-4"}),"新增功能"]}),r.jsx("ul",{className:"space-y-1",children:e.added.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.changed&&e.changed.length>0&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 mb-2 flex items-center gap-1",children:[r.jsx(I.Z,{className:"w-4 h-4"}),"功能改进"]}),r.jsx("ul",{className:"space-y-1",children:e.changed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full mt-2 flex-shrink-0"}),e]},t))})]}),e.fixed&&e.fixed.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"text-sm font-medium text-purple-700 dark:text-purple-400 mb-2 flex items-center gap-1",children:[r.jsx(D.Z,{className:"w-4 h-4"}),"问题修复"]}),r.jsx("ul",{className:"space-y-1",children:e.fixed.map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full mt-2 flex-shrink-0"}),e]},t))})]})]},t))})]}),(0,r.jsxs)("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-4",children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200 pb-3 sm:pb-4",children:"变更日志"}),r.jsx("div",{className:"space-y-4",children:$.map(e=>f(e,e.version===Z.w,!1))})]})]})})]})]});return a&&e?(0,T.createPortal)(y,document.body):null},L=()=>{let e=(0,h.useRouter)(),[t,a]=(0,u.useState)(!1),[s,l]=(0,u.useState)(!1),[d,n]=(0,u.useState)(!1),[o,i]=(0,u.useState)(!1),[c,x]=(0,u.useState)(null),[m,g]=(0,u.useState)("localstorage"),[f,y]=(0,u.useState)(!1);(0,u.useEffect)(()=>{if(s||d){let e=document.body,t=document.documentElement,a=e.style.overflow,r=t.style.overflow;return e.style.overflow="hidden",t.style.overflow="hidden",()=>{e.style.overflow=a,t.style.overflow=r}}},[s,d]);let[b,A]=(0,u.useState)(!0),[O,I]=(0,u.useState)(""),[D,P]=(0,u.useState)(!0),[R,$]=(0,u.useState)(!0),[L,U]=(0,u.useState)("melody-cdn-sharon"),[F,G]=(0,u.useState)("melody-cdn-sharon"),[z,B]=(0,u.useState)(""),[H,V]=(0,u.useState)(!1),[W,q]=(0,u.useState)(!1),J=[{value:"direct",label:"直连（服务器直接请求豆瓣）"},{value:"melody-cdn-sharon",label:"豆瓣 CDN By 旋律（Sharon CDN）"},{value:"cors-proxy-zwei",label:"Cors Proxy By Zwei"},{value:"cmliussss-cdn-tencent",label:"豆瓣 CDN By CMLiussss（腾讯云）"},{value:"cmliussss-cdn-ali",label:"豆瓣 CDN By CMLiussss（阿里云）"},{value:"custom",label:"自定义代理"}],Y=[{value:"direct",label:"直连（浏览器直接请求豆瓣）"},{value:"server",label:"服务器代理（由服务器代理请求豆瓣）"},{value:"img3",label:"豆瓣官方精品 CDN（阿里云）"},{value:"melody-cdn-sharon",label:"豆瓣 CDN By 旋律（Sharon CDN）"},{value:"cmliussss-cdn-tencent",label:"豆瓣 CDN By CMLiussss（腾讯云）"},{value:"cmliussss-cdn-ali",label:"豆瓣 CDN By CMLiussss（阿里云）"},{value:"custom",label:"自定义代理"}],[X,K]=(0,u.useState)(""),[Q,ee]=(0,u.useState)(""),[et,ea]=(0,u.useState)(!1),[er,es]=(0,u.useState)(""),[el,ed]=(0,u.useState)(null),[en,eo]=(0,u.useState)(!0);(0,u.useEffect)(()=>{y(!0)},[]),(0,u.useEffect)(()=>{},[]),(0,u.useEffect)(()=>{},[]),(0,u.useEffect)(()=>{(async()=>{try{let e=await (0,_.Df)();ed(e)}catch(e){console.warn("版本检查失败:",e)}finally{eo(!1)}})()},[]),(0,u.useEffect)(()=>{let e=e=>{H&&!e.target.closest('[data-dropdown="douban-datasource"]')&&V(!1)};if(H)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[H]),(0,u.useEffect)(()=>{let e=e=>{W&&!e.target.closest('[data-dropdown="douban-image-proxy"]')&&q(!1)};if(W)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[W]);let ei=()=>{a(!1)},ec=async()=>{try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){console.error("注销请求失败:",e)}window.location.href="/"},ex=()=>{n(!1),K(""),ee(""),es("")},em=async()=>{if(es(""),!X){es("新密码不得为空");return}if(X!==Q){es("两次输入的密码不一致");return}ea(!0);try{let e=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:X})}),t=await e.json();if(!e.ok){es(t.error||"修改密码失败");return}n(!1),await ec()}catch(e){es("网络错误，请稍后重试")}finally{ea(!1)}},eg=()=>{l(!1)},eh=e=>{A(e)},eu=e=>{I(e)},ef=e=>{P(e)},ey=e=>{$(e)},eb=e=>{U(e)},ep=e=>{G(e)},ev=e=>{B(e)},ej=e=>{switch(e){case"melody-cdn-sharon":return{text:"Thanks to @JohnsonRan",url:"https://github.com/JohnsonRan"};case"cors-proxy-zwei":return{text:"Thanks to @Zwei",url:"https://github.com/bestzwei"};case"cmliussss-cdn-tencent":case"cmliussss-cdn-ali":return{text:"Thanks to @CMLiussss",url:"https://github.com/cmliu"};default:return null}},ew=c?.role==="owner"||c?.role==="admin",ek=c?.role!=="owner"&&"localstorage"!==m,eN=(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-transparent z-[1000]",onClick:ei}),(0,r.jsxs)("div",{className:"fixed top-14 right-4 w-56 bg-white dark:bg-gray-900 rounded-lg shadow-xl z-[1001] border border-gray-200/50 dark:border-gray-700/50 overflow-hidden select-none",children:[r.jsx("div",{className:"px-3 py-2.5 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-gray-50 to-gray-100/50 dark:from-gray-800 dark:to-gray-800/50",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"当前用户"}),r.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ${"owner"===(c?.role||"user")?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"admin"===(c?.role||"user")?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:(e=>{switch(e){case"owner":return"站长";case"admin":return"管理员";case"user":return"用户";default:return""}})(c?.role||"user")})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm truncate",children:c?.username||"default"}),(0,r.jsxs)("div",{className:"text-[10px] text-gray-400 dark:text-gray-500",children:["数据存储：","localstorage"===m?"本地":m]})]})]})}),(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("button",{onClick:()=>{a(!1),l(!0)},className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",children:[r.jsx(p.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),r.jsx("span",{className:"font-medium",children:"设置"})]}),ew&&(0,r.jsxs)("button",{onClick:()=>{e.push("/admin")},className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",children:[r.jsx(v.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),r.jsx("span",{className:"font-medium",children:"管理面板"})]}),ek&&(0,r.jsxs)("button",{onClick:()=>{a(!1),n(!0),K(""),ee(""),es("")},className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",children:[r.jsx(j.Z,{className:"w-4 h-4 text-gray-500 dark:text-gray-400"}),r.jsx("span",{className:"font-medium",children:"修改密码"})]}),r.jsx("div",{className:"my-1 border-t border-gray-200 dark:border-gray-700"}),(0,r.jsxs)("button",{onClick:ec,className:"w-full px-3 py-2 text-left flex items-center gap-2.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-sm",children:[r.jsx(w.Z,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"登出"})]}),r.jsx("div",{className:"my-1 border-t border-gray-200 dark:border-gray-700"}),r.jsx("button",{onClick:()=>{i(!0),ei()},className:"w-full px-3 py-2 text-center flex items-center justify-center text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-xs",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsxs)("span",{className:"font-mono",children:["v",Z.w]}),!en&&el&&el!==_.qu.FETCH_FAILED&&r.jsx("div",{className:`w-2 h-2 rounded-full -translate-y-2 ${el===_.qu.HAS_UPDATE?"bg-yellow-500":el===_.qu.NO_UPDATE?"bg-green-400":""}`})]})})]})]})]}),eC=(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000]",onClick:eg,onTouchMove:e=>{e.preventDefault()},onWheel:e=>{e.preventDefault()},style:{touchAction:"none"}}),r.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-xl shadow-xl z-[1001] flex flex-col",children:(0,r.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto","data-panel-content":!0,style:{touchAction:"pan-y",overscrollBehavior:"contain"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"本地设置"}),r.jsx("button",{onClick:()=>{let e=window.RUNTIME_CONFIG?.DOUBAN_PROXY_TYPE||"melody-cdn-sharon",t=window.RUNTIME_CONFIG?.DOUBAN_PROXY||"",a=window.RUNTIME_CONFIG?.DOUBAN_IMAGE_PROXY_TYPE||"melody-cdn-sharon",r=window.RUNTIME_CONFIG?.DOUBAN_IMAGE_PROXY||"",s=window.RUNTIME_CONFIG?.FLUID_SEARCH!==!1;A(!0),P(!0),$(s),I(t),U(e),G(a),B(r)},className:"px-2 py-1 text-xs text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 border border-red-200 hover:border-red-300 dark:border-red-800 dark:hover:border-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"重置为默认设置",children:"恢复默认"})]}),r.jsx("button",{onClick:eg,className:"w-8 h-8 p-1 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close",children:r.jsx(k.Z,{className:"w-full h-full"})})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣数据代理"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"选择获取豆瓣数据的方式"})]}),(0,r.jsxs)("div",{className:"relative","data-dropdown":"douban-datasource",children:[r.jsx("button",{type:"button",onClick:()=>V(!H),className:"w-full px-3 py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:border-gray-400 dark:hover:border-gray-500 text-left",children:J.find(e=>e.value===L)?.label}),r.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:r.jsx(N.Z,{className:`w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform duration-200 ${H?"rotate-180":""}`})}),H&&r.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:J.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>{eb(e.value),V(!1)},className:`w-full px-3 py-2.5 text-left text-sm transition-colors duration-150 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 ${L===e.value?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"}`,children:[r.jsx("span",{className:"truncate",children:e.label}),L===e.value&&r.jsx(C.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 ml-2"})]},e.value))})]}),ej(L)&&r.jsx("div",{className:"mt-3",children:(0,r.jsxs)("button",{type:"button",onClick:()=>window.open(ej(L).url,"_blank"),className:"flex items-center justify-center gap-1.5 w-full px-3 text-xs text-gray-500 dark:text-gray-400 cursor-pointer",children:[r.jsx("span",{className:"font-medium",children:ej(L).text}),r.jsx(E.Z,{className:"w-3.5 opacity-70"})]})})]}),"custom"===L&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣代理地址"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"自定义代理服务器地址"})]}),r.jsx("input",{type:"text",className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 shadow-sm hover:border-gray-400 dark:hover:border-gray-500",placeholder:"例如: https://proxy.example.com/fetch?url=",value:O,onChange:e=>eu(e.target.value)})]}),r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣图片代理"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"选择获取豆瓣图片的方式"})]}),(0,r.jsxs)("div",{className:"relative","data-dropdown":"douban-image-proxy",children:[r.jsx("button",{type:"button",onClick:()=>q(!W),className:"w-full px-3 py-2.5 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm hover:border-gray-400 dark:hover:border-gray-500 text-left",children:Y.find(e=>e.value===F)?.label}),r.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:r.jsx(N.Z,{className:`w-4 h-4 text-gray-400 dark:text-gray-500 transition-transform duration-200 ${H?"rotate-180":""}`})}),W&&r.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-60 overflow-auto",children:Y.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>{ep(e.value),q(!1)},className:`w-full px-3 py-2.5 text-left text-sm transition-colors duration-150 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 ${F===e.value?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"text-gray-900 dark:text-gray-100"}`,children:[r.jsx("span",{className:"truncate",children:e.label}),F===e.value&&r.jsx(C.Z,{className:"w-4 h-4 text-green-600 dark:text-green-400 flex-shrink-0 ml-2"})]},e.value))})]}),ej(F)&&r.jsx("div",{className:"mt-3",children:(0,r.jsxs)("button",{type:"button",onClick:()=>window.open(ej(F).url,"_blank"),className:"flex items-center justify-center gap-1.5 w-full px-3 text-xs text-gray-500 dark:text-gray-400 cursor-pointer",children:[r.jsx("span",{className:"font-medium",children:ej(F).text}),r.jsx(E.Z,{className:"w-3.5 opacity-70"})]})})]}),"custom"===F&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"豆瓣图片代理地址"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"自定义图片代理服务器地址"})]}),r.jsx("input",{type:"text",className:"w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 shadow-sm hover:border-gray-400 dark:hover:border-gray-500",placeholder:"例如: https://proxy.example.com/fetch?url=",value:z,onChange:e=>ev(e.target.value)})]}),r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"默认聚合搜索结果"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"搜索时默认按标题和年份聚合显示结果"})]}),r.jsx("label",{className:"flex items-center cursor-pointer",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"checkbox",className:"sr-only peer",checked:b,onChange:e=>eh(e.target.checked)}),r.jsx("div",{className:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),r.jsx("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform peer-checked:translate-x-5"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"优选和测速"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"如出现播放器劫持问题可关闭"})]}),r.jsx("label",{className:"flex items-center cursor-pointer",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"checkbox",className:"sr-only peer",checked:D,onChange:e=>ef(e.target.checked)}),r.jsx("div",{className:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),r.jsx("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform peer-checked:translate-x-5"})]})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"流式搜索输出"}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"启用搜索结果实时流式输出，关闭后使用传统一次性搜索"})]}),r.jsx("label",{className:"flex items-center cursor-pointer",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"checkbox",className:"sr-only peer",checked:R,onChange:e=>ey(e.target.checked)}),r.jsx("div",{className:"w-11 h-6 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),r.jsx("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform peer-checked:translate-x-5"})]})})]})]}),r.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"这些设置保存在本地浏览器中"})})]})})]}),eE=(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[1000]",onClick:ex,onTouchMove:e=>{e.preventDefault()},onWheel:e=>{e.preventDefault()},style:{touchAction:"none"}}),r.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white dark:bg-gray-900 rounded-xl shadow-xl z-[1001] overflow-hidden",children:(0,r.jsxs)("div",{className:"h-full p-6","data-panel-content":!0,onTouchMove:e=>{e.stopPropagation()},style:{touchAction:"auto"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"修改密码"}),r.jsx("button",{onClick:ex,className:"w-8 h-8 p-1 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Close",children:r.jsx(k.Z,{className:"w-full h-full"})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"新密码"}),r.jsx("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"请输入新密码",value:X,onChange:e=>K(e.target.value),disabled:et})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"确认密码"}),r.jsx("input",{type:"password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"请再次输入新密码",value:Q,onChange:e=>ee(e.target.value),disabled:et})]}),er&&r.jsx("div",{className:"text-red-500 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded-md border border-red-200 dark:border-red-800",children:er})]}),(0,r.jsxs)("div",{className:"flex gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{onClick:ex,className:"flex-1 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors",disabled:et,children:"取消"}),r.jsx("button",{onClick:em,className:"flex-1 px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:et||!X||!Q,children:et?"修改中...":"确认修改"})]}),r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"修改密码后需要重新登录"})})]})})]});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("button",{onClick:()=>{a(!t)},className:"w-10 h-10 p-2 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 transition-colors","aria-label":"User Menu",children:r.jsx(S.Z,{className:"w-full h-full"})}),el===_.qu.HAS_UPDATE&&r.jsx("div",{className:"absolute top-[2px] right-[2px] w-2 h-2 bg-yellow-500 rounded-full"})]}),t&&f&&(0,T.createPortal)(eN,document.body),s&&f&&(0,T.createPortal)(eC,document.body),d&&f&&(0,T.createPortal)(eE,document.body),r.jsx(M,{isOpen:o,onClose:()=>i(!1)})]})},U=({showBackButton:e=!1})=>{let{siteName:t}=(0,y.W)();return(0,r.jsxs)("header",{className:"md:hidden relative w-full bg-white/70 backdrop-blur-xl border-b border-gray-200/50 shadow-sm dark:bg-gray-900/70 dark:border-gray-700/50",children:[(0,r.jsxs)("div",{className:"h-12 flex items-center justify-between px-4",children:[r.jsx("div",{className:"flex items-center gap-2",children:e&&r.jsx(l,{})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(b.T,{}),r.jsx(L,{})]})]}),r.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:r.jsx(g.default,{href:"/",className:"text-2xl font-bold text-green-600 tracking-tight hover:opacity-80 transition-opacity",children:t})})]})};var F=a(79515);let G=(0,u.createContext)({isCollapsed:!1}),z=()=>{let{siteName:e}=(0,y.W)();return r.jsx(g.default,{href:"/",className:"flex items-center justify-center h-16 select-none hover:opacity-80 transition-opacity duration-200",children:r.jsx("span",{className:"text-2xl font-bold text-green-600 tracking-tight",children:e})})},B=({onToggle:e,activePath:t="/"})=>{let a=(0,h.useRouter)(),s=(0,h.usePathname)(),l=(0,h.useSearchParams)(),[f,y]=(0,u.useState)(()=>!1);(0,u.useLayoutEffect)(()=>{let e=localStorage.getItem("sidebarCollapsed");if(null!==e){let t=JSON.parse(e);y(t),window.__sidebarCollapsed=t}},[]),(0,u.useLayoutEffect)(()=>{"undefined"!=typeof document&&(f?document.documentElement.dataset.sidebarCollapsed="true":delete document.documentElement.dataset.sidebarCollapsed)},[f]);let[b,p]=(0,u.useState)(t);(0,u.useEffect)(()=>{t?p(t):p((()=>{let e=l.toString();return e?`${s}?${e}`:s})())},[t,s,l]);let v=(0,u.useCallback)(()=>{let t=!f;y(t),localStorage.setItem("sidebarCollapsed",JSON.stringify(t)),e?.(t)},[f,e]),j=(0,u.useCallback)(()=>{a.push("/search")},[a]),[w,k]=(0,u.useState)([{icon:o.Z,label:"电影",href:"/douban?type=movie"},{icon:i.Z,label:"剧集",href:"/douban?type=tv"},{icon:c.Z,label:"动漫",href:"/douban?type=anime"},{icon:x.Z,label:"综艺",href:"/douban?type=show"}]);return(0,u.useEffect)(()=>{let e=window.RUNTIME_CONFIG;e?.CUSTOM_CATEGORIES?.length>0&&k(e=>[...e,{icon:m.Z,label:"自定义",href:"/douban?type=custom"}])},[]),r.jsx(G.Provider,{value:{isCollapsed:f},children:(0,r.jsxs)("div",{className:"hidden md:flex",children:[r.jsx("aside",{"data-sidebar":!0,className:`fixed top-0 left-0 h-screen bg-white/40 backdrop-blur-xl transition-all duration-300 border-r border-gray-200/50 z-10 shadow-lg dark:bg-gray-900/70 dark:border-gray-700/50 ${f?"w-16":"w-64"}`,style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:(0,r.jsxs)("div",{className:"flex h-full flex-col",children:[(0,r.jsxs)("div",{className:"relative h-16",children:[r.jsx("div",{className:`absolute inset-0 flex items-center justify-center transition-opacity duration-200 ${f?"opacity-0":"opacity-100"}`,children:r.jsx("div",{className:"w-[calc(100%-4rem)] flex justify-center",children:!f&&r.jsx(z,{})})}),r.jsx("button",{onClick:v,className:`absolute top-1/2 -translate-y-1/2 flex items-center justify-center w-8 h-8 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100/50 transition-colors duration-200 z-10 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700/50 ${f?"left-1/2 -translate-x-1/2":"right-2"}`,children:r.jsx(F.Z,{className:"h-4 w-4"})})]}),(0,r.jsxs)("nav",{className:"px-2 mt-4 space-y-1",children:[(0,r.jsxs)(g.default,{href:"/",onClick:()=>p("/"),"data-active":"/"===b,className:`group flex items-center rounded-lg px-2 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 font-medium transition-colors duration-200 min-h-[40px] dark:text-gray-300 dark:hover:text-green-400 dark:data-[active=true]:bg-green-500/10 dark:data-[active=true]:text-green-400 ${f?"w-full max-w-none mx-0":"mx-0"} gap-3 justify-start`,children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx(d.Z,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600 data-[active=true]:text-green-700 dark:text-gray-400 dark:group-hover:text-green-400 dark:data-[active=true]:text-green-400"})}),!f&&r.jsx("span",{className:"whitespace-nowrap transition-opacity duration-200 opacity-100",children:"首页"})]}),(0,r.jsxs)(g.default,{href:"/search",onClick:e=>{e.preventDefault(),j(),p("/search")},"data-active":"/search"===b,className:`group flex items-center rounded-lg px-2 py-2 pl-4 text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 font-medium transition-colors duration-200 min-h-[40px] dark:text-gray-300 dark:hover:text-green-400 dark:data-[active=true]:bg-green-500/10 dark:data-[active=true]:text-green-400 ${f?"w-full max-w-none mx-0":"mx-0"} gap-3 justify-start`,children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx(n.Z,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600 data-[active=true]:text-green-700 dark:text-gray-400 dark:group-hover:text-green-400 dark:data-[active=true]:text-green-400"})}),!f&&r.jsx("span",{className:"whitespace-nowrap transition-opacity duration-200 opacity-100",children:"搜索"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto px-2 pt-4",children:r.jsx("div",{className:"space-y-1",children:w.map(e=>{let t=e.href.match(/type=([^&]+)/)?.[1],a=decodeURIComponent(b),s=a===decodeURIComponent(e.href)||a.startsWith("/douban")&&a.includes(`type=${t}`),l=e.icon;return(0,r.jsxs)(g.default,{href:e.href,onClick:()=>p(e.href),"data-active":s,className:`group flex items-center rounded-lg px-2 py-2 pl-4 text-sm text-gray-700 hover:bg-gray-100/30 hover:text-green-600 data-[active=true]:bg-green-500/20 data-[active=true]:text-green-700 transition-colors duration-200 min-h-[40px] dark:text-gray-300 dark:hover:text-green-400 dark:data-[active=true]:bg-green-500/10 dark:data-[active=true]:text-green-400 ${f?"w-full max-w-none mx-0":"mx-0"} gap-3 justify-start`,children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx(l,{className:"h-4 w-4 text-gray-500 group-hover:text-green-600 data-[active=true]:text-green-700 dark:text-gray-400 dark:group-hover:text-green-400 dark:data-[active=true]:text-green-400"})}),!f&&r.jsx("span",{className:"whitespace-nowrap transition-opacity duration-200 opacity-100",children:e.label})]},e.label)})})})]})}),r.jsx("div",{className:`transition-all duration-300 sidebar-offset ${f?"w-16":"w-64"}`})]})})},H=({children:e,activePath:t="/"})=>(0,r.jsxs)("div",{className:"w-full min-h-screen",children:[r.jsx(U,{showBackButton:["/play"].includes(t)}),(0,r.jsxs)("div",{className:"flex md:grid md:grid-cols-[auto_1fr] w-full min-h-screen md:min-h-auto",children:[r.jsx("div",{className:"hidden md:block",children:r.jsx(B,{activePath:t})}),(0,r.jsxs)("div",{className:"relative min-w-0 flex-1 transition-all duration-300",children:[["/play"].includes(t)&&r.jsx("div",{className:"absolute top-3 left-1 z-20 hidden md:flex",children:r.jsx(l,{})}),(0,r.jsxs)("div",{className:"absolute top-2 right-4 z-20 hidden md:flex items-center gap-2",children:[r.jsx(b.T,{}),r.jsx(L,{})]}),r.jsx("main",{className:"flex-1 md:min-h-0 mb-14 md:mb-0",style:{paddingBottom:"calc(3.5rem + env(safe-area-inset-bottom))"},children:e})]})]}),r.jsx("div",{className:"md:hidden",children:r.jsx(f,{activePath:t})})]})},97214:(e,t,a)=>{a.d(t,{T:()=>i});var r=a(19681),s=a(78747),l=a(80606),d=a(18202),n=a(66081),o=a(73301);function i(){let[e,t]=(0,o.useState)(!1),{setTheme:a,resolvedTheme:i}=(0,n.F)();(0,d.usePathname)();let c=e=>{let t=document.querySelector('meta[name="theme-color"]');if(t)t.setAttribute("content","dark"===e?"#0c111c":"#f9fbfe");else{let t=document.createElement("meta");t.name="theme-color",t.content="dark"===e?"#0c111c":"#f9fbfe",document.head.appendChild(t)}};return e?r.jsx("button",{onClick:()=>{let e="dark"===i?"light":"dark";if(c(e),!document.startViewTransition){a(e);return}document.startViewTransition(()=>{a(e)})},className:"w-10 h-10 p-2 rounded-full flex items-center justify-center text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 transition-colors","aria-label":"Toggle theme",children:"dark"===i?r.jsx(s.Z,{className:"w-full h-full"}):r.jsx(l.Z,{className:"w-full h-full"})}):r.jsx("div",{className:"w-10 h-10"})}},7899:(e,t,a)=>{a.d(t,{v:()=>r});function r(){return null}},46768:(e,t,a)=>{a.d(t,{w:()=>r});let r="2.7.1"},30045:(e,t,a)=>{a.d(t,{Df:()=>l,n4:()=>n,qu:()=>r});var r,s=a(46768);async function l(){try{let e=await d("https://raw.githubusercontent.com/MoonTechLab/LunaTV/main/VERSION.txt");if(e)return n(e);let t=await d(["https://raw.githubusercontent.com/MoonTechLab/LunaTV/main/VERSION.txt"][1]);if(t)return n(t);return"fetch_failed"}catch(e){return console.error("版本检查失败:",e),"fetch_failed"}}async function d(e){try{let t=new AbortController,a=setTimeout(()=>t.abort(),5e3),r=Date.now(),s=e.includes("?")?`${e}&_t=${r}`:`${e}?_t=${r}`,l=await fetch(s,{method:"GET",signal:t.signal,headers:{"Content-Type":"text/plain"}});if(clearTimeout(a),!l.ok)throw Error(`HTTP error! status: ${l.status}`);return(await l.text()).trim()}catch(t){return console.warn(`从 ${e} 获取版本信息失败:`,t),null}}function n(e){if(e===s.w)return"no_update";try{let t=s.w.split(".").map(e=>{let t=parseInt(e,10);if(isNaN(t)||t<0)throw Error(`无效的版本号格式: ${s.w}`);return t}),a=e.split(".").map(t=>{let a=parseInt(t,10);if(isNaN(a)||a<0)throw Error(`无效的版本号格式: ${e}`);return a}),r=e=>{if(e.length>=3)return e.slice(0,3);{let t=[...e];for(;t.length<3;)t.push(0);return t}},l=r(t),d=r(a);for(let e=0;e<3;e++){if(d[e]>l[e])return"has_update";if(d[e]<l[e])break}return"no_update"}catch(t){return console.error("版本号比较失败:",t),e!==s.w?"has_update":"no_update"}}!function(e){e.HAS_UPDATE="has_update",e.NO_UPDATE="no_update",e.FETCH_FAILED="fetch_failed"}(r||(r={}))}};