"use strict";exports.id=3498,exports.ids=[3498],exports.modules={13303:(e,t,r)=>{let a;r.d(t,{Hz:()=>n,Ih:()=>u,iE:()=>l,jT:()=>d,ll:()=>p,mL:()=>s,xg:()=>c,yT:()=>m});var o=r(97690);let n={search:{path:"?ac=videolist&wd=",pagePath:"?ac=videolist&wd={query}&pg={page}",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}},detail:{path:"?ac=videolist&ids=",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}}};function s(e){let t;try{t=JSON.parse(e.ConfigFile)}catch(e){t={}}let r=Object.entries(t.api_site||[]),a=new Map((e.SourceConfig||[]).map(e=>[e.key,e]));r.forEach(([e,t])=>{let r=a.get(e);r?(r.name=t.name,r.api=t.api,r.detail=t.detail,r.from="config"):a.set(e,{key:e,name:t.name,api:t.api,detail:t.detail,from:"config",disabled:!1})});let o=new Set(r.map(([e])=>e));a.forEach(e=>{o.has(e.key)||(e.from="custom")}),e.SourceConfig=Array.from(a.values());let n=t.custom_category||[],s=new Map((e.CustomCategories||[]).map(e=>[e.query+e.type,e]));n.forEach(e=>{let t=e.query+e.type,r=s.get(t);r?(r.name=e.name,r.query=e.query,r.type=e.type,r.from="config"):s.set(t,{name:e.name,type:e.type,query:e.query,from:"config",disabled:!1})});let i=new Set(n.map(e=>e.query+e.type));return s.forEach(e=>{i.has(e.query+e.type)||(e.from="custom")}),e.CustomCategories=Array.from(s.values()),e}async function i(e,t={URL:"",AutoUpdate:!1,LastCheck:""}){let r;try{r=JSON.parse(e)}catch(e){r={}}let a={ConfigFile:e,ConfigSubscribtion:t,SiteConfig:{SiteName:process.env.NEXT_PUBLIC_SITE_NAME||"MoonTV",Announcement:process.env.ANNOUNCEMENT||"本网站仅提供影视信息搜索服务，所有内容均来自第三方网站。本站不存储任何视频资源，不对任何内容的准确性、合法性、完整性负责。",SearchDownstreamMaxPage:Number(process.env.NEXT_PUBLIC_SEARCH_MAX_PAGE)||5,SiteInterfaceCacheTime:r.cache_time||7200,DoubanProxyType:process.env.NEXT_PUBLIC_DOUBAN_PROXY_TYPE||"direct",DoubanProxy:process.env.NEXT_PUBLIC_DOUBAN_PROXY||"",DoubanImageProxyType:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY_TYPE||"direct",DoubanImageProxy:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY||"",DisableYellowFilter:"true"===process.env.NEXT_PUBLIC_DISABLE_YELLOW_FILTER},UserConfig:{AllowRegister:"true"===process.env.NEXT_PUBLIC_ENABLE_REGISTER,Users:[]},SourceConfig:[],CustomCategories:[]},n=[];try{n=await o.db.getAllUsers()}catch(e){console.error("获取用户列表失败:",e)}let s=n.filter(e=>e!==process.env.USERNAME).map(e=>({username:e,role:"user",banned:!1}));return s.unshift({username:process.env.USERNAME,role:"owner",banned:!1}),a.UserConfig.Users=s,Object.entries(r.api_site||[]).forEach(([e,t])=>{a.SourceConfig.push({key:e,name:t.name,api:t.api,detail:t.detail,from:"config",disabled:!1})}),r.custom_category?.forEach(e=>{a.CustomCategories.push({name:e.name||e.query,type:e.type,query:e.query,from:"config",disabled:!1})}),a}async function l(){if(a)return a;let e=null;try{e=await o.db.getAdminConfig()}catch(e){console.error("获取管理员配置失败:",e)}return e||(e=await i("")),a=e=c(e),o.db.saveAdminConfig(a),a}function c(e){e.UserConfig||(e.UserConfig={AllowRegister:!1,Users:[]}),e.UserConfig.Users&&Array.isArray(e.UserConfig.Users)||(e.UserConfig.Users=[]),e.SourceConfig&&Array.isArray(e.SourceConfig)||(e.SourceConfig=[]),e.CustomCategories&&Array.isArray(e.CustomCategories)||(e.CustomCategories=[]);let t=process.env.USERNAME,r=new Set;e.UserConfig.Users=e.UserConfig.Users.filter(e=>!r.has(e.username)&&(r.add(e.username),!0)),e.UserConfig.Users=e.UserConfig.Users.filter(e=>e.username!==t),e.UserConfig.Users.forEach(e=>{"owner"===e.role&&(e.role="user")}),e.UserConfig.Users.unshift({username:t,role:"owner",banned:!1});let a=new Set;e.SourceConfig=e.SourceConfig.filter(e=>!a.has(e.key)&&(a.add(e.key),!0));let o=new Set;return e.CustomCategories=e.CustomCategories.filter(e=>!o.has(e.query+e.type)&&(o.add(e.query+e.type),!0)),e}async function u(){let e=null;try{e=await o.db.getAdminConfig()}catch(e){console.error("获取管理员配置失败:",e)}e||(e={});let t=await i(e.ConfigFile,e.ConfigSubscribtion);a=t,await o.db.saveAdminConfig(t)}async function d(){return(await l()).SiteConfig.SiteInterfaceCacheTime||7200}async function p(){return(await l()).SourceConfig.filter(e=>!e.disabled).map(e=>({key:e.key,name:e.name,api:e.api,detail:e.detail}))}async function m(e){a=e}},43498:(e,t,r)=>{r.d(t,{J:()=>c,s:()=>i});var a=r(13303),o=r(54773),n=r.n(o);function s(e){if(!e)return"";let t=e.replace(/<[^>]+>/g,"\n").replace(/\n+/g,"\n").replace(/[ \t]+/g," ").replace(/^\n+|\n+$/g,"").trim();return n().decode(t)}async function i(e,t){try{let r=e.api,o=r+a.Hz.search.path+encodeURIComponent(t),n=e.name,i=new AbortController,l=setTimeout(()=>i.abort(),8e3),c=await fetch(o,{headers:a.Hz.search.headers,signal:i.signal});if(clearTimeout(l),!c.ok)return[];let u=await c.json();if(!u||!u.list||!Array.isArray(u.list)||0===u.list.length)return[];let d=u.list.map(t=>{let r=[],a=[];return t.vod_play_url&&t.vod_play_url.split("$$$").forEach(e=>{let t=[],o=[];e.split("#").forEach(e=>{let r=e.split("$");2===r.length&&r[1].endsWith(".m3u8")&&(o.push(r[0]),t.push(r[1]))}),t.length>r.length&&(r=t,a=o)}),{id:t.vod_id.toString(),title:t.vod_name.trim().replace(/\s+/g," "),poster:t.vod_pic,episodes:r,episodes_titles:a,source:e.key,source_name:n,class:t.vod_class,year:t.vod_year?t.vod_year.match(/\d{4}/)?.[0]||"":"unknown",desc:s(t.vod_content||""),type_name:t.type_name,douban_id:t.vod_douban_id}}),p=(await (0,a.iE)()).SiteConfig.SearchDownstreamMaxPage,m=u.pagecount||1,g=Math.min(m-1,p-1);if(g>0){let o=[];for(let i=2;i<=g+1;i++){let l=r+a.Hz.search.pagePath.replace("{query}",encodeURIComponent(t)).replace("{page}",i.toString()),c=(async()=>{try{let t=new AbortController,r=setTimeout(()=>t.abort(),8e3),o=await fetch(l,{headers:a.Hz.search.headers,signal:t.signal});if(clearTimeout(r),!o.ok)return[];let i=await o.json();if(!i||!i.list||!Array.isArray(i.list))return[];return i.list.map(t=>{let r=[],a=[];return t.vod_play_url&&t.vod_play_url.split("$$$").forEach(e=>{let t=[],o=[];e.split("#").forEach(e=>{let r=e.split("$");2===r.length&&r[1].endsWith(".m3u8")&&(o.push(r[0]),t.push(r[1]))}),t.length>r.length&&(r=t,a=o)}),{id:t.vod_id.toString(),title:t.vod_name.trim().replace(/\s+/g," "),poster:t.vod_pic,episodes:r,episodes_titles:a,source:e.key,source_name:n,class:t.vod_class,year:t.vod_year?t.vod_year.match(/\d{4}/)?.[0]||"":"unknown",desc:s(t.vod_content||""),type_name:t.type_name,douban_id:t.vod_douban_id}})}catch(e){return[]}})();o.push(c)}(await Promise.all(o)).forEach(e=>{e.length>0&&d.push(...e)})}return d}catch(e){return[]}}r(73874);let l=/(https?:\/\/[^"'\s]+?\.m3u8)/g;async function c(e,t){if(e.detail)return u(t,e);let r=`${e.api}${a.Hz.detail.path}${t}`,o=new AbortController,n=setTimeout(()=>o.abort(),1e4),i=await fetch(r,{headers:a.Hz.detail.headers,signal:o.signal});if(clearTimeout(n),!i.ok)throw Error(`详情请求失败: ${i.status}`);let c=await i.json();if(!c||!c.list||!Array.isArray(c.list)||0===c.list.length)throw Error("获取到的详情内容无效");let d=c.list[0],p=[],m=[];return d.vod_play_url&&d.vod_play_url.split("$$$").forEach(e=>{let t=[],r=[];e.split("#").forEach(e=>{let a=e.split("$");2===a.length&&a[1].endsWith(".m3u8")&&(r.push(a[0]),t.push(a[1]))}),t.length>p.length&&(p=t,m=r)}),0===p.length&&d.vod_content&&(p=(d.vod_content.match(l)||[]).map(e=>e.replace(/^\$/,""))),{id:t.toString(),title:d.vod_name,poster:d.vod_pic,episodes:p,episodes_titles:m,source:e.key,source_name:e.name,class:d.vod_class,year:d.vod_year?d.vod_year.match(/\d{4}/)?.[0]||"":"unknown",desc:s(d.vod_content),type_name:d.type_name,douban_id:d.vod_douban_id}}async function u(e,t){let r=`${t.detail}/index.php/vod/detail/id/${e}.html`,o=new AbortController,n=setTimeout(()=>o.abort(),1e4),i=await fetch(r,{headers:a.Hz.detail.headers,signal:o.signal});if(clearTimeout(n),!i.ok)throw Error(`详情页请求失败: ${i.status}`);let l=await i.text(),c=[];"ffzy"===t.key&&(c=l.match(/\$(https?:\/\/[^"'\s]+?\/\d{8}\/\d+_[a-f0-9]+\/index\.m3u8)/g)||[]),0===c.length&&(c=l.match(/\$(https?:\/\/[^"'\s]+?\.m3u8)/g)||[]);let u=Array.from({length:(c=Array.from(new Set(c)).map(e=>{let t=(e=e.substring(1)).indexOf("(");return t>0?e.substring(0,t):e})).length},(e,t)=>(t+1).toString()),d=l.match(/<h1[^>]*>([^<]+)<\/h1>/),p=d?d[1].trim():"",m=l.match(/<div[^>]*class=["']sketch["'][^>]*>([\s\S]*?)<\/div>/),g=m?s(m[1]):"",h=l.match(/(https?:\/\/[^"'\s]+?\.jpg)/g),f=h?h[0].trim():"",y=l.match(/>(\d{4})</),_=y?y[1]:"unknown";return{id:e,title:p,poster:f,episodes:c,episodes_titles:u,source:t.key,source_name:t.name,class:"",year:_,desc:g,type_name:"",douban_id:0}}}};