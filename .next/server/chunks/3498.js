"use strict";exports.id=3498,exports.ids=[3498],exports.modules={13303:(e,t,a)=>{let r;a.d(t,{Hz:()=>o,Ih:()=>c,iE:()=>l,jT:()=>p,ll:()=>d,mL:()=>i});var n=a(35737);let o={search:{path:"?ac=videolist&wd=",pagePath:"?ac=videolist&wd={query}&pg={page}",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}},detail:{path:"?ac=videolist&ids=",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}}};function i(e){let t;try{t=JSON.parse(e.ConfigFile)}catch(e){t={}}let a=Object.entries(t.api_site||[]),r=new Map((e.SourceConfig||[]).map(e=>[e.key,e]));a.forEach(([e,t])=>{let a=r.get(e);a?(a.name=t.name,a.api=t.api,a.detail=t.detail,a.from="config"):r.set(e,{key:e,name:t.name,api:t.api,detail:t.detail,from:"config",disabled:!1})});let n=new Set(a.map(([e])=>e));r.forEach(e=>{n.has(e.key)||(e.from="custom")}),e.SourceConfig=Array.from(r.values());let o=t.custom_category||[],i=new Map((e.CustomCategories||[]).map(e=>[e.query+e.type,e]));o.forEach(e=>{let t=e.query+e.type,a=i.get(t);a?(a.name=e.name,a.query=e.query,a.type=e.type,a.from="config"):i.set(t,{name:e.name,type:e.type,query:e.query,from:"config",disabled:!1})});let s=new Set(o.map(e=>e.query+e.type));return i.forEach(e=>{s.has(e.query+e.type)||(e.from="custom")}),e.CustomCategories=Array.from(i.values()),e}async function s(e,t={URL:"",AutoUpdate:!1,LastCheck:""}){let a;try{a=JSON.parse(e)}catch(e){a={}}let r={ConfigFile:e,ConfigSubscribtion:t,SiteConfig:{SiteName:process.env.NEXT_PUBLIC_SITE_NAME||"MoonTV",Announcement:process.env.ANNOUNCEMENT||"本网站仅提供影视信息搜索服务，所有内容均来自第三方网站。本站不存储任何视频资源，不对任何内容的准确性、合法性、完整性负责。",SearchDownstreamMaxPage:Number(process.env.NEXT_PUBLIC_SEARCH_MAX_PAGE)||5,SiteInterfaceCacheTime:a.cache_time||7200,DoubanProxyType:process.env.NEXT_PUBLIC_DOUBAN_PROXY_TYPE||"direct",DoubanProxy:process.env.NEXT_PUBLIC_DOUBAN_PROXY||"",DoubanImageProxyType:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY_TYPE||"direct",DoubanImageProxy:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY||"",DisableYellowFilter:"true"===process.env.NEXT_PUBLIC_DISABLE_YELLOW_FILTER},UserConfig:{AllowRegister:"true"===process.env.NEXT_PUBLIC_ENABLE_REGISTER,Users:[]},SourceConfig:[],CustomCategories:[]},o=(0,n.cF)(),i=[];if(o&&"function"==typeof o.getAllUsers)try{i=await o.getAllUsers()}catch(e){console.error("获取用户列表失败:",e)}let s=i.filter(e=>e!==process.env.USERNAME).map(e=>({username:e,role:"user",banned:!1}));return s.unshift({username:process.env.USERNAME,role:"owner",banned:!1}),r.UserConfig.Users=s,Object.entries(a.api_site||[]).forEach(([e,t])=>{r.SourceConfig.push({key:e,name:t.name,api:t.api,detail:t.detail,from:"config",disabled:!1})}),a.custom_category?.forEach(e=>{r.CustomCategories.push({name:e.name||e.query,type:e.type,query:e.query,from:"config",disabled:!1})}),r}async function l(){if(r)return r;let e=(0,n.cF)(),t=null;return e&&"function"==typeof e.getAdminConfig&&(t=await e.getAdminConfig()),t||(t=await s("")),r=t}async function c(){let e;let t=(0,n.cF)();e=t&&"function"==typeof t.getAdminConfig?await t.getAdminConfig():{};let a=await s(e.ConfigFile,e.ConfigSubscribtion);r=a,t&&"function"==typeof t.setAdminConfig&&await t.setAdminConfig(a)}async function p(){return(await l()).SiteConfig.SiteInterfaceCacheTime||7200}async function d(){return(await l()).SourceConfig.filter(e=>!e.disabled).map(e=>({key:e.key,name:e.name,api:e.api,detail:e.detail}))}},43498:(e,t,a)=>{a.d(t,{J:()=>c,s:()=>s});var r=a(13303),n=a(54773),o=a.n(n);function i(e){if(!e)return"";let t=e.replace(/<[^>]+>/g,"\n").replace(/\n+/g,"\n").replace(/[ \t]+/g," ").replace(/^\n+|\n+$/g,"").trim();return o().decode(t)}async function s(e,t){try{let a=e.api,n=a+r.Hz.search.path+encodeURIComponent(t),o=e.name,s=new AbortController,l=setTimeout(()=>s.abort(),8e3),c=await fetch(n,{headers:r.Hz.search.headers,signal:s.signal});if(clearTimeout(l),!c.ok)return[];let p=await c.json();if(!p||!p.list||!Array.isArray(p.list)||0===p.list.length)return[];let d=p.list.map(t=>{let a=[],r=[];return t.vod_play_url&&t.vod_play_url.split("$$$").forEach(e=>{let t=[],n=[];e.split("#").forEach(e=>{let a=e.split("$");2===a.length&&a[1].endsWith(".m3u8")&&(n.push(a[0]),t.push(a[1]))}),t.length>a.length&&(a=t,r=n)}),{id:t.vod_id.toString(),title:t.vod_name.trim().replace(/\s+/g," "),poster:t.vod_pic,episodes:a,episodes_titles:r,source:e.key,source_name:o,class:t.vod_class,year:t.vod_year?t.vod_year.match(/\d{4}/)?.[0]||"":"unknown",desc:i(t.vod_content||""),type_name:t.type_name,douban_id:t.vod_douban_id}}),u=(await (0,r.iE)()).SiteConfig.SearchDownstreamMaxPage,m=p.pagecount||1,h=Math.min(m-1,u-1);if(h>0){let n=[];for(let s=2;s<=h+1;s++){let l=a+r.Hz.search.pagePath.replace("{query}",encodeURIComponent(t)).replace("{page}",s.toString()),c=(async()=>{try{let t=new AbortController,a=setTimeout(()=>t.abort(),8e3),n=await fetch(l,{headers:r.Hz.search.headers,signal:t.signal});if(clearTimeout(a),!n.ok)return[];let s=await n.json();if(!s||!s.list||!Array.isArray(s.list))return[];return s.list.map(t=>{let a=[],r=[];return t.vod_play_url&&t.vod_play_url.split("$$$").forEach(e=>{let t=[],n=[];e.split("#").forEach(e=>{let a=e.split("$");2===a.length&&a[1].endsWith(".m3u8")&&(n.push(a[0]),t.push(a[1]))}),t.length>a.length&&(a=t,r=n)}),{id:t.vod_id.toString(),title:t.vod_name.trim().replace(/\s+/g," "),poster:t.vod_pic,episodes:a,episodes_titles:r,source:e.key,source_name:o,class:t.vod_class,year:t.vod_year?t.vod_year.match(/\d{4}/)?.[0]||"":"unknown",desc:i(t.vod_content||""),type_name:t.type_name,douban_id:t.vod_douban_id}})}catch(e){return[]}})();n.push(c)}(await Promise.all(n)).forEach(e=>{e.length>0&&d.push(...e)})}return d}catch(e){return[]}}a(73874);let l=/(https?:\/\/[^"'\s]+?\.m3u8)/g;async function c(e,t){if(e.detail)return p(t,e);let a=`${e.api}${r.Hz.detail.path}${t}`,n=new AbortController,o=setTimeout(()=>n.abort(),1e4),s=await fetch(a,{headers:r.Hz.detail.headers,signal:n.signal});if(clearTimeout(o),!s.ok)throw Error(`详情请求失败: ${s.status}`);let c=await s.json();if(!c||!c.list||!Array.isArray(c.list)||0===c.list.length)throw Error("获取到的详情内容无效");let d=c.list[0],u=[],m=[];return d.vod_play_url&&d.vod_play_url.split("$$$").forEach(e=>{let t=[],a=[];e.split("#").forEach(e=>{let r=e.split("$");2===r.length&&r[1].endsWith(".m3u8")&&(a.push(r[0]),t.push(r[1]))}),t.length>u.length&&(u=t,m=a)}),0===u.length&&d.vod_content&&(u=(d.vod_content.match(l)||[]).map(e=>e.replace(/^\$/,""))),{id:t.toString(),title:d.vod_name,poster:d.vod_pic,episodes:u,episodes_titles:m,source:e.key,source_name:e.name,class:d.vod_class,year:d.vod_year?d.vod_year.match(/\d{4}/)?.[0]||"":"unknown",desc:i(d.vod_content),type_name:d.type_name,douban_id:d.vod_douban_id}}async function p(e,t){let a=`${t.detail}/index.php/vod/detail/id/${e}.html`,n=new AbortController,o=setTimeout(()=>n.abort(),1e4),s=await fetch(a,{headers:r.Hz.detail.headers,signal:n.signal});if(clearTimeout(o),!s.ok)throw Error(`详情页请求失败: ${s.status}`);let l=await s.text(),c=[];"ffzy"===t.key&&(c=l.match(/\$(https?:\/\/[^"'\s]+?\/\d{8}\/\d+_[a-f0-9]+\/index\.m3u8)/g)||[]),0===c.length&&(c=l.match(/\$(https?:\/\/[^"'\s]+?\.m3u8)/g)||[]);let p=Array.from({length:(c=Array.from(new Set(c)).map(e=>{let t=(e=e.substring(1)).indexOf("(");return t>0?e.substring(0,t):e})).length},(e,t)=>(t+1).toString()),d=l.match(/<h1[^>]*>([^<]+)<\/h1>/),u=d?d[1].trim():"",m=l.match(/<div[^>]*class=["']sketch["'][^>]*>([\s\S]*?)<\/div>/),h=m?i(m[1]):"",f=l.match(/(https?:\/\/[^"'\s]+?\.jpg)/g),g=f?f[0].trim():"",_=l.match(/>(\d{4})</),y=_?_[1]:"unknown";return{id:e,title:u,poster:g,episodes:c,episodes_titles:p,source:t.key,source_name:t.name,class:"",year:y,desc:h,type_name:"",douban_id:0}}}};