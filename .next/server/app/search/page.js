(()=>{var e={};e.id=2797,e.ids=[2797],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6005:e=>{"use strict";e.exports=require("node:crypto")},46908:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),t(96418),t(83421),t(85673);var a=t(41118),s=t(20515),l=t(17412),n=t.n(l),o=t(35078),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);t.d(r,i);let c=["",{children:["search",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,96418)),"/app/src/app/search/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,83421)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,85673,23)),"next/dist/client/components/not-found-error"]}],d=["/app/src/app/search/page.tsx"],u="/search/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/search/page",pathname:"/search",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7488:(e,r,t)=>{Promise.resolve().then(t.bind(t,71078))},71078:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var a=t(19681),s=t(76625),l=t(35128),n=t(30648),o=t(18202),i=t(73301),c=t(73469),d=t(73953),u=t(8906);let m=(0,u.Z)("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]),p=(0,u.Z)("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);var x=t(15501);let g={source:"all",title:"all",year:"all",yearOrder:"desc"},h=({categories:e,values:r,onChange:t})=>{let[s,l]=(0,i.useState)(null),[n,o]=(0,i.useState)({x:0,y:0,width:0}),c=(0,i.useRef)({}),d=(0,i.useRef)(null),u=(0,i.useMemo)(()=>({...g,...r}),[r]),h=e=>{let r=c.current[e];if(r){let t=r.getBoundingClientRect(),a=window.innerWidth,s=t.left,l=Math.max(t.width,"title"===e?400:240),n=!1;a<768&&(n=!0,s+(l=Math.min(l,a-32))>a-16&&(s=a-l-16),s<16&&(s=16)),o({x:s,y:t.bottom,width:n?l:t.width})}},y=e=>{s===e?l(null):(l(e),h(e))},f=(e,r)=>{t({...u,[e]:r}),l(null)},b=r=>{let t=e.find(e=>e.key===r);if(!t)return"";let a=u[r];if(!a||a===g[r])return t.label;let s=t.options.find(e=>e.value===a);return s?.label||t.label},v=e=>{let r=u[e];return!r||r===g[e]},k=(e,r)=>(u[e]??g[e])===r;return(0,i.useEffect)(()=>{let e=()=>{s&&l(null)},r=()=>{s&&h(s)};return document.body.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",r),()=>{document.body.removeEventListener("scroll",e),window.removeEventListener("resize",r)}},[s]),(0,i.useEffect)(()=>{let e=e=>{!d.current||d.current.contains(e.target)||Object.values(c.current).some(r=>r&&r.contains(e.target))||l(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative inline-flex rounded-full p-0.5 sm:p-1 bg-transparent gap-1 sm:gap-2",children:[e.map(e=>a.jsx("div",{ref:r=>{c.current[e.key]=r},className:"relative",children:(0,a.jsxs)("button",{onClick:()=>y(e.key),className:`relative z-10 px-1.5 py-0.5 sm:px-2 sm:py-1 md:px-4 md:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ${s===e.key?v(e.key)?"text-gray-900 dark:text-gray-100 cursor-default":"text-green-600 dark:text-green-400 cursor-default":v(e.key)?"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer":"text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 cursor-pointer"}`,children:[a.jsx("span",{children:b(e.key)}),a.jsx("svg",{className:`inline-block w-2.5 h-2.5 sm:w-3 sm:h-3 ml-0.5 sm:ml-1 transition-transform duration-200 ${s===e.key?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})},e.key)),a.jsx("div",{className:"relative",children:(0,a.jsxs)("button",{onClick:()=>{let e="desc"===u.yearOrder?"asc":"desc";t({...u,yearOrder:e})},className:`relative z-10 px-1.5 py-0.5 sm:px-2 sm:py-1 md:px-4 md:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ${"desc"===u.yearOrder?"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer":"text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 cursor-pointer"}`,"aria-label":`按年份${"desc"===u.yearOrder?"降序":"升序"}排序`,children:[a.jsx("span",{children:"年份"}),"desc"===u.yearOrder?a.jsx(m,{className:"inline-block ml-1 w-4 h-4 sm:w-4 sm:h-4"}):a.jsx(p,{className:"inline-block ml-1 w-4 h-4 sm:w-4 sm:h-4"})]})})]}),s&&(0,x.createPortal)(a.jsx("div",{ref:d,className:"fixed z-[9999] bg-white/95 dark:bg-gray-800/95 rounded-xl border border-gray-200/50 dark:border-gray-700/50 backdrop-blur-sm max-h-[50vh] flex flex-col",style:{left:`${n.x}px`,top:`${n.y}px`,minWidth:`${Math.max(n.width,"title"===s?400:240)}px`,maxWidth:"600px",position:"fixed"},children:a.jsx("div",{className:"p-2 sm:p-4 overflow-y-auto flex-1 min-h-0",children:a.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-1 sm:gap-2",children:e.find(e=>e.key===s)?.options.map(e=>a.jsx("button",{onClick:()=>f(s,e.value),className:`px-2 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm rounded-lg transition-all duration-200 text-left ${k(s,e.value)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border border-green-200 dark:border-green-700":"text-gray-700 dark:text-gray-300 hover:bg-gray-100/80 dark:hover:bg-gray-700/80"}`,children:e.label},e.value))})})}),document.body)]})};function y({query:e,isVisible:r,onSelect:t,onClose:s}){let[l,n]=(0,i.useState)([]),[o,c]=(0,i.useState)(-1),d=(0,i.useRef)(null),u=(0,i.useRef)(null),m=(0,i.useRef)(null),p=(0,i.useCallback)(async e=>{m.current&&m.current.abort();let r=new AbortController;m.current=r;try{let t=await fetch(`/api/search/suggestions?q=${encodeURIComponent(e)}`,{signal:r.signal});if(t.ok){let e=(await t.json()).suggestions.map(e=>({text:e.text,type:"related"}));n(e),c(-1)}}catch(e){e instanceof Error?"AbortError"!==e.name&&(n([]),c(-1)):(n([]),c(-1))}},[]);return((0,i.useCallback)(e=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{e.trim()&&r?p(e):(n([]),c(-1))},300)},[r,p]),r&&0!==l.length)?a.jsx("div",{ref:d,className:"absolute top-full left-0 right-0 z-50 mt-1 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 max-h-80 overflow-y-auto",children:l.map((e,r)=>a.jsx("button",{onClick:()=>t(e.text),onMouseEnter:()=>c(r),className:`w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150 flex items-center gap-3 ${o===r?"bg-gray-100 dark:bg-gray-700":""}`,children:a.jsx("span",{className:"flex-1 text-sm text-gray-700 dark:text-gray-300 truncate",children:e.text})},`related-${e.text}`))}):null}var f=t(61496);function b(){let[e,r]=(0,i.useState)([]),[t,u]=(0,i.useState)(!1),m=(0,o.useRouter)();(0,o.useSearchParams)();let p=(0,i.useRef)(""),[x,g]=(0,i.useState)(""),[b,v]=(0,i.useState)(!1),[k,w]=(0,i.useState)(!1),[j,N]=(0,i.useState)([]),[C,q]=(0,i.useState)(!1),[A,_]=(0,i.useState)({source:"all",title:"all",year:"all",yearOrder:"desc"}),[M,$]=(0,i.useState)({source:"all",title:"all",year:"all",yearOrder:"desc"}),S=()=>!0,[P,E]=(0,i.useState)(()=>S()?"agg":"all"),R=(0,i.useMemo)(()=>{let e=new Map;return j.forEach(r=>{let t=`${r.title.replaceAll(" ","")}-${r.year||"unknown"}-${1===r.episodes.length?"movie":"tv"}`,a=e.get(t)||[];a.push(r),e.set(t,a)}),Array.from(e.entries()).sort((e,r)=>{let t=e[1][0].title.replaceAll(" ","").includes(x.trim().replaceAll(" ","")),a=r[1][0].title.replaceAll(" ","").includes(x.trim().replaceAll(" ",""));if(t&&!a)return -1;if(!t&&a)return 1;if(e[1][0].year===r[1][0].year)return e[0].localeCompare(r[0]);{let t=e[1][0].year,a=r[1][0].year;return"unknown"===t&&"unknown"===a?0:"unknown"===t?1:"unknown"===a?-1:t>a?-1:1}})},[j]),I=(0,i.useMemo)(()=>{let e=new Map,r=new Set,t=new Set;j.forEach(a=>{a.source&&a.source_name&&e.set(a.source,a.source_name),a.title&&r.add(a.title),a.year&&t.add(a.year)});let a=[{label:"全部来源",value:"all"},...Array.from(e.entries()).sort((e,r)=>e[1].localeCompare(r[1])).map(([e,r])=>({label:r,value:e}))],s=[{label:"全部标题",value:"all"},...Array.from(r.values()).sort((e,r)=>e.localeCompare(r)).map(e=>({label:e,value:e}))],l=Array.from(t.values()),n=l.filter(e=>"unknown"!==e).sort((e,r)=>parseInt(r)-parseInt(e)),o=l.includes("unknown"),i=[{label:"全部年份",value:"all"},...n.map(e=>({label:e,value:e})),...o?[{label:"未知",value:"unknown"}]:[]];return{categoriesAll:[{key:"source",label:"来源",options:a},{key:"title",label:"标题",options:s},{key:"year",label:"年份",options:i}],categoriesAgg:[{key:"source",label:"来源",options:a},{key:"title",label:"标题",options:s},{key:"year",label:"年份",options:i}]}},[j]),O=(e,r,t)=>{let a=e=>{if(!e||"unknown"===e)return null;let r=parseInt(e,10);return Number.isNaN(r)?null:r},s=a(e),l=a(r);return null===s&&null===l?0:null===s?1:null===l?-1:"asc"===t?s-l:l-s},L=(0,i.useMemo)(()=>{let{source:e,title:r,year:t,yearOrder:a}=A;return j.filter(a=>("all"===e||a.source===e)&&("all"===r||a.title===r)&&("all"===t||a.year===t)).sort((e,r)=>{let t=O(e.year,r.year,a);if(0!==t)return t;let s=e.title===x.trim(),l=r.title===x.trim();return s&&!l?-1:!s&&l?1:e.title.localeCompare(r.title)})},[j,A,x]),Z=(0,i.useMemo)(()=>{let{source:e,title:r,year:t,yearOrder:a}=M;return R.filter(([a,s])=>{let l=s[0]?.title??"",n=s[0]?.year??"unknown";return!!("all"===e||s.some(r=>r.source===e))&&("all"===r||l===r)&&("all"===t||n===t)}).sort((e,r)=>{let t=e[1][0].title.replaceAll(" ","").includes(x.trim().replaceAll(" ","")),s=r[1][0].title.replaceAll(" ","").includes(x.trim().replaceAll(" ",""));if(t&&!s)return -1;if(!t&&s)return 1;let l=O(e[1][0].year,r[1][0].year,a);return 0!==l?l:e[0].localeCompare(r[0])})},[R,M,x]),z=async e=>{let r=e.trim();try{v(!0);let e=await fetch(`/api/search?q=${encodeURIComponent(r)}`),t=(await e.json()).results;if(p.current!==r)return;N(t.sort((e,t)=>{let a=e.title===r,s=t.title===r;return a&&!s?-1:!a&&s?1:e.year===t.year?e.title.localeCompare(t.title):"unknown"===e.year&&"unknown"===t.year?0:"unknown"===e.year?1:"unknown"===t.year?-1:parseInt(e.year)>parseInt(t.year)?-1:1})),w(!0)}catch(e){N([])}finally{v(!1)}};return(0,a.jsxs)(d.Z,{activePath:"/search",children:[(0,a.jsxs)("div",{className:"px-4 sm:px-10 py-4 sm:py-8 overflow-visible mb-10",children:[a.jsx("div",{className:"mb-8",children:a.jsx("form",{onSubmit:e=>{e.preventDefault();let r=x.trim().replace(/\s+/g," ");r&&(g(r),v(!0),w(!0),q(!1),m.push(`/search?q=${encodeURIComponent(r)}`),z(r),(0,c.F0)(r))},className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(s.Z,{className:"absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400 dark:text-gray-500"}),a.jsx("input",{id:"searchInput",type:"text",value:x,onChange:e=>{let r=e.target.value;g(r),r.trim()?q(!0):q(!1)},onFocus:()=>{x.trim()&&q(!0)},placeholder:"搜索电影、电视剧...",className:"w-full h-12 rounded-lg bg-gray-50/80 py-3 pl-10 pr-4 text-sm text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-400 focus:bg-white border border-gray-200/50 shadow-sm dark:bg-gray-800 dark:text-gray-300 dark:placeholder-gray-500 dark:focus:bg-gray-700 dark:border-gray-700"}),a.jsx(y,{query:x,isVisible:C,onSelect:e=>{g(e),q(!1),v(!0),w(!0),m.push(`/search?q=${encodeURIComponent(e)}`),z(e),(0,c.F0)(e)},onClose:()=>q(!1)})]})})}),a.jsx("div",{className:"max-w-[95%] mx-auto mt-12 overflow-visible",children:b?a.jsx("div",{className:"flex justify-center items-center h-40",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})}):k?(0,a.jsxs)("section",{className:"mb-12",children:[a.jsx("div",{className:"mb-4",children:a.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:"搜索结果"})}),(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between gap-3",children:[a.jsx("div",{className:"flex-1 min-w-0",children:"agg"===P?a.jsx(h,{categories:I.categoriesAgg,values:M,onChange:e=>$(e)}):a.jsx(h,{categories:I.categoriesAll,values:A,onChange:e=>_(e)})}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer select-none shrink-0",children:[a.jsx("span",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:"聚合"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("input",{type:"checkbox",className:"sr-only peer",checked:"agg"===P,onChange:()=>E("agg"===P?"all":"agg")}),a.jsx("div",{className:"w-9 h-5 bg-gray-300 rounded-full peer-checked:bg-green-500 transition-colors dark:bg-gray-600"}),a.jsx("div",{className:"absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4"})]})]})]}),(0,a.jsxs)("div",{className:"justify-start grid grid-cols-3 gap-x-2 gap-y-14 sm:gap-y-20 px-0 sm:px-2 sm:grid-cols-[repeat(auto-fill,_minmax(11rem,_1fr))] sm:gap-x-8",children:["agg"===P?Z.map(([e,r])=>a.jsx("div",{className:"w-full",children:a.jsx(f.Z,{from:"search",items:r,query:x.trim()!==r[0].title?x.trim():""})},`agg-${e}`)):L.map(e=>a.jsx("div",{className:"w-full",children:a.jsx(f.Z,{id:e.id,title:e.title,poster:e.poster,episodes:e.episodes.length,source:e.source,source_name:e.source_name,douban_id:e.douban_id,query:x.trim()!==e.title?x.trim():"",year:e.year,from:"search",type:e.episodes.length>1?"tv":"movie"})},`all-${e.source}-${e.id}`)),0===j.length&&a.jsx("div",{className:"col-span-full text-center text-gray-500 py-8 dark:text-gray-400",children:"未找到相关结果"})]},`search-results-${P}`)]}):e.length>0?(0,a.jsxs)("section",{className:"mb-12",children:[(0,a.jsxs)("h2",{className:"mb-4 text-xl font-bold text-gray-800 text-left dark:text-gray-200",children:["搜索历史",e.length>0&&a.jsx("button",{onClick:()=>{(0,c.Ev)()},className:"ml-3 text-sm text-gray-500 hover:text-red-500 transition-colors dark:text-gray-400 dark:hover:text-red-500",children:"清空"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsxs)("div",{className:"relative group",children:[a.jsx("button",{onClick:()=>{g(e),m.push(`/search?q=${encodeURIComponent(e.trim())}`)},className:"px-4 py-2 bg-gray-500/10 hover:bg-gray-300 rounded-full text-sm text-gray-700 transition-colors duration-200 dark:bg-gray-700/50 dark:hover:bg-gray-600 dark:text-gray-300",children:e}),a.jsx("button",{"aria-label":"删除搜索历史",onClick:r=>{r.stopPropagation(),r.preventDefault(),(0,c.Rw)(e)},className:"absolute -top-1 -right-1 w-4 h-4 opacity-0 group-hover:opacity-100 bg-gray-400 hover:bg-red-500 text-white rounded-full flex items-center justify-center text-[10px] transition-colors",children:a.jsx(l.Z,{className:"w-3 h-3"})})]},e))})]}):null})]}),a.jsx("button",{onClick:()=>{try{document.body.scrollTo({top:0,behavior:"smooth"})}catch(e){document.body.scrollTop=0}},className:`fixed bottom-20 md:bottom-6 right-6 z-[500] w-12 h-12 bg-green-500/90 hover:bg-green-500 text-white rounded-full shadow-lg backdrop-blur-sm transition-all duration-300 ease-in-out flex items-center justify-center group ${t?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 translate-y-4 pointer-events-none"}`,"aria-label":"返回顶部",children:a.jsx(n.Z,{className:"w-6 h-6 transition-transform group-hover:scale-110"})})]})}function v(){return a.jsx(i.Suspense,{children:a.jsx(b,{})})}},96418:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});let a=(0,t(15761).createProxy)(String.raw`/app/src/app/search/page.tsx#default`)}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[7796,9864,6981,9825,8013,2158,5737,9535,8300,1723,1496],()=>t(46908));module.exports=a})();