"use strict";(()=>{var e={};e.id=6413,e.ids=[6413],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},82142:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{GET:()=>p,runtime:()=>u});var n=r(4762),s=r(20515),a=r(4894),i=r(13303),l=r(7674),c=r(71398);let u="nodejs";async function p(e){let{searchParams:t}=new URL(e.url),r=t.get("q");if(!r)return new Response(JSON.stringify({error:"搜索关键词不能为空"}),{status:400,headers:{"Content-Type":"application/json"}});let o=await (0,i.iE)(),n=o.SourceConfig.filter(e=>!e.disabled),s=!1;return new Response(new ReadableStream({async start(e){let t=new TextEncoder,a=t=>{try{if(s||!e.desiredSize&&0!==e.desiredSize)return!1;return e.enqueue(t),!0}catch(e){return console.warn("Failed to enqueue data:",e),s=!0,!1}},i=`data: ${JSON.stringify({type:"start",query:r,totalSources:n.length,timestamp:Date.now()})}

`;if(!a(t.encode(i)))return;let u=0,p=[],d=n.map(async i=>{try{let e=Promise.race([(0,l.s)(i,r),new Promise((e,t)=>setTimeout(()=>t(Error(`${i.name} timeout`)),1e4))]),n=await e,d=n;if(o.SiteConfig.DisableYellowFilter||(d=n.filter(e=>{let t=e.type_name||"";return!c.L.some(e=>t.includes(e))})),u++,!s){let e=`data: ${JSON.stringify({type:"source_result",source:i.key,sourceName:i.name,results:d,timestamp:Date.now()})}

`;if(!a(t.encode(e))){s=!0;return}}d.length>0&&p.push(...d)}catch(e){if(console.warn(`搜索失败 ${i.name}:`,e),u++,!s){let r=`data: ${JSON.stringify({type:"source_error",source:i.key,sourceName:i.name,error:e instanceof Error?e.message:"搜索失败",timestamp:Date.now()})}

`;if(!a(t.encode(r))){s=!0;return}}}if(u===n.length&&!s){let r=`data: ${JSON.stringify({type:"complete",totalResults:p.length,completedSources:u,timestamp:Date.now()})}

`;if(a(t.encode(r)))try{e.close()}catch(e){console.warn("Failed to close controller:",e)}}});await Promise.allSettled(d)},cancel(){s=!0,console.log("Client disconnected, cancelling search stream")}}),{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET","Access-Control-Allow-Headers":"Content-Type"}})}let d=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/search/ws/route",pathname:"/api/search/ws",filename:"route",bundlePath:"app/api/search/ws/route"},resolvedPagePath:"/app/src/app/api/search/ws/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:w}=d,y="/api/search/ws/route";function f(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},4762:(e,t,r)=>{e.exports=r(30517)},71398:(e,t,r)=>{r.d(t,{L:()=>o});let o=["伦理片","福利","里番动漫","门事件","萝莉少女","制服诱惑","国产传媒","cosplay","黑丝诱惑","无码","日本无码","有码","日本有码","SWAG","网红主播","色情片","同性片","福利视频","福利片","写真热舞"]}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[677,9864,6735,7690,7674],()=>r(82142));module.exports=o})();