"use strict";(()=>{var e={};e.id=349,e.ids=[349],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},29135:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>N,staticGenerationAsyncStorage:()=>C});var n={};r.r(n),r.d(n,{DELETE:()=>d,GET:()=>f,POST:()=>m,runtime:()=>l});var s=r(4762),o=r(20515),i=r(4894),a=r(40379),u=r(46307),p=r(13303),c=r(35737);let l="nodejs";async function f(e){try{let t=(0,u.l)(e);if(!t||!t.username)return a.NextResponse.json({error:"未登录"},{status:401});let r=await (0,p.iE)();if(r.UserConfig.Users){let e=r.UserConfig.Users.find(e=>e.username===t.username);if(e&&e.banned)return a.NextResponse.json({error:"用户已被封禁"},{status:401})}let{searchParams:n}=new URL(e.url),s=n.get("source"),o=n.get("id");if(s&&o){let e=await c.db.getSkipConfig(t.username,s,o);return a.NextResponse.json(e)}{let e=await c.db.getAllSkipConfigs(t.username);return a.NextResponse.json(e)}}catch(e){return console.error("获取跳过片头片尾配置失败:",e),a.NextResponse.json({error:"获取跳过片头片尾配置失败"},{status:500})}}async function m(e){try{let t=(0,u.l)(e);if(!t||!t.username)return a.NextResponse.json({error:"未登录"},{status:401});let r=await (0,p.iE)();if(r.UserConfig.Users){let e=r.UserConfig.Users.find(e=>e.username===t.username);if(e&&e.banned)return a.NextResponse.json({error:"用户已被封禁"},{status:401})}let{key:n,config:s}=await e.json();if(!n||!s)return a.NextResponse.json({error:"缺少必要参数"},{status:400});let[o,i]=n.split("+");if(!o||!i)return a.NextResponse.json({error:"无效的key格式"},{status:400});let l={enable:!!s.enable,intro_time:Number(s.intro_time)||0,outro_time:Number(s.outro_time)||0};return await c.db.setSkipConfig(t.username,o,i,l),a.NextResponse.json({success:!0})}catch(e){return console.error("保存跳过片头片尾配置失败:",e),a.NextResponse.json({error:"保存跳过片头片尾配置失败"},{status:500})}}async function d(e){try{let t=(0,u.l)(e);if(!t||!t.username)return a.NextResponse.json({error:"未登录"},{status:401});let r=await (0,p.iE)();if(r.UserConfig.Users){let e=r.UserConfig.Users.find(e=>e.username===t.username);if(e&&e.banned)return a.NextResponse.json({error:"用户已被封禁"},{status:401})}let{searchParams:n}=new URL(e.url),s=n.get("key");if(!s)return a.NextResponse.json({error:"缺少必要参数"},{status:400});let[o,i]=s.split("+");if(!o||!i)return a.NextResponse.json({error:"无效的key格式"},{status:400});return await c.db.deleteSkipConfig(t.username,o,i),a.NextResponse.json({success:!0})}catch(e){return console.error("删除跳过片头片尾配置失败:",e),a.NextResponse.json({error:"删除跳过片头片尾配置失败"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/skipconfigs/route",pathname:"/api/skipconfigs",filename:"route",bundlePath:"app/api/skipconfigs/route"},resolvedPagePath:"/app/src/app/api/skipconfigs/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:C,serverHooks:N}=g,E="/api/skipconfigs/route";function h(){return(0,i.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:C})}},46307:(e,t,r)=>{function n(e){let t=e.cookies.get("auth");if(!t)return null;try{let e=decodeURIComponent(t.value);return JSON.parse(e)}catch(e){return null}}r.d(t,{l:()=>n})},13303:(e,t,r)=>{let n;r.d(t,{Hz:()=>o,Ih:()=>p,iE:()=>u,jT:()=>c,ll:()=>l,mL:()=>i});var s=r(35737);let o={search:{path:"?ac=videolist&wd=",pagePath:"?ac=videolist&wd={query}&pg={page}",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}},detail:{path:"?ac=videolist&ids=",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}}};function i(e){let t;try{t=JSON.parse(e.ConfigFile)}catch(e){t={}}let r=Object.entries(t.api_site||[]),n=new Map((e.SourceConfig||[]).map(e=>[e.key,e]));r.forEach(([e,t])=>{let r=n.get(e);r?(r.name=t.name,r.api=t.api,r.detail=t.detail,r.from="config"):n.set(e,{key:e,name:t.name,api:t.api,detail:t.detail,from:"config",disabled:!1})});let s=new Set(r.map(([e])=>e));n.forEach(e=>{s.has(e.key)||(e.from="custom")}),e.SourceConfig=Array.from(n.values());let o=t.custom_category||[],i=new Map((e.CustomCategories||[]).map(e=>[e.query+e.type,e]));o.forEach(e=>{let t=e.query+e.type,r=i.get(t);r?(r.name=e.name,r.query=e.query,r.type=e.type,r.from="config"):i.set(t,{name:e.name,type:e.type,query:e.query,from:"config",disabled:!1})});let a=new Set(o.map(e=>e.query+e.type));return i.forEach(e=>{a.has(e.query+e.type)||(e.from="custom")}),e.CustomCategories=Array.from(i.values()),e}async function a(e,t={URL:"",AutoUpdate:!1,LastCheck:""}){let r;try{r=JSON.parse(e)}catch(e){r={}}let n={ConfigFile:e,ConfigSubscribtion:t,SiteConfig:{SiteName:process.env.NEXT_PUBLIC_SITE_NAME||"MoonTV",Announcement:process.env.ANNOUNCEMENT||"本网站仅提供影视信息搜索服务，所有内容均来自第三方网站。本站不存储任何视频资源，不对任何内容的准确性、合法性、完整性负责。",SearchDownstreamMaxPage:Number(process.env.NEXT_PUBLIC_SEARCH_MAX_PAGE)||5,SiteInterfaceCacheTime:r.cache_time||7200,DoubanProxyType:process.env.NEXT_PUBLIC_DOUBAN_PROXY_TYPE||"direct",DoubanProxy:process.env.NEXT_PUBLIC_DOUBAN_PROXY||"",DoubanImageProxyType:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY_TYPE||"direct",DoubanImageProxy:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY||"",DisableYellowFilter:"true"===process.env.NEXT_PUBLIC_DISABLE_YELLOW_FILTER},UserConfig:{AllowRegister:"true"===process.env.NEXT_PUBLIC_ENABLE_REGISTER,Users:[]},SourceConfig:[],CustomCategories:[]},o=(0,s.cF)(),i=[];if(o&&"function"==typeof o.getAllUsers)try{i=await o.getAllUsers()}catch(e){console.error("获取用户列表失败:",e)}let a=i.filter(e=>e!==process.env.USERNAME).map(e=>({username:e,role:"user",banned:!1}));return a.unshift({username:process.env.USERNAME,role:"owner",banned:!1}),n.UserConfig.Users=a,Object.entries(r.api_site||[]).forEach(([e,t])=>{n.SourceConfig.push({key:e,name:t.name,api:t.api,detail:t.detail,from:"config",disabled:!1})}),r.custom_category?.forEach(e=>{n.CustomCategories.push({name:e.name||e.query,type:e.type,query:e.query,from:"config",disabled:!1})}),n}async function u(){if(n)return n;let e=(0,s.cF)(),t=null;return e&&"function"==typeof e.getAdminConfig&&(t=await e.getAdminConfig()),t||(t=await a("")),n=t}async function p(){let e;let t=(0,s.cF)();e=t&&"function"==typeof t.getAdminConfig?await t.getAdminConfig():{};let r=await a(e.ConfigFile,e.ConfigSubscribtion);n=r,t&&"function"==typeof t.setAdminConfig&&await t.setAdminConfig(r)}async function c(){return(await u()).SiteConfig.SiteInterfaceCacheTime||7200}async function l(){return(await u()).SourceConfig.filter(e=>!e.disabled).map(e=>({key:e.key,name:e.name,api:e.api,detail:e.detail}))}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7796,9864,3001,5737],()=>r(29135));module.exports=n})();