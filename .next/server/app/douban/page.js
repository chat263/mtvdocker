(()=>{var e={};e.id=4936,e.ids=[4936],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},6005:e=>{"use strict";e.exports=require("node:crypto")},79546:(e,a,l)=>{"use strict";l.r(a),l.d(a,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>d,pages:()=>c,routeModule:()=>v,tree:()=>u}),l(5231),l(83421),l(85673);var t=l(41118),r=l(20515),s=l(17412),n=l.n(s),i=l(35078),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);l.d(a,o);let u=["",{children:["douban",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(l.bind(l,5231)),"/app/src/app/douban/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(l.bind(l,83421)),"/app/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(l.t.bind(l,85673,23)),"next/dist/client/components/not-found-error"]}],c=["/app/src/app/douban/page.tsx"],d="/douban/page",m={require:l,loadChunk:()=>Promise.resolve()},v=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/douban/page",pathname:"/douban",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},99224:(e,a,l)=>{Promise.resolve().then(l.bind(l,94167))},94167:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>_});var t=l(19681),r=l(18202),s=l(73301),n=l.n(s);async function i(){let e=await fetch("https://api.bgm.tv/calendar");return await e.json()}async function o(e,a){let l=new AbortController,t=setTimeout(()=>l.abort(),1e4),r="https://cors-anywhere.com/"===a?`${a}${e}`:a?`${a}${encodeURIComponent(e)}`:e,s={signal:l.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Referer:"https://movie.douban.com/",Accept:"application/json, text/plain, */*"}};try{let e=await fetch(r,s);return clearTimeout(t),e}catch(e){throw clearTimeout(t),e}}function u(){return{proxyType:localStorage.getItem("doubanDataSource")||window.RUNTIME_CONFIG?.DOUBAN_PROXY_TYPE||"melody-cdn-sharon",proxyUrl:localStorage.getItem("doubanProxyUrl")||window.RUNTIME_CONFIG?.DOUBAN_PROXY||""}}async function c(e,a,l=!1,t=!1){let{kind:r,category:s,type:n,pageLimit:i=20,pageStart:u=0}=e;if(!["tv","movie"].includes(r))throw Error("kind 参数必须是 tv 或 movie");if(!s||!n)throw Error("category 和 type 参数不能为空");if(i<1||i>100)throw Error("pageLimit 必须在 1-100 之间");if(u<0)throw Error("pageStart 不能小于 0");let c=l?`https://m.douban.cmliussss.net/rexxar/api/v2/subject/recent_hot/${r}?start=${u}&limit=${i}&category=${s}&type=${n}`:t?`https://m.douban.cmliussss.com/rexxar/api/v2/subject/recent_hot/${r}?start=${u}&limit=${i}&category=${s}&type=${n}`:`https://m.douban.com/rexxar/api/v2/subject/recent_hot/${r}?start=${u}&limit=${i}&category=${s}&type=${n}`;try{let e=await o(c,l||t?"":a);if(!e.ok)throw Error(`HTTP error! Status: ${e.status}`);let r=(await e.json()).items.map(e=>({id:e.id,title:e.title,poster:e.pic?.normal||e.pic?.large||"",rate:e.rating?.value?e.rating.value.toFixed(1):"",year:e.card_subtitle?.match(/(\d{4})/)?.[1]||""}));return{code:200,message:"获取成功",list:r}}catch(e){throw Error(`获取豆瓣分类数据失败: ${e.message}`)}}async function d(e){let{kind:a,category:l,type:t,pageLimit:r=20,pageStart:s=0}=e,{proxyType:n,proxyUrl:i}=u();switch(n){case"melody-cdn-sharon":return c(e,"https://douban.ihtw.moe/");case"cors-proxy-zwei":return c(e,"https://ciao-cors.is-an.org/");case"cmliussss-cdn-tencent":return c(e,"",!0,!1);case"cmliussss-cdn-ali":return c(e,"",!1,!0);case"cors-anywhere":return c(e,"https://cors-anywhere.com/");case"custom":return c(e,i);default:return(await fetch(`/api/douban/categories?kind=${a}&category=${l}&type=${t}&limit=${r}&start=${s}`)).json()}}async function m(e){let{tag:a,type:l,pageLimit:t=20,pageStart:r=0}=e,{proxyType:s,proxyUrl:n}=u();switch(s){case"melody-cdn-sharon":return v(e,"https://douban.ihtw.moe/");case"cors-proxy-zwei":return v(e,"https://ciao-cors.is-an.org/");case"cmliussss-cdn-tencent":return v(e,"",!0,!1);case"cmliussss-cdn-ali":return v(e,"",!1,!0);case"cors-anywhere":return v(e,"https://cors-anywhere.com/");case"custom":return v(e,n);default:return(await fetch(`/api/douban?tag=${a}&type=${l}&pageSize=${t}&pageStart=${r}`)).json()}}async function v(e,a,l=!1,t=!1){let{tag:r,type:s,pageLimit:n=20,pageStart:i=0}=e;if(!r||!s)throw Error("tag 和 type 参数不能为空");if(!["tv","movie"].includes(s))throw Error("type 参数必须是 tv 或 movie");if(n<1||n>100)throw Error("pageLimit 必须在 1-100 之间");if(i<0)throw Error("pageStart 不能小于 0");let u=l?`https://movie.douban.cmliussss.net/j/search_subjects?type=${s}&tag=${r}&sort=recommend&page_limit=${n}&page_start=${i}`:t?`https://movie.douban.cmliussss.com/j/search_subjects?type=${s}&tag=${r}&sort=recommend&page_limit=${n}&page_start=${i}`:`https://movie.douban.com/j/search_subjects?type=${s}&tag=${r}&sort=recommend&page_limit=${n}&page_start=${i}`;try{let e=await o(u,l||t?"":a);if(!e.ok)throw Error(`HTTP error! Status: ${e.status}`);let r=(await e.json()).subjects.map(e=>({id:e.id,title:e.title,poster:e.cover,rate:e.rate,year:e.card_subtitle?.match(/(\d{4})/)?.[1]||""}));return{code:200,message:"获取成功",list:r}}catch(e){throw Error(`获取豆瓣分类数据失败: ${e.message}`)}}async function x(e){let{kind:a,pageLimit:l=20,pageStart:t=0,category:r,format:s,label:n,region:i,year:o,platform:c,sort:d}=e,{proxyType:m,proxyUrl:v}=u();switch(m){case"melody-cdn-sharon":return p(e,"https://douban.ihtw.moe/");case"cors-proxy-zwei":return p(e,"https://ciao-cors.is-an.org/");case"cmliussss-cdn-tencent":return p(e,"",!0,!1);case"cmliussss-cdn-ali":return p(e,"",!1,!0);case"cors-anywhere":return p(e,"https://cors-anywhere.com/");case"custom":return p(e,v);default:return(await fetch(`/api/douban/recommends?kind=${a}&limit=${l}&start=${t}&category=${r}&format=${s}&region=${i}&year=${o}&platform=${c}&sort=${d}&label=${n}`)).json()}}async function p(e,a,l=!1,t=!1){let{kind:r,pageLimit:s=20,pageStart:n=0}=e,{category:i,format:u,region:c,year:d,platform:m,sort:v,label:x}=e;"all"===i&&(i=""),"all"===u&&(u=""),"all"===x&&(x=""),"all"===c&&(c=""),"all"===d&&(d=""),"all"===m&&(m=""),"T"===v&&(v="");let p={类型:i};u&&(p["形式"]=u),c&&(p["地区"]=c);let b=[];i&&b.push(i),!i&&u&&b.push(u),x&&b.push(x),c&&b.push(c),d&&b.push(d),m&&b.push(m);let h=l?`https://m.douban.cmliussss.net/rexxar/api/v2/${r}/recommend`:t?`https://m.douban.cmliussss.com/rexxar/api/v2/${r}/recommend`:`https://m.douban.com/rexxar/api/v2/${r}/recommend`,g=new URLSearchParams;g.append("refresh","0"),g.append("start",n.toString()),g.append("count",s.toString()),g.append("selected_categories",JSON.stringify(p)),g.append("uncollect","false"),g.append("score_range","0,10"),g.append("tags",b.join(",")),v&&g.append("sort",v);let f=`${h}?${g.toString()}`;console.log(f);try{let e=await o(f,l||t?"":a);if(!e.ok)throw Error(`HTTP error! Status: ${e.status}`);let r=(await e.json()).items.filter(e=>"movie"==e.type||"tv"==e.type).map(e=>({id:e.id,title:e.title,poster:e.pic?.normal||e.pic?.large||"",rate:e.rating?.value?e.rating.value.toFixed(1):"",year:e.year}));return{code:200,message:"获取成功",list:r}}catch(e){throw Error(`获取豆瓣推荐数据失败: ${e.message}`)}}var b=l(22106);let h=()=>t.jsx("div",{className:"w-full",children:(0,t.jsxs)("div",{className:"group relative w-full rounded-lg bg-transparent shadow-none flex flex-col",children:[t.jsx(b.Z,{aspectRatio:"aspect-[2/3]"}),t.jsx("div",{className:"absolute top-[calc(100%+0.5rem)] left-0 right-0",children:t.jsx("div",{className:"flex flex-col items-center justify-center",children:t.jsx("div",{className:"h-4 w-24 sm:w-32 bg-gray-200 rounded animate-pulse mb-2"})})})]})}),g=({customCategories:e,primarySelection:a,secondarySelection:l,onPrimaryChange:r,onSecondaryChange:i})=>{let o=(0,s.useRef)(null),u=(0,s.useRef)([]),[c,d]=(0,s.useState)({left:0,width:0}),m=(0,s.useRef)(null),v=(0,s.useRef)([]),[x,p]=(0,s.useState)({left:0,width:0}),b=(0,s.useRef)(null),h=n().useMemo(()=>Array.from(new Set(e.map(e=>e.type))).sort((e,a)=>"movie"===e&&"movie"!==a?-1:"movie"!==e&&"movie"===a?1:0).map(e=>({label:"movie"===e?"电影":"剧集",value:e})),[e]),g=n().useMemo(()=>a?e.filter(e=>e.type===a).map(e=>({label:e.name||e.query,value:e.query})):[],[e,a]),f=n().useCallback(e=>{e.preventDefault(),e.stopPropagation();let a=b.current;if(a){let l=2*e.deltaY;a.scrollLeft+=l}},[]);(0,s.useEffect)(()=>{let e=b.current,a=m.current;if(e&&a)return e.addEventListener("wheel",f,{passive:!1}),a.addEventListener("wheel",f,{passive:!1}),()=>{e.removeEventListener("wheel",f),a.removeEventListener("wheel",f)}},[f]),(0,s.useEffect)(()=>{let e=b.current,a=m.current;if(e&&a&&g.length>0)return e.addEventListener("wheel",f,{passive:!1}),a.addEventListener("wheel",f,{passive:!1}),()=>{e.removeEventListener("wheel",f),a.removeEventListener("wheel",f)}},[f,g]);let y=(e,a,l,t)=>{if(e>=0&&l.current[e]&&a.current){let r=setTimeout(()=>{let r=l.current[e],s=a.current;if(r&&s){let e=r.getBoundingClientRect(),a=s.getBoundingClientRect();e.width>0&&t({left:e.left-a.left,width:e.width})}},0);return()=>clearTimeout(r)}};(0,s.useEffect)(()=>{h.length>0&&y(h.findIndex(e=>e.value===(a||h[0].value)),o,u,d),g.length>0&&y(g.findIndex(e=>e.value===(l||g[0].value)),m,v,p)},[h,g]),(0,s.useEffect)(()=>{if(h.length>0)return y(h.findIndex(e=>e.value===a),o,u,d)},[a,h]),(0,s.useEffect)(()=>{if(g.length>0)return y(g.findIndex(e=>e.value===l),m,v,p)},[l,g]);let w=(e,a,l,r=!1)=>{let s=r?u:v,n=r?c:x;return(0,t.jsxs)("div",{ref:r?o:m,className:"relative inline-flex bg-gray-200/60 rounded-full p-0.5 sm:p-1 dark:bg-gray-700/60 backdrop-blur-sm",children:[n.width>0&&t.jsx("div",{className:"absolute top-0.5 bottom-0.5 sm:top-1 sm:bottom-1 bg-white dark:bg-gray-500 rounded-full shadow-sm transition-all duration-300 ease-out",style:{left:`${n.left}px`,width:`${n.width}px`}}),e.map((e,r)=>{let n=a===e.value;return t.jsx("button",{ref:e=>{s.current[r]=e},onClick:()=>l(e.value),className:`relative z-10 px-2 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ${n?"text-gray-900 dark:text-gray-100 cursor-default":"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"}`,children:e.label},e.value)})]})};return e&&0!==e.length?t.jsx("div",{className:"space-y-4 sm:space-y-6",children:(0,t.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"类型"}),t.jsx("div",{className:"overflow-x-auto",children:w(h,a||h[0]?.value,r,!0)})]}),g.length>0&&(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"片单"}),t.jsx("div",{ref:b,className:"overflow-x-auto",children:w(g,l||g[0]?.value,i,!1)})]})]})}):null};var f=l(15501);let y=({onChange:e,contentType:a="movie"})=>{let[l,r]=(0,s.useState)(null),[n,i]=(0,s.useState)({x:0,y:0,width:0}),[o,u]=(0,s.useState)({}),c=(0,s.useRef)({}),d=(0,s.useRef)(null),m=[..."anime-tv"!==a&&"anime-movie"!==a?[{key:"type",label:"类型",options:(e=>{let a=[{label:"全部",value:"all"}];switch(e){case"movie":return[...a,{label:"喜剧",value:"comedy"},{label:"爱情",value:"romance"},{label:"动作",value:"action"},{label:"科幻",value:"sci-fi"},{label:"悬疑",value:"suspense"},{label:"犯罪",value:"crime"},{label:"惊悚",value:"thriller"},{label:"冒险",value:"adventure"},{label:"音乐",value:"music"},{label:"历史",value:"history"},{label:"奇幻",value:"fantasy"},{label:"恐怖",value:"horror"},{label:"战争",value:"war"},{label:"传记",value:"biography"},{label:"歌舞",value:"musical"},{label:"武侠",value:"wuxia"},{label:"情色",value:"erotic"},{label:"灾难",value:"disaster"},{label:"西部",value:"western"},{label:"纪录片",value:"documentary"},{label:"短片",value:"short"}];case"tv":return[...a,{label:"喜剧",value:"comedy"},{label:"爱情",value:"romance"},{label:"悬疑",value:"suspense"},{label:"武侠",value:"wuxia"},{label:"古装",value:"costume"},{label:"家庭",value:"family"},{label:"犯罪",value:"crime"},{label:"科幻",value:"sci-fi"},{label:"恐怖",value:"horror"},{label:"历史",value:"history"},{label:"战争",value:"war"},{label:"动作",value:"action"},{label:"冒险",value:"adventure"},{label:"传记",value:"biography"},{label:"剧情",value:"drama"},{label:"奇幻",value:"fantasy"},{label:"惊悚",value:"thriller"},{label:"灾难",value:"disaster"},{label:"歌舞",value:"musical"},{label:"音乐",value:"music"}];case"show":return[...a,{label:"真人秀",value:"reality"},{label:"脱口秀",value:"talkshow"},{label:"音乐",value:"music"},{label:"歌舞",value:"musical"}];default:return a}})(a)}]:[{key:"label",label:"类型",options:(e=>{let a=[{label:"全部",value:"all"}];switch(e){case"anime-movie":return[...a,{label:"定格动画",value:"stop_motion"},{label:"传记",value:"biography"},{label:"美国动画",value:"us_animation"},{label:"爱情",value:"romance"},{label:"黑色幽默",value:"dark_humor"},{label:"歌舞",value:"musical"},{label:"儿童",value:"children"},{label:"二次元",value:"anime"},{label:"动物",value:"animal"},{label:"青春",value:"youth"},{label:"历史",value:"history"},{label:"励志",value:"inspirational"},{label:"恶搞",value:"parody"},{label:"治愈",value:"healing"},{label:"运动",value:"sports"},{label:"后宫",value:"harem"},{label:"情色",value:"erotic"},{label:"人性",value:"human_nature"},{label:"悬疑",value:"suspense"},{label:"恋爱",value:"love"},{label:"魔幻",value:"fantasy"},{label:"科幻",value:"sci_fi"}];case"anime-tv":return[...a,{label:"黑色幽默",value:"dark_humor"},{label:"历史",value:"history"},{label:"歌舞",value:"musical"},{label:"励志",value:"inspirational"},{label:"恶搞",value:"parody"},{label:"治愈",value:"healing"},{label:"运动",value:"sports"},{label:"后宫",value:"harem"},{label:"情色",value:"erotic"},{label:"国漫",value:"chinese_anime"},{label:"人性",value:"human_nature"},{label:"悬疑",value:"suspense"},{label:"恋爱",value:"love"},{label:"魔幻",value:"fantasy"},{label:"科幻",value:"sci_fi"}];default:return a}})(a)}],{key:"region",label:"地区",options:(e=>{let a=[{label:"全部",value:"all"}];switch(e){case"movie":case"anime-movie":return[...a,{label:"华语",value:"chinese"},{label:"欧美",value:"western"},{label:"韩国",value:"korean"},{label:"日本",value:"japanese"},{label:"中国大陆",value:"mainland_china"},{label:"美国",value:"usa"},{label:"中国香港",value:"hong_kong"},{label:"中国台湾",value:"taiwan"},{label:"英国",value:"uk"},{label:"法国",value:"france"},{label:"德国",value:"germany"},{label:"意大利",value:"italy"},{label:"西班牙",value:"spain"},{label:"印度",value:"india"},{label:"泰国",value:"thailand"},{label:"俄罗斯",value:"russia"},{label:"加拿大",value:"canada"},{label:"澳大利亚",value:"australia"},{label:"爱尔兰",value:"ireland"},{label:"瑞典",value:"sweden"},{label:"巴西",value:"brazil"},{label:"丹麦",value:"denmark"}];case"tv":case"anime-tv":case"show":return[...a,{label:"华语",value:"chinese"},{label:"欧美",value:"western"},{label:"国外",value:"foreign"},{label:"韩国",value:"korean"},{label:"日本",value:"japanese"},{label:"中国大陆",value:"mainland_china"},{label:"中国香港",value:"hong_kong"},{label:"美国",value:"usa"},{label:"英国",value:"uk"},{label:"泰国",value:"thailand"},{label:"中国台湾",value:"taiwan"},{label:"意大利",value:"italy"},{label:"法国",value:"france"},{label:"德国",value:"germany"},{label:"西班牙",value:"spain"},{label:"俄罗斯",value:"russia"},{label:"瑞典",value:"sweden"},{label:"巴西",value:"brazil"},{label:"丹麦",value:"denmark"},{label:"印度",value:"india"},{label:"加拿大",value:"canada"},{label:"爱尔兰",value:"ireland"},{label:"澳大利亚",value:"australia"}];default:return a}})(a)},{key:"year",label:"年代",options:[{label:"全部",value:"all"},{label:"2020年代",value:"2020s"},{label:"2025",value:"2025"},{label:"2024",value:"2024"},{label:"2023",value:"2023"},{label:"2022",value:"2022"},{label:"2021",value:"2021"},{label:"2020",value:"2020"},{label:"2019",value:"2019"},{label:"2010年代",value:"2010s"},{label:"2000年代",value:"2000s"},{label:"90年代",value:"1990s"},{label:"80年代",value:"1980s"},{label:"70年代",value:"1970s"},{label:"60年代",value:"1960s"},{label:"更早",value:"earlier"}]},..."tv"===a||"show"===a||"anime-tv"===a?[{key:"platform",label:"平台",options:(e=>{let a=[{label:"全部",value:"all"}];switch(e){case"movie":default:return a;case"tv":case"anime-tv":case"show":return[...a,{label:"腾讯视频",value:"tencent"},{label:"爱奇艺",value:"iqiyi"},{label:"优酷",value:"youku"},{label:"湖南卫视",value:"hunan_tv"},{label:"Netflix",value:"netflix"},{label:"HBO",value:"hbo"},{label:"BBC",value:"bbc"},{label:"NHK",value:"nhk"},{label:"CBS",value:"cbs"},{label:"NBC",value:"nbc"},{label:"tvN",value:"tvn"}]}})(a)}]:[],{key:"sort",label:"排序",options:[{label:"综合排序",value:"T"},{label:"近期热度",value:"U"},{label:"tv"===a||"show"===a?"首播时间":"首映时间",value:"R"},{label:"高分优先",value:"S"}]}],v=e=>{let a=c.current[e];if(a){let e=a.getBoundingClientRect(),l=window.innerWidth,t=e.left,r=Math.max(e.width,300),s=!1;l<768&&(s=!0,t+(r=Math.min(r,l-32))>l-16&&(t=l-r-16),t<16&&(t=16)),i({x:t,y:e.bottom,width:s?r:e.width})}},x=e=>{l===e?r(null):(r(e),v(e))},p=(a,l)=>{let t={...o,[a]:l};u(t);let s={type:"all",region:"all",year:"all",platform:"all",label:"all",sort:"T"};Object.entries(t).forEach(([e,a])=>{if(a&&"all"!==a&&("sort"!==e||"T"!==a)){let l=m.find(a=>a.key===e);if(l){let t=l.options.find(e=>e.value===a);t&&(s[e]="sort"===e?t.value:t.label)}}}),e(s),r(null)},b=e=>{let a=m.find(a=>a.key===e);if(!a)return"";let l=o[e];if(!l||"all"===l||"sort"===e&&"T"===l)return a.label;let t=a.options.find(e=>e.value===l);return t?.label||a.label},h=e=>{let a=o[e];return!a||"all"===a||"sort"===e&&"T"===a},g=(e,a)=>{let l=o[e];return void 0===l&&(l="all","sort"===e&&(l="T")),l===a};return(0,s.useEffect)(()=>{let e=()=>{l&&r(null)},a=()=>{l&&v(l)};return document.body.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",a),()=>{document.body.removeEventListener("scroll",e),window.removeEventListener("resize",a)}},[l]),(0,s.useEffect)(()=>{let e=e=>{!d.current||d.current.contains(e.target)||Object.values(c.current).some(a=>a&&a.contains(e.target))||r(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.jsxs)(t.Fragment,{children:[t.jsx("div",{className:"relative inline-flex rounded-full p-0.5 sm:p-1 bg-transparent gap-1 sm:gap-2",children:m.map(e=>t.jsx("div",{ref:a=>{c.current[e.key]=a},className:"relative",children:(0,t.jsxs)("button",{onClick:()=>x(e.key),className:`relative z-10 px-1.5 py-0.5 sm:px-2 sm:py-1 md:px-4 md:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ${l===e.key?h(e.key)?"text-gray-900 dark:text-gray-100 cursor-default":"text-green-600 dark:text-green-400 cursor-default":h(e.key)?"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer":"text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 cursor-pointer"}`,children:[t.jsx("span",{children:b(e.key)}),t.jsx("svg",{className:`inline-block w-2.5 h-2.5 sm:w-3 sm:h-3 ml-0.5 sm:ml-1 transition-transform duration-200 ${l===e.key?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})},e.key))}),l&&(0,f.createPortal)(t.jsx("div",{ref:d,className:"fixed z-[9999] bg-white/95 dark:bg-gray-800/95 rounded-xl border border-gray-200/50 dark:border-gray-700/50 backdrop-blur-sm",style:{left:`${n.x}px`,top:`${n.y}px`,...window.innerWidth<768?{width:`${n.width}px`}:{minWidth:`${Math.max(n.width,300)}px`},maxWidth:"600px",position:"fixed"},children:t.jsx("div",{className:"p-2 sm:p-4",children:t.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-1 sm:gap-2",children:m.find(e=>e.key===l)?.options.map(e=>t.jsx("button",{onClick:()=>p(l,e.value),className:`px-2 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm rounded-lg transition-all duration-200 text-left ${g(l,e.value)?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border border-green-200 dark:border-green-700":"text-gray-700 dark:text-gray-300 hover:bg-gray-100/80 dark:hover:bg-gray-700/80"}`,children:e.label},e.value))})})}),document.body)]})},w=[{value:"Mon",label:"周一",shortLabel:"周一"},{value:"Tue",label:"周二",shortLabel:"周二"},{value:"Wed",label:"周三",shortLabel:"周三"},{value:"Thu",label:"周四",shortLabel:"周四"},{value:"Fri",label:"周五",shortLabel:"周五"},{value:"Sat",label:"周六",shortLabel:"周六"},{value:"Sun",label:"周日",shortLabel:"周日"}],j=({onWeekdayChange:e,className:a=""})=>{let l=()=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date().getDay()],[r,n]=(0,s.useState)(l());return(0,s.useEffect)(()=>{e(l())},[]),t.jsx("div",{className:`relative inline-flex rounded-full p-0.5 sm:p-1 ${a}`,children:w.map(a=>{let l=r===a.value;return t.jsx("button",{onClick:()=>{n(a.value),e(a.value)},className:`
              relative z-10 px-2 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap
              ${l?"text-green-600 dark:text-green-400 font-semibold":"text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer"}
            `,title:a.label,children:a.shortLabel},a.value)})})},k=({type:e,primarySelection:a,secondarySelection:l,onPrimaryChange:r,onSecondaryChange:n,onMultiLevelChange:i,onWeekdayChange:o})=>{let u=(0,s.useRef)(null),c=(0,s.useRef)([]),[d,m]=(0,s.useState)({left:0,width:0}),v=(0,s.useRef)(null),x=(0,s.useRef)([]),[p,b]=(0,s.useState)({left:0,width:0}),h=[{label:"全部",value:"全部"},{label:"热门电影",value:"热门"},{label:"最新电影",value:"最新"},{label:"豆瓣高分",value:"豆瓣高分"},{label:"冷门佳片",value:"冷门佳片"}],g=[{label:"全部",value:"全部"},{label:"华语",value:"华语"},{label:"欧美",value:"欧美"},{label:"韩国",value:"韩国"},{label:"日本",value:"日本"}],f=[{label:"全部",value:"全部"},{label:"最近热门",value:"最近热门"}],w=[{label:"全部",value:"tv"},{label:"国产",value:"tv_domestic"},{label:"欧美",value:"tv_american"},{label:"日本",value:"tv_japanese"},{label:"韩国",value:"tv_korean"},{label:"动漫",value:"tv_animation"},{label:"纪录片",value:"tv_documentary"}],k=[{label:"全部",value:"全部"},{label:"最近热门",value:"最近热门"}],N=[{label:"全部",value:"show"},{label:"国内",value:"show_domestic"},{label:"国外",value:"show_foreign"}],$=[{label:"每日放送",value:"每日放送"},{label:"番剧",value:"番剧"},{label:"剧场版",value:"剧场版"}],S=e=>{i?.(e)},_=(e,a,l,t)=>{if(e>=0&&l.current[e]&&a.current){let r=setTimeout(()=>{let r=l.current[e],s=a.current;if(r&&s){let e=r.getBoundingClientRect(),a=s.getBoundingClientRect();e.width>0&&t({left:e.left-a.left,width:e.width})}},0);return()=>clearTimeout(r)}};(0,s.useEffect)(()=>{"movie"===e?_(h.findIndex(e=>e.value===(a||h[0].value)),u,c,m):"tv"===e?_(f.findIndex(e=>e.value===(a||f[1].value)),u,c,m):"anime"===e?_($.findIndex(e=>e.value===(a||$[0].value)),u,c,m):"show"===e&&_(k.findIndex(e=>e.value===(a||k[1].value)),u,c,m);let t=-1;"movie"===e?t=g.findIndex(e=>e.value===(l||g[0].value)):"tv"===e?t=w.findIndex(e=>e.value===(l||w[0].value)):"show"===e&&(t=N.findIndex(e=>e.value===(l||N[0].value))),t>=0&&_(t,v,x,b)},[e]),(0,s.useEffect)(()=>"movie"===e?_(h.findIndex(e=>e.value===a),u,c,m):"tv"===e?_(f.findIndex(e=>e.value===a),u,c,m):"anime"===e?_($.findIndex(e=>e.value===a),u,c,m):"show"===e?_(k.findIndex(e=>e.value===a),u,c,m):void 0,[a]),(0,s.useEffect)(()=>{let a=-1,t=[];if("movie"===e?(a=g.findIndex(e=>e.value===l),t=g):"tv"===e?(a=w.findIndex(e=>e.value===l),t=w):"show"===e&&(a=N.findIndex(e=>e.value===l),t=N),t.length>0)return _(a,v,x,b)},[l]);let E=(e,a,l,r=!1)=>{let s=r?c:x,n=r?d:p;return(0,t.jsxs)("div",{ref:r?u:v,className:"relative inline-flex bg-gray-200/60 rounded-full p-0.5 sm:p-1 dark:bg-gray-700/60 backdrop-blur-sm",children:[n.width>0&&t.jsx("div",{className:"absolute top-0.5 bottom-0.5 sm:top-1 sm:bottom-1 bg-white dark:bg-gray-500 rounded-full shadow-sm transition-all duration-300 ease-out",style:{left:`${n.left}px`,width:`${n.width}px`}}),e.map((e,r)=>{let n=a===e.value;return t.jsx("button",{ref:e=>{s.current[r]=e},onClick:()=>l(e.value),className:`relative z-10 px-2 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-200 whitespace-nowrap ${n?"text-gray-900 dark:text-gray-100 cursor-default":"text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 cursor-pointer"}`,children:e.label},e.value)})]})};return(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:["movie"===e&&(0,t.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"分类"}),t.jsx("div",{className:"overflow-x-auto",children:E(h,a||h[0].value,r,!0)})]}),"全部"!==a?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"地区"}),t.jsx("div",{className:"overflow-x-auto",children:E(g,l||g[0].value,n,!1)})]}):(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"筛选"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(y,{onChange:S,contentType:e},`${e}-${a}`)})]})]}),"tv"===e&&(0,t.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"分类"}),t.jsx("div",{className:"overflow-x-auto",children:E(f,a||f[1].value,r,!0)})]}),"最近热门"===(a||f[1].value)?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"类型"}),t.jsx("div",{className:"overflow-x-auto",children:E(w,l||w[0].value,n,!1)})]}):"全部"===(a||f[1].value)?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"筛选"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(y,{onChange:S,contentType:e},`${e}-${a}`)})]}):null]}),"anime"===e&&(0,t.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"分类"}),t.jsx("div",{className:"overflow-x-auto",children:E($,a||$[0].value,r,!0)})]}),"每日放送"===(a||$[0].value)?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"星期"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(j,{onWeekdayChange:o})})]}):(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"筛选"}),t.jsx("div",{className:"overflow-x-auto",children:"番剧"===(a||$[0].value)?t.jsx(y,{onChange:S,contentType:"anime-tv"},`anime-tv-${a}`):t.jsx(y,{onChange:S,contentType:"anime-movie"},`anime-movie-${a}`)})]})]}),"show"===e&&(0,t.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"分类"}),t.jsx("div",{className:"overflow-x-auto",children:E(k,a||k[1].value,r,!0)})]}),"最近热门"===(a||k[1].value)?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"类型"}),t.jsx("div",{className:"overflow-x-auto",children:E(N,l||N[0].value,n,!1)})]}):"全部"===(a||k[1].value)?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[t.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[48px]",children:"筛选"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(y,{onChange:S,contentType:e},`${e}-${a}`)})]}):null]})]})};var N=l(73953),$=l(52272);function S(){let e=(0,r.useSearchParams)(),[a,l]=(0,s.useState)([]),[n,o]=(0,s.useState)(!1),[u,c]=(0,s.useState)(0),[v,p]=(0,s.useState)(!0),[b,f]=(0,s.useState)(!1),[y,w]=(0,s.useState)(!1);(0,s.useRef)(null);let j=(0,s.useRef)(null);(0,s.useRef)(null);let S=(0,s.useRef)({type:"",primarySelection:"",secondarySelection:"",multiLevelSelection:{},selectedWeekday:"",currentPage:0}),_=e.get("type")||"movie",[E,C]=(0,s.useState)([]),[L,T]=(0,s.useState)(()=>"movie"===_?"热门":"tv"===_||"show"===_?"最近热门":"anime"===_?"每日放送":""),[P,R]=(0,s.useState)(()=>"movie"===_?"全部":"tv"===_?"tv":"show"===_?"show":"全部"),[I,q]=(0,s.useState)({type:"all",region:"all",year:"all",platform:"all",label:"all",sort:"T"}),[M,B]=(0,s.useState)(""),O=Array.from({length:25},(e,a)=>a),W=(0,s.useCallback)((e,a)=>e.type===a.type&&e.primarySelection===a.primarySelection&&e.secondarySelection===a.secondarySelection&&e.selectedWeekday===a.selectedWeekday&&e.currentPage===a.currentPage&&JSON.stringify(e.multiLevelSelection)===JSON.stringify(a.multiLevelSelection),[]),z=(0,s.useCallback)(e=>"tv"===_||"show"===_?{kind:"tv",category:_,type:P,pageLimit:25,pageStart:e}:{kind:_,category:L,type:P,pageLimit:25,pageStart:e},[_,L,P]);(0,s.useCallback)(async()=>{try{let e;if(o(!0),l([]),c(0),p(!0),f(!1),"custom"===_){let a=E.find(e=>e.type===L&&e.query===P);if(a)e=await m({tag:a.query,type:a.type,pageLimit:25,pageStart:0});else throw Error("没有找到对应的分类")}else if("anime"===_&&"每日放送"===L){let a=(await i()).find(e=>e.weekday.en===M);if(a)e={code:200,message:"success",list:a.items.map(e=>({id:e.id?.toString()||"",title:e.name_cn||e.name,poster:e.images.large||e.images.common||e.images.medium||e.images.small||e.images.grid,rate:e.rating?.score?.toString()||"",year:e.air_date?.split("-")?.[0]||""}))};else throw Error("没有找到对应的日期")}else e="anime"===_?await x({kind:"番剧"===L?"tv":"movie",pageLimit:25,pageStart:0,category:"动画",format:"番剧"===L?"电视剧":"",region:I.region?I.region:"",year:I.year?I.year:"",platform:I.platform?I.platform:"",sort:I.sort?I.sort:"",label:I.label?I.label:""}):"全部"===L?await x({kind:"show"===_?"tv":_,pageLimit:25,pageStart:0,category:I.type?I.type:"",format:"show"===_?"综艺":"tv"===_?"电视剧":"",region:I.region?I.region:"",year:I.year?I.year:"",platform:I.platform?I.platform:"",sort:I.sort?I.sort:"",label:I.label?I.label:""}):await d(z(0));if(200===e.code){let a={...S.current};W({type:_,primarySelection:L,secondarySelection:P,multiLevelSelection:I,selectedWeekday:M,currentPage:0},a)?(l(e.list),p(0!==e.list.length),o(!1)):console.log("参数不一致，不执行任何操作，避免设置过期数据")}else throw Error(e.message||"获取数据失败")}catch(e){console.error(e),o(!1)}},[_,L,P,I,M,z,E]);let A=(0,s.useCallback)(e=>{if(e!==L){if(o(!0),c(0),l([]),p(!0),f(!1),q({type:"all",region:"all",year:"all",platform:"all",label:"all",sort:"T"}),"custom"===_&&E.length>0){let a=E.find(a=>a.type===e);a?(T(e),R(a.query)):T(e)}else("tv"===_||"show"===_)&&"最近热门"===e?(T(e),"tv"===_?R("tv"):"show"===_&&R("show")):T(e)}},[L,_,E]),U=(0,s.useCallback)(e=>{e!==P&&(o(!0),c(0),l([]),p(!0),f(!1),R(e))},[P]),F=(0,s.useCallback)(e=>{((e,a)=>{let l=Object.keys(e).sort(),t=Object.keys(a).sort();return l.length===t.length&&l.every(l=>e[l]===a[l])})(e,I)||(o(!0),c(0),l([]),p(!0),f(!1),q(e))},[I]),G=(0,s.useCallback)(e=>{B(e)},[]);return t.jsx(N.Z,{activePath:(()=>{let e=new URLSearchParams;_&&e.set("type",_);let a=e.toString();return`/douban${a?`?${a}`:""}`})(),children:(0,t.jsxs)("div",{className:"px-4 sm:px-10 py-4 sm:py-8 overflow-visible",children:[(0,t.jsxs)("div",{className:"mb-6 sm:mb-8 space-y-4 sm:space-y-6",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-1 sm:mb-2 dark:text-gray-200",children:"movie"===_?"电影":"tv"===_?"电视剧":"anime"===_?"动漫":"show"===_?"综艺":"自定义"}),t.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"anime"===_&&"每日放送"===L?"来自 Bangumi 番组计划的精选内容":"来自豆瓣的精选内容"})]}),"custom"!==_?t.jsx("div",{className:"bg-white/60 dark:bg-gray-800/40 rounded-2xl p-4 sm:p-6 border border-gray-200/30 dark:border-gray-700/30 backdrop-blur-sm",children:t.jsx(k,{type:_,primarySelection:L,secondarySelection:P,onPrimaryChange:A,onSecondaryChange:U,onMultiLevelChange:F,onWeekdayChange:G})}):t.jsx("div",{className:"bg-white/60 dark:bg-gray-800/40 rounded-2xl p-4 sm:p-6 border border-gray-200/30 dark:border-gray-700/30 backdrop-blur-sm",children:t.jsx(g,{customCategories:E,primarySelection:L,secondarySelection:P,onPrimaryChange:A,onSecondaryChange:U})})]}),(0,t.jsxs)("div",{className:"max-w-[95%] mx-auto mt-8 overflow-visible",children:[t.jsx("div",{className:"justify-start grid grid-cols-3 gap-x-2 gap-y-12 px-0 sm:px-2 sm:grid-cols-[repeat(auto-fill,minmax(160px,1fr))] sm:gap-x-8 sm:gap-y-20",children:n||!y?O.map(e=>t.jsx(h,{},e)):a.map((e,a)=>t.jsx("div",{className:"w-full",children:t.jsx($.Z,{from:"douban",title:e.title,poster:e.poster,douban_id:Number(e.id),rate:e.rate,year:e.year,type:"movie"===_?"movie":"",isBangumi:"anime"===_&&"每日放送"===L})},`${e.title}-${a}`))}),v&&!n&&t.jsx("div",{ref:e=>{e&&null!==e.offsetParent&&(j.current=e)},className:"flex justify-center mt-12 py-8",children:b&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-green-500"}),t.jsx("span",{className:"text-gray-600",children:"加载中..."})]})}),!v&&a.length>0&&t.jsx("div",{className:"text-center text-gray-500 py-8",children:"已加载全部内容"}),!n&&0===a.length&&t.jsx("div",{className:"text-center text-gray-500 py-8",children:"暂无相关内容"})]})]})})}function _(){return t.jsx(s.Suspense,{children:t.jsx(S,{})})}},5231:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>t});let t=(0,l(15761).createProxy)(String.raw`/app/src/app/douban/page.tsx#default`)}};var a=require("../../webpack-runtime.js");a.C(e);var l=e=>a(a.s=e),t=a.X(0,[677,9864,6981,9825,8013,2158,7690,2957,8300,1723,2272],()=>l(79546));module.exports=t})();