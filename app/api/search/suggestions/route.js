"use strict";(()=>{var e={};e.id=8082,e.ids=[8082],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},47831:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>C,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>d,runtime:()=>c});var o=r(4762),n=r(20515),a=r(4894),i=r(40379),u=r(46307),l=r(13303),p=r(7674);let c="nodejs";async function d(e){try{let t=(0,u.l)(e);if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await (0,l.iE)();if(r.UserConfig.Users){let e=r.UserConfig.Users.find(e=>e.username===t.username);if(e&&e.banned)return i.NextResponse.json({error:"用户已被封禁"},{status:401})}let{searchParams:s}=new URL(e.url),o=s.get("q")?.trim();if(!o)return i.NextResponse.json({suggestions:[]});let n=await g(o),a=r.SiteConfig.SiteInterfaceCacheTime||300;return i.NextResponse.json({suggestions:n},{headers:{"Cache-Control":`public, max-age=${a}, s-maxage=${a}`,"CDN-Cache-Control":`public, s-maxage=${a}`,"Vercel-CDN-Cache-Control":`public, s-maxage=${a}`,"Netlify-Vary":"query"}})}catch(e){return console.error("获取搜索建议失败",e),i.NextResponse.json({error:"获取搜索建议失败"},{status:500})}}async function g(e){let t=e.toLowerCase(),r=(await (0,l.iE)()).SourceConfig.filter(e=>!e.disabled),s=[];if(r.length>0){let o=r[0];s=Array.from(new Set((await (0,p.s)(o,e)).map(e=>e.title).filter(Boolean).flatMap(e=>e.split(/[ -:：·、-]/)).filter(e=>e.length>1&&e.toLowerCase().includes(t)))).slice(0,8)}return s.map(e=>{let r=e.toLowerCase(),s=t.split(/[ -:：·、-]/),o=1;return r===t?o=2:r.startsWith(t)||r.endsWith(t)?o=1.8:s.some(e=>r.includes(e))&&(o=1.5),{text:e,type:o>=2?"exact":o>=1.5?"related":"suggestion",score:o}}).sort((e,t)=>{if(e.score!==t.score)return t.score-e.score;let r={exact:3,related:2,suggestion:1};return r[t.type]-r[e.type]})}let x=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/search/suggestions/route",pathname:"/api/search/suggestions",filename:"route",bundlePath:"app/api/search/suggestions/route"},resolvedPagePath:"/app/src/app/api/search/suggestions/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:m}=x,C="/api/search/suggestions/route";function y(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},46307:(e,t,r)=>{function s(e){let t=e.cookies.get("auth");if(!t)return null;try{let e=decodeURIComponent(t.value);return JSON.parse(e)}catch(e){return null}}r.d(t,{l:()=>s})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[677,9864,3001,6735,7690,7674],()=>r(47831));module.exports=s})();