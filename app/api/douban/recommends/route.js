"use strict";(()=>{var e={};e.id=7923,e.ids=[7923],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},98216:e=>{e.exports=require("net")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},76222:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>C,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d});var a={};t.r(a),t.d(a,{GET:()=>u,runtime:()=>p});var o=t(4762),n=t(20515),s=t(4894),i=t(40379),l=t(13303),c=t(48126);let p="nodejs";async function u(e){let{searchParams:r}=new URL(e.url),t=r.get("kind"),a=parseInt(r.get("limit")||"20"),o=parseInt(r.get("start")||"0"),n="all"===r.get("category")?"":r.get("category"),s="all"===r.get("format")?"":r.get("format"),p="all"===r.get("region")?"":r.get("region"),u="all"===r.get("year")?"":r.get("year"),g="all"===r.get("platform")?"":r.get("platform"),m="T"===r.get("sort")?"":r.get("sort"),d="all"===r.get("label")?"":r.get("label");if(!t)return i.NextResponse.json({error:"缺少必要参数: kind"},{status:400});let f={类型:n};s&&(f["形式"]=s),p&&(f["地区"]=p);let y=[];n&&y.push(n),!n&&s&&y.push(s),d&&y.push(d),p&&y.push(p),u&&y.push(u),g&&y.push(g);let C=`https://m.douban.com/rexxar/api/v2/${t}/recommend`,h=new URLSearchParams;h.append("refresh","0"),h.append("start",o.toString()),h.append("count",a.toString()),h.append("selected_categories",JSON.stringify(f)),h.append("uncollect","false"),h.append("score_range","0,10"),h.append("tags",y.join(",")),m&&h.append("sort",m);let U=`${C}?${h.toString()}`;console.log(U);try{let e=(await (0,c.C)(U)).items.filter(e=>"movie"==e.type||"tv"==e.type).map(e=>({id:e.id,title:e.title,poster:e.pic?.normal||e.pic?.large||"",rate:e.rating?.value?e.rating.value.toFixed(1):"",year:e.year})),r=await (0,l.jT)();return i.NextResponse.json({code:200,message:"获取成功",list:e},{headers:{"Cache-Control":`public, max-age=${r}, s-maxage=${r}`,"CDN-Cache-Control":`public, s-maxage=${r}`,"Vercel-CDN-Cache-Control":`public, s-maxage=${r}`,"Netlify-Vary":"query"}})}catch(e){return i.NextResponse.json({error:"获取豆瓣数据失败",details:e.message},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/douban/recommends/route",pathname:"/api/douban/recommends",filename:"route",bundlePath:"app/api/douban/recommends/route"},resolvedPagePath:"/app/src/app/api/douban/recommends/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:f}=g,y="/api/douban/recommends/route";function C(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},13303:(e,r,t)=>{let a;t.d(r,{Hz:()=>n,Ih:()=>p,iE:()=>l,jT:()=>u,ll:()=>g,mL:()=>s,xg:()=>c,yT:()=>m});var o=t(97690);let n={search:{path:"?ac=videolist&wd=",pagePath:"?ac=videolist&wd={query}&pg={page}",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}},detail:{path:"?ac=videolist&ids=",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"application/json"}}};function s(e){let r;try{r=JSON.parse(e.ConfigFile)}catch(e){r={}}let t=Object.entries(r.api_site||[]),a=new Map((e.SourceConfig||[]).map(e=>[e.key,e]));t.forEach(([e,r])=>{let t=a.get(e);t?(t.name=r.name,t.api=r.api,t.detail=r.detail,t.from="config"):a.set(e,{key:e,name:r.name,api:r.api,detail:r.detail,from:"config",disabled:!1})});let o=new Set(t.map(([e])=>e));a.forEach(e=>{o.has(e.key)||(e.from="custom")}),e.SourceConfig=Array.from(a.values());let n=r.custom_category||[],s=new Map((e.CustomCategories||[]).map(e=>[e.query+e.type,e]));n.forEach(e=>{let r=e.query+e.type,t=s.get(r);t?(t.name=e.name,t.query=e.query,t.type=e.type,t.from="config"):s.set(r,{name:e.name,type:e.type,query:e.query,from:"config",disabled:!1})});let i=new Set(n.map(e=>e.query+e.type));return s.forEach(e=>{i.has(e.query+e.type)||(e.from="custom")}),e.CustomCategories=Array.from(s.values()),e}async function i(e,r={URL:"",AutoUpdate:!1,LastCheck:""}){let t;try{t=JSON.parse(e)}catch(e){t={}}let a={ConfigFile:e,ConfigSubscribtion:r,SiteConfig:{SiteName:process.env.NEXT_PUBLIC_SITE_NAME||"MoonTV",Announcement:process.env.ANNOUNCEMENT||"本网站仅提供影视信息搜索服务，所有内容均来自第三方网站。本站不存储任何视频资源，不对任何内容的准确性、合法性、完整性负责。",SearchDownstreamMaxPage:Number(process.env.NEXT_PUBLIC_SEARCH_MAX_PAGE)||5,SiteInterfaceCacheTime:t.cache_time||7200,DoubanProxyType:process.env.NEXT_PUBLIC_DOUBAN_PROXY_TYPE||"melody-cdn-sharon",DoubanProxy:process.env.NEXT_PUBLIC_DOUBAN_PROXY||"",DoubanImageProxyType:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY_TYPE||"melody-cdn-sharon",DoubanImageProxy:process.env.NEXT_PUBLIC_DOUBAN_IMAGE_PROXY||"",DisableYellowFilter:"true"===process.env.NEXT_PUBLIC_DISABLE_YELLOW_FILTER,FluidSearch:"false"!==process.env.NEXT_PUBLIC_FLUID_SEARCH},UserConfig:{AllowRegister:"true"===process.env.NEXT_PUBLIC_ENABLE_REGISTER,Users:[]},SourceConfig:[],CustomCategories:[]},n=[];try{n=await o.db.getAllUsers()}catch(e){console.error("获取用户列表失败:",e)}let s=n.filter(e=>e!==process.env.USERNAME).map(e=>({username:e,role:"user",banned:!1}));return s.unshift({username:process.env.USERNAME,role:"owner",banned:!1}),a.UserConfig.Users=s,Object.entries(t.api_site||[]).forEach(([e,r])=>{a.SourceConfig.push({key:e,name:r.name,api:r.api,detail:r.detail,from:"config",disabled:!1})}),t.custom_category?.forEach(e=>{a.CustomCategories.push({name:e.name||e.query,type:e.type,query:e.query,from:"config",disabled:!1})}),a}async function l(){if(a)return a;let e=null;try{e=await o.db.getAdminConfig()}catch(e){console.error("获取管理员配置失败:",e)}return e||(e=await i("")),a=e=c(e),o.db.saveAdminConfig(a),a}function c(e){e.UserConfig||(e.UserConfig={AllowRegister:!1,Users:[]}),e.UserConfig.Users&&Array.isArray(e.UserConfig.Users)||(e.UserConfig.Users=[]),e.SourceConfig&&Array.isArray(e.SourceConfig)||(e.SourceConfig=[]),e.CustomCategories&&Array.isArray(e.CustomCategories)||(e.CustomCategories=[]);let r=process.env.USERNAME,t=new Set;e.UserConfig.Users=e.UserConfig.Users.filter(e=>!t.has(e.username)&&(t.add(e.username),!0)),e.UserConfig.Users=e.UserConfig.Users.filter(e=>e.username!==r),e.UserConfig.Users.forEach(e=>{"owner"===e.role&&(e.role="user")}),e.UserConfig.Users.unshift({username:r,role:"owner",banned:!1});let a=new Set;e.SourceConfig=e.SourceConfig.filter(e=>!a.has(e.key)&&(a.add(e.key),!0));let o=new Set;return e.CustomCategories=e.CustomCategories.filter(e=>!o.has(e.query+e.type)&&(o.add(e.query+e.type),!0)),e}async function p(){let e=null;try{e=await o.db.getAdminConfig()}catch(e){console.error("获取管理员配置失败:",e)}e||(e={});let r=await i(e.ConfigFile,e.ConfigSubscribtion);a=r,await o.db.saveAdminConfig(r)}async function u(){return(await l()).SiteConfig.SiteInterfaceCacheTime||7200}async function g(){return(await l()).SourceConfig.filter(e=>!e.disabled).map(e=>({key:e.key,name:e.name,api:e.api,detail:e.detail}))}async function m(e){a=e}},48126:(e,r,t)=>{t.d(r,{C:()=>a});async function a(e){let r=new AbortController,t=setTimeout(()=>r.abort(),1e4),a={signal:r.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Referer:"https://movie.douban.com/",Accept:"application/json, text/plain, */*",Origin:"https://movie.douban.com"}};try{let r=await fetch(e,a);if(clearTimeout(t),!r.ok)throw Error(`HTTP error! Status: ${r.status}`);return await r.json()}catch(e){throw clearTimeout(t),e}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[677,9864,3001,7690],()=>t(76222));module.exports=a})();